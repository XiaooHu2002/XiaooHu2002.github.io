

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>
<head>
  <script async src="https://us.umami.is/script.js" data-website-id="83039d8f-bd3d-4637-bcfa-22c3a2fc0ac1"></script>

<meta name="generator" content="Hexo 6.3.0"></head>


<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#9ce8f452">
  <meta name="author" content="严千屹">
  <meta name="keywords" content="">
  
    <meta name="description" content="OpenStack-Train双节点部署">
<meta property="og:type" content="article">
<meta property="og:title" content="OpenStack-Train双节点部署">
<meta property="og:url" content="https://blog.qianyios.top/2023/04/02/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/index.html">
<meta property="og:site_name" content="严千屹博客">
<meta property="og:description" content="OpenStack-Train双节点部署">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog.qianyios.top/img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/1206924e066affac50d4a4b8d175c30feeca392b.png">
<meta property="article:published_time" content="2023-04-02T05:38:39.000Z">
<meta property="article:modified_time" content="2024-03-01T07:00:32.353Z">
<meta property="article:author" content="严千屹">
<meta property="article:tag" content="Centos 7">
<meta property="article:tag" content="OpenStack">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://blog.qianyios.top/img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/1206924e066affac50d4a4b8d175c30feeca392b.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>OpenStack-Train双节点部署 - 严千屹博客</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  



  
<link rel="stylesheet" href="/css/mycss.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"blog.qianyios.top","root":"/","version":"1.9.4","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":true,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  <meta name="referrer" content="no-referrer"/>

  
</head>

<link rel="stylesheet" href="https://portb.kbai.cc/hexo&kbai/mousezhizhen.css"/>
<canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 9999; pointer-events: none;" ></canvas>
<script src="https://cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script>
<script src="https://script-1256884783.file.myqcloud.com/cursor/explosion.min.js"></script>
<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>严 千 屹</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/null') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="OpenStack-Train双节点部署"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-04-02 05:38" pubdate>
          2023年4月2日 凌晨
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          58k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          486 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">OpenStack-Train双节点部署</h1>
            
            
              <div class="markdown-body">
                
                <meta name="referrer" content="no-referrer"/>

<h1 id="OpenStack-Train双节点部署"><a href="#OpenStack-Train双节点部署" class="headerlink" title="OpenStack-Train双节点部署"></a>OpenStack-Train双节点部署</h1><h2 id="节点架构图（最小配置）"><a href="#节点架构图（最小配置）" class="headerlink" title="节点架构图（最小配置）"></a>节点架构图（最小配置）</h2><table>
<thead>
<tr>
<th align="center">主机名</th>
<th align="center">ip1（NAT）</th>
<th align="center">ip2（仅主机）</th>
<th align="center">硬盘</th>
<th align="center">内存</th>
</tr>
</thead>
<tbody><tr>
<td align="center">controller-48</td>
<td align="center">192.168.48.10</td>
<td align="center">192.168.148.10</td>
<td align="center">100G</td>
<td align="center">8G</td>
</tr>
<tr>
<td align="center">computer-48</td>
<td align="center">192.168.48.20</td>
<td align="center">192.168.148.20</td>
<td align="center">100G</td>
<td align="center">3G</td>
</tr>
</tbody></table>
<p>双节点均采用<a target="_blank" rel="noopener" href="http://mirrors.aliyun.com/centos/7.9.2009/isos/x86_64/CentOS-7-x86_64-DVD-2009.iso?spm=a2c6h.25603864.0.0.60196aeaV18bmR">CentOS-7-x86_64-DVD-2009.iso</a>英文最小化安装，安装过程不做解释</p>
<p><font color='cornflowerred'>Computer-48需要特别注意加硬盘</font></p>
<p>c<font color='red'>omputer-48需要勾选处理器虚拟化</font></p>
<p><img src="/../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/image-20240301134940011-1709275202729-27.png" srcset="/img/loading.gif" lazyload alt="image-20240301134940011"></p>
<h3 id="网络设置"><a href="#网络设置" class="headerlink" title="网络设置"></a>网络设置</h3><p><font color='red'>控制节点网络设置</font></p>
<p><font color='red'>ens33</font></p>
<p><img src="/../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/image-20240301140048584-1709275708072-155.png" srcset="/img/loading.gif" lazyload alt="image-20240301140048584"></p>
<p><font color='red'>ens36</font></p>
<p><img src="/../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/image-20240301140239316-1709275708073-156.png" srcset="/img/loading.gif" lazyload alt="image-20240301140239316"></p>
<p><font color='red'>计算节点</font></p>
<p>原理和控制节点一样，第二张网卡不用设置网关</p>
<p><font color='red'>ens33</font></p>
<p><img src="/../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/image-20240301140500814-1709275708073-157.png" srcset="/img/loading.gif" lazyload alt="image-20240301140500814"></p>
<p>ens36</p>
<p><img src="/../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/image-20240301140612238-1709275708073-158.png" srcset="/img/loading.gif" lazyload alt="image-20240301140612238"></p>
<p><font color='red'>温馨提示（小贴士）</font></p>
<blockquote>
<p>  这里就说一下为什么第二张仅主机网卡不用设置网关，因为我们本意是通过NAT进行与外网做数据交换和获取外网资源可以连接互联网的，仅主机仅仅只是用于进行虚拟机内部资源的数据交换，不具备与外网连接的作用，是无法访问互联网的，如果两张网卡同时设置了网关，可能会造成无法访问openstack里创建的虚拟机无法访问互联网，或者本机无法访问互联网的情况，原因是默认路由可能会以仅主机网卡的网络进行与外网链接，但是没办法联网。所以请不要在第二块网卡设置网关</p>
</blockquote>
<p>版本对照表</p>
<table>
<thead>
<tr>
<th align="center">OpenStack 版本</th>
<th align="center">CentOS 版本</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Train 以及更早</td>
<td align="center">7</td>
</tr>
<tr>
<td align="center">Ussuri and Victoria</td>
<td align="center">8</td>
</tr>
<tr>
<td align="center">Wallaby 到 Yoga</td>
<td align="center">Stream 8</td>
</tr>
</tbody></table>
<h2 id="安全性"><a href="#安全性" class="headerlink" title="安全性"></a>安全性</h2><h3 id="基本用户信息"><a href="#基本用户信息" class="headerlink" title="基本用户信息"></a>基本用户信息</h3><p>OpenStack 各组件都需要在控制节点数据库中注册专属账户以存放数据信息，故需要设置密码，强烈建议各组件的密码以及宿主机密码各不相同。</p>
<table>
<thead>
<tr>
<th align="center">OpenStack 组件</th>
<th align="center">密码</th>
</tr>
</thead>
<tbody><tr>
<td align="center">控制节点 root</td>
<td align="center">123456</td>
</tr>
<tr>
<td align="center">计算节点 root</td>
<td align="center">123456</td>
</tr>
<tr>
<td align="center">Metadata 元数据密钥</td>
<td align="center">METADATA_SECRET</td>
</tr>
<tr>
<td align="center">Mariadb root 账户</td>
<td align="center">MARIADB_PASS</td>
</tr>
<tr>
<td align="center">RabbitMQ 服务</td>
<td align="center">RABBIT_PASS</td>
</tr>
<tr>
<td align="center">OpenStack admin</td>
<td align="center">ADMIN_PASS</td>
</tr>
<tr>
<td align="center">Placement 服务</td>
<td align="center">PLACEMENT_PASS</td>
</tr>
<tr>
<td align="center">Keystone 数据库</td>
<td align="center">KEYSTONE_DBPASS</td>
</tr>
<tr>
<td align="center">Glance 服务</td>
<td align="center">GLANCE_PASS</td>
</tr>
<tr>
<td align="center">Glance 数据库</td>
<td align="center">GLANCE_DBPASS</td>
</tr>
<tr>
<td align="center">Nova 服务</td>
<td align="center">NOVA_PASS</td>
</tr>
<tr>
<td align="center">Nova 数据库</td>
<td align="center">NOVA_DBPASS</td>
</tr>
<tr>
<td align="center">Neutron 服务</td>
<td align="center">NEUTRON_PASS</td>
</tr>
<tr>
<td align="center">Neutron 数据库</td>
<td align="center">NEUTRON_DBPASS</td>
</tr>
<tr>
<td align="center">Cinder 服务</td>
<td align="center">CINDER_PASS</td>
</tr>
<tr>
<td align="center">Cinder 数据库</td>
<td align="center">CINDER_DBPASS</td>
</tr>
<tr>
<td align="center">Horizon 数据库</td>
<td align="center">DASH_DBPASS</td>
</tr>
<tr>
<td align="center">Swift服务</td>
<td align="center">SWIFT_PASS</td>
</tr>
<tr>
<td align="center">Heat服务</td>
<td align="center">HEAT_PASS</td>
</tr>
<tr>
<td align="center">Heat数据库服务</td>
<td align="center">HEAT_DBPASS</td>
</tr>
<tr>
<td align="center">heat_domain_admin用户</td>
<td align="center">HEAT_DOMAIN_USER_PASS</td>
</tr>
</tbody></table>
<h3 id="身份验证"><a href="#身份验证" class="headerlink" title="身份验证"></a>身份验证</h3><p>控制节点管理 OpenStack 服务时需要进行身份认证，可将认证信息导入到控制节点环境变量中，方便后续安装配置使用。<br>admin-openrc.sh 文件需提前编写并放入控制节点中，后续安装将不再说明由来</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs routeros">cat &gt;&gt; admin-openrc.sh &lt;&lt; EOF<br><span class="hljs-built_in">export</span> <span class="hljs-attribute">OS_PROJECT_DOMAIN_NAME</span>=Default<br><span class="hljs-built_in">export</span> <span class="hljs-attribute">OS_USER_DOMAIN_NAME</span>=Default<br><span class="hljs-built_in">export</span> <span class="hljs-attribute">OS_PROJECT_NAME</span>=admin<br><span class="hljs-built_in">export</span> <span class="hljs-attribute">OS_USERNAME</span>=admin<br><span class="hljs-built_in">export</span> <span class="hljs-attribute">OS_PASSWORD</span>=123456<br><span class="hljs-built_in">export</span> <span class="hljs-attribute">OS_AUTH_URL</span>=http://controller-48:5000/v3<br><span class="hljs-built_in">export</span> <span class="hljs-attribute">OS_IDENTITY_API_VERSION</span>=3<br><span class="hljs-built_in">export</span> <span class="hljs-attribute">OS_IMAGE_API_VERSION</span>=2<br>EOF<br><br>cat &gt;&gt; user_dog-openrc.sh &lt;&lt; EOF<br><span class="hljs-built_in">export</span> <span class="hljs-attribute">OS_USERNAME</span>=user_dog<br><span class="hljs-built_in">export</span> <span class="hljs-attribute">OS_PASSWORD</span>=123456<br><span class="hljs-built_in">export</span> <span class="hljs-attribute">OS_PROJECT_NAME</span>=Train<br><span class="hljs-built_in">export</span> <span class="hljs-attribute">OS_USER_DOMAIN_NAME</span>=RegionOne<br><span class="hljs-built_in">export</span> <span class="hljs-attribute">OS_PROJECT_DOMAIN_NAME</span>=RegionOne<br><span class="hljs-built_in">export</span> <span class="hljs-attribute">OS_AUTH_URL</span>=http://controller-48:5000/v3<br><span class="hljs-built_in">export</span> <span class="hljs-attribute">OS_IDENTITY_API_VERSION</span>=3<br><span class="hljs-built_in">export</span> <span class="hljs-attribute">OS_IMAGE_API_VERSION</span>=2<br>EOF<br><br><span class="hljs-comment"># OS_USERNAME  登录 OpenStack 服务的用户名</span><br><span class="hljs-comment"># OS_PASSWORD  登录 OpenStack 服务的用户密码</span><br><span class="hljs-comment"># OS_PROJECT_NAME 登录时进入的项目名</span><br><span class="hljs-comment"># OS_USER_DOMAIN_NAME  登录时进入的域名</span><br><span class="hljs-comment"># OS_PROJECT_DOMAIN_NAME  登录时进入的项目域名</span><br><span class="hljs-comment"># OS_AUTH_URL 指定 Keystone（身份认证服务）的 URL  </span><br><span class="hljs-comment"># 如未部署 DNS 服务器，则需要在 hosts中指定 controller-48 映射，或将 controller-48 用控制节点 IP 替代</span><br><span class="hljs-comment"># OS_IDENTITY_API_VERSION 身份认证服务的 API 版本号 </span><br><span class="hljs-comment"># OS_IMAGE_API_VERSION 镜像服务的 API 版本号</span><br></code></pre></td></tr></table></figure>

<h3 id="测试用户"><a href="#测试用户" class="headerlink" title="测试用户"></a>测试用户</h3><table>
<thead>
<tr>
<th>用户</th>
<th>密码</th>
</tr>
</thead>
<tbody><tr>
<td>admin</td>
<td>123456</td>
</tr>
<tr>
<td>use_dog</td>
<td>123456</td>
</tr>
</tbody></table>
<h3 id="物理节点关闭顺序"><a href="#物理节点关闭顺序" class="headerlink" title="物理节点关闭顺序"></a>物理节点关闭顺序</h3><p>给每台机都加上两个脚本</p>
<figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><code class="hljs nsis">cat &gt;&gt; stop.sh &lt;&lt; EOF<br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-comment"># 关闭所有 OpenStack 节点</span><br><span class="hljs-comment"># 依次关闭计算节点、网络节点、控制节点</span><br>for server in \$(openstack server list -f value -c ID)<span class="hljs-comment">; do</span><br>    openstack server stop \<span class="hljs-variable">$server</span><br>done<br><span class="hljs-comment"># 关闭计算节点</span><br>echo <span class="hljs-string">&quot;Stopping compute services...&quot;</span><br><span class="hljs-params">system</span>ctl stop openstack-nova-compute.service<br><span class="hljs-params">system</span>ctl stop libvirtd.service<br><span class="hljs-comment"># 关闭网络节点</span><br>echo <span class="hljs-string">&quot;Stopping network services...&quot;</span><br><span class="hljs-params">system</span>ctl stop openvswitch.service<br><span class="hljs-params">system</span>ctl stop neutron-server.service<br><span class="hljs-params">system</span>ctl stop neutron-linuxbridge-agent.service<br><span class="hljs-params">system</span>ctl stop neutron-dhcp-agent.service<br><span class="hljs-params">system</span>ctl stop neutron-metadata-agent.service<br><span class="hljs-params">system</span>ctl stop neutron-l3-agent.service<br><span class="hljs-comment"># 关闭控制节点</span><br>echo <span class="hljs-string">&quot;Stopping control services...&quot;</span><br><span class="hljs-params">system</span>ctl stop mariadb.service<br><span class="hljs-params">system</span>ctl stop rabbitmq-server.service<br><span class="hljs-params">system</span>ctl stop memcached.service<br><span class="hljs-params">system</span>ctl stop httpd.service<br><span class="hljs-params">system</span>ctl stop openstack-glance-api.service<br><span class="hljs-params">system</span>ctl stop openstack-glance-registry.service<br><span class="hljs-params">system</span>ctl stop openstack-cinder-api.service<br><span class="hljs-params">system</span>ctl stop openstack-cinder-scheduler.service<br><span class="hljs-params">system</span>ctl stop openstack-cinder-volume.service<br><span class="hljs-params">system</span>ctl stop openstack-nova-api.service<br><span class="hljs-params">system</span>ctl stop openstack-nova-scheduler.service<br><span class="hljs-params">system</span>ctl stop openstack-nova-conductor.service<br><span class="hljs-params">system</span>ctl stop openstack-nova-novncproxy.service<br><span class="hljs-params">system</span>ctl stop openstack-nova-consoleauth.service<br><span class="hljs-params">system</span>ctl stop openstack-keystone.service<br><span class="hljs-params">system</span>ctl stop openstack-heat-api.service<br><span class="hljs-params">system</span>ctl stop openstack-heat-api-cfn.service<br><span class="hljs-params">system</span>ctl stop openstack-heat-engine.service<br><span class="hljs-params">system</span>ctl stop openstack-swift-proxy.service<br><span class="hljs-params">system</span>ctl stop openstack-swift-account.service<br><span class="hljs-params">system</span>ctl stop openstack-swift-container.service<br><span class="hljs-params">system</span>ctl stop openstack-swift-object.service<br>echo <span class="hljs-string">&quot;Stopping all services...&quot;</span><br><span class="hljs-params">system</span>ctl stop --<span class="hljs-literal">all</span><br><span class="hljs-comment"># 关闭电源</span><br>echo <span class="hljs-string">&quot;Shutting down the system...&quot;</span><br>poweroff<br>EOF<br><br>cat &gt;&gt; start.sh &lt;&lt; EOF<br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-comment"># 重新启动 OpenStack 服务</span><br><span class="hljs-comment"># 依次启动控制节点、网络节点、计算节点</span><br><span class="hljs-comment"># 启动控制节点</span><br>echo <span class="hljs-string">&quot;Starting control services...&quot;</span><br><span class="hljs-params">system</span>ctl start mariadb.service<br><span class="hljs-params">system</span>ctl start rabbitmq-server.service<br><span class="hljs-params">system</span>ctl start memcached.service<br><span class="hljs-params">system</span>ctl start httpd.service<br><span class="hljs-params">system</span>ctl start openstack-glance-api.service<br><span class="hljs-params">system</span>ctl start openstack-glance-registry.service<br><span class="hljs-params">system</span>ctl start openstack-cinder-api.service<br><span class="hljs-params">system</span>ctl start openstack-cinder-scheduler.service<br><span class="hljs-params">system</span>ctl start openstack-cinder-volume.service<br><span class="hljs-params">system</span>ctl start openstack-nova-api.service<br><span class="hljs-params">system</span>ctl start openstack-nova-scheduler.service<br><span class="hljs-params">system</span>ctl start openstack-nova-conductor.service<br><span class="hljs-params">system</span>ctl start openstack-nova-novncproxy.service<br><span class="hljs-params">system</span>ctl start openstack-nova-consoleauth.service<br><span class="hljs-params">system</span>ctl start openstack-keystone.service<br><span class="hljs-params">system</span>ctl start openstack-heat-api.service<br><span class="hljs-params">system</span>ctl start openstack-heat-api-cfn.service<br><span class="hljs-params">system</span>ctl start openstack-heat-engine.service<br><span class="hljs-params">system</span>ctl start openstack-swift-proxy.service<br><span class="hljs-params">system</span>ctl start openstack-swift-account.service<br><span class="hljs-params">system</span>ctl start openstack-swift-container.service<br><span class="hljs-params">system</span>ctl start openstack-swift-object.service<br><span class="hljs-comment"># 启动网络节点</span><br>echo <span class="hljs-string">&quot;Starting network services...&quot;</span><br><span class="hljs-params">system</span>ctl start openvswitch.service<br><span class="hljs-params">system</span>ctl start neutron-server.service<br><span class="hljs-params">system</span>ctl start neutron-linuxbridge-agent.service<br><span class="hljs-params">system</span>ctl start neutron-dhcp-agent.service<br><span class="hljs-params">system</span>ctl start neutron-metadata-agent.service<br><span class="hljs-params">system</span>ctl start neutron-l3-agent.service<br><span class="hljs-comment"># 启动计算节点</span><br>echo <span class="hljs-string">&quot;Starting compute services...&quot;</span><br><span class="hljs-params">system</span>ctl start libvirtd.service<br><span class="hljs-params">system</span>ctl start openstack-nova-compute.service<br>EOF<br></code></pre></td></tr></table></figure>

<p><font color='red'>（先给两个计算节点执行-最后等计算节点完全关闭，再给控制节点执行）</font></p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vim">关闭物理机的时候运行<br><span class="hljs-keyword">sh</span> <span class="hljs-keyword">stop</span>.<span class="hljs-keyword">sh</span><br>(运行的时候可能会提示你有些服务找不到，报错，这个没关系，一般情况下是没问题的<br></code></pre></td></tr></table></figure>

<h3 id="物理节点开启顺序"><a href="#物理节点开启顺序" class="headerlink" title="物理节点开启顺序"></a>物理节点开启顺序</h3><blockquote>
<p><font color='red'>先给controller-48运行start.sh再给计算节点运行start.sh</font></p>
<p>sh start.sh</p>
</blockquote>
<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><h3 id="修改主机名和防火墙"><a href="#修改主机名和防火墙" class="headerlink" title="修改主机名和防火墙"></a>修改主机名和防火墙</h3><p>controller-48节点</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs gams">hostnamectl <span class="hljs-keyword">set</span>-hostname <span class="hljs-comment">controller-48 &amp;&amp; bash</span><br>systemctl <span class="hljs-comment">disable firewalld --now</span><br>sed <span class="hljs-comment">-i</span> <span class="hljs-comment">&#x27;s/SELINUX=enforcing/SELINUX=disabled/g&#x27;</span> /etc/<span class="hljs-comment">sysconfig</span>/selinux<br>sed -i <span class="hljs-comment">&#x27;s/SELINUX=enforcing/SELINUX=disabled/g&#x27;</span> /<span class="hljs-comment">etc</span>/selinux/<span class="hljs-comment">config</span><br>echo <span class="hljs-comment">&quot;192.168.48.10 controller-48&quot;</span> <span class="hljs-comment">&gt;&gt;</span> /etc/<span class="hljs-comment">hosts</span><br>echo <span class="hljs-comment">&quot;192.168.48.20 computer-48&quot;</span> <span class="hljs-comment">&gt;&gt;</span> /etc/<span class="hljs-comment">hosts</span><br>setenforce <span class="hljs-comment">0</span><br>reboot<br></code></pre></td></tr></table></figure>

<p>computer-48节点</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs gams">hostnamectl <span class="hljs-keyword">set</span>-hostname <span class="hljs-comment">computer-48 &amp;&amp; bash</span><br>systemctl <span class="hljs-comment">disable firewalld --now</span><br>sed <span class="hljs-comment">-i</span> <span class="hljs-comment">&#x27;s/SELINUX=enforcing/SELINUX=disabled/g&#x27;</span> /etc/<span class="hljs-comment">sysconfig</span>/selinux<br>sed -i <span class="hljs-comment">&#x27;s/SELINUX=enforcing/SELINUX=disabled/g&#x27;</span> /<span class="hljs-comment">etc</span>/selinux/<span class="hljs-comment">config</span><br>echo <span class="hljs-comment">&quot;192.168.48.10 controller-48&quot;</span> <span class="hljs-comment">&gt;&gt;</span> /etc/<span class="hljs-comment">hosts</span><br>echo <span class="hljs-comment">&quot;192.168.48.20 computer-48&quot;</span> <span class="hljs-comment">&gt;&gt;</span> /etc/<span class="hljs-comment">hosts</span><br>setenforce <span class="hljs-comment">0</span><br>reboot<br></code></pre></td></tr></table></figure>

<h3 id="修改yum"><a href="#修改yum" class="headerlink" title="修改yum"></a>修改yum</h3><p>controller-48和computer-48节点</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs awk">rm -rf <span class="hljs-regexp">/etc/yum</span>.repos.d/*<br>curl -o <span class="hljs-regexp">/etc/yum</span>.repos.d<span class="hljs-regexp">/epel.repo http:/</span><span class="hljs-regexp">/mirrors.aliyun.com/</span>repo/epel-<span class="hljs-number">7</span>.repo<br>curl -o <span class="hljs-regexp">/etc/yum</span>.repos.d<span class="hljs-regexp">/CentOS-Base.repo http:/</span><span class="hljs-regexp">/mirrors.aliyun.com/</span>repo/Centos-<span class="hljs-number">7</span>.repo<br>cat &gt;&gt;<span class="hljs-regexp">/etc/yum</span>.repos.d/openstack.repo&lt;&lt;EOF<br>[openstack]<br>name=openstack<br>baseurl=https:<span class="hljs-regexp">//mi</span>rrors.aliyun.com<span class="hljs-regexp">/centos/</span><span class="hljs-number">7</span><span class="hljs-regexp">/cloud/</span>x86_64<span class="hljs-regexp">/openstack-train/</span><br>gpgcheck=<span class="hljs-number">0</span> <br>enabled=<span class="hljs-number">1</span><br>EOF<br>yum clean all &amp;&amp; yum makecache<br>yum update -y<br></code></pre></td></tr></table></figure>

<h3 id="SSH免密"><a href="#SSH免密" class="headerlink" title="SSH免密"></a>SSH免密</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#各节点</span><br>yum install -y sshpass <br><span class="hljs-built_in">cat</span> &gt; sshmianmi.sh &lt;&lt; <span class="hljs-string">&quot;EOF&quot;</span><br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-comment"># 目标主机列表</span><br>hosts=(<span class="hljs-string">&quot;controller-48&quot;</span> <span class="hljs-string">&quot;computer-48&quot;</span>)<br><span class="hljs-comment"># 密码（注意修改）</span><br>password=<span class="hljs-string">&quot;123456&quot;</span><br><span class="hljs-comment"># 生成 SSH 密钥对</span><br>ssh-keygen -t rsa -N <span class="hljs-string">&quot;&quot;</span> -f ~/.ssh/id_rsa<br><br><span class="hljs-comment"># 循环遍历目标主机</span><br><span class="hljs-keyword">for</span> host <span class="hljs-keyword">in</span> <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;hosts[@]&#125;</span>&quot;</span><br><span class="hljs-keyword">do</span><br>    <span class="hljs-comment"># 复制公钥到目标主机</span><br>    sshpass -p <span class="hljs-string">&quot;<span class="hljs-variable">$password</span>&quot;</span> ssh-copy-id -o StrictHostKeyChecking=no <span class="hljs-string">&quot;<span class="hljs-variable">$host</span>&quot;</span><br>    <br>    <span class="hljs-comment"># 验证免密登录</span><br>    sshpass -p <span class="hljs-string">&quot;<span class="hljs-variable">$password</span>&quot;</span> ssh -o StrictHostKeyChecking=no <span class="hljs-string">&quot;<span class="hljs-variable">$host</span>&quot;</span> <span class="hljs-string">&quot;echo &#x27;免密登录成功&#x27;&quot;</span><br><span class="hljs-keyword">done</span><br>EOF<br><br>sh sshmianmi.sh<br></code></pre></td></tr></table></figure>

<h2 id="安装OpenStack包"><a href="#安装OpenStack包" class="headerlink" title="安装OpenStack包"></a>安装OpenStack包</h2><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-comment">#各节点</span><br>yum -y <span class="hljs-keyword">install</span> openstack-utils openstack-selinux python-openstackclient<br>yum upgrade<br></code></pre></td></tr></table></figure>

<h2 id="依赖组件"><a href="#依赖组件" class="headerlink" title="依赖组件"></a>依赖组件</h2><p>四个组件安装在controller-48节点上</p>
<h3 id="Mariadb数据库"><a href="#Mariadb数据库" class="headerlink" title="Mariadb数据库"></a>Mariadb数据库</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">yum install mariadb mariadb-<span class="hljs-keyword">server</span> python2-PyMySQL -y<br>cat &gt;&gt;/etc/my.cnf.d/openstack.cnf&lt;&lt;EOF<br>[mysqld]<br>bind-address =<span class="hljs-number">192.168</span><span class="hljs-number">.48</span><span class="hljs-number">.10</span><br><span class="hljs-keyword">default</span>-<span class="hljs-keyword">storage</span>-engine = innodb<br>innodb_file_per_table = <span class="hljs-keyword">on</span><br>max_connections =<span class="hljs-number">4096</span><br><span class="hljs-keyword">collation</span>-<span class="hljs-keyword">server</span> = utf8_general_ci<br><span class="hljs-type">character</span>-<span class="hljs-keyword">set</span>-<span class="hljs-keyword">server</span> = utf8<br>EOF<br>systemctl <span class="hljs-keyword">enable</span> mariadb <span class="hljs-comment">--now</span><br>mysql_secure_installation<br>Enter <span class="hljs-keyword">current</span> <span class="hljs-keyword">password</span> <span class="hljs-keyword">for</span> root (enter <span class="hljs-keyword">for</span> <span class="hljs-keyword">none</span>): 回车<br><span class="hljs-keyword">Set</span> root <span class="hljs-keyword">password</span>? [Y/n] y<br># 将要求输入数据库 root 账户密码 MARIADB_PASS<br>Remove anonymous users? [Y/n] y<br>Disallow root <span class="hljs-keyword">login</span> remotely? [Y/n] n<br>Remove test <span class="hljs-keyword">database</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">access</span> <span class="hljs-keyword">to</span> it? [Y/n] y<br>Reload privilege <span class="hljs-keyword">tables</span> now? [Y/n] y<br># 验证<br>mysql -u root -pMARIADB_PASS<br></code></pre></td></tr></table></figure>

<h3 id="Rabbitmq"><a href="#Rabbitmq" class="headerlink" title="Rabbitmq"></a>Rabbitmq</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">yum install rabbitmq-<span class="hljs-keyword">server</span> -y<br>systemctl <span class="hljs-keyword">enable</span> rabbitmq-<span class="hljs-keyword">server</span> <span class="hljs-comment">--now</span><br>rabbitmqctl add_user openstack RABBIT_PASS<br># 注意将 RABBIT_PASS  修改为 Rabbitmq消息队列密码<br>rabbitmqctl set_permissions openstack &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;<br></code></pre></td></tr></table></figure>

<h3 id="Memcached"><a href="#Memcached" class="headerlink" title="Memcached"></a>Memcached</h3><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs lsl">yum install memcached python-memcached -y<br>sed -i <span class="hljs-string">&quot;s/OPTIONS=<span class="hljs-subst">\&quot;</span>-l 127.0.0.1,::1<span class="hljs-subst">\&quot;</span>/OPTIONS=<span class="hljs-subst">\&quot;</span>-l 127.0.0.1,::1,controller-48<span class="hljs-subst">\&quot;</span>/g&quot;</span> /etc/sysconfig/memcached<br>systemctl enable memcached --now<br></code></pre></td></tr></table></figure>

<p>注意这里的-l 127.0.0.1,::1,controller-48中controller-48是你的主机名，后续不做解释</p>
<h3 id="etcd"><a href="#etcd" class="headerlink" title="etcd"></a>etcd</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs routeros">yum install -y etcd<br>mv /etc/etcd/etcd.conf&#123;,.bak&#125; <br>cat &gt;&gt; /etc/etcd/etcd.conf &lt;&lt; EOF<br><span class="hljs-comment">#[Member]</span><br><span class="hljs-attribute">ETCD_DATA_DIR</span>=<span class="hljs-string">&quot;/var/lib/etcd/default.etcd&quot;</span><br><span class="hljs-attribute">ETCD_LISTEN_PEER_URLS</span>=<span class="hljs-string">&quot;http://192.168.48.10:2380&quot;</span><br><span class="hljs-attribute">ETCD_LISTEN_CLIENT_URLS</span>=<span class="hljs-string">&quot;http://192.168.48.10:2379&quot;</span><br><span class="hljs-attribute">ETCD_NAME</span>=<span class="hljs-string">&quot;controller-48&quot;</span><br><span class="hljs-comment">#controller-48是你的主机名</span><br><span class="hljs-comment">#[Clustering]</span><br><span class="hljs-attribute">ETCD_INITIAL_ADVERTISE_PEER_URLS</span>=<span class="hljs-string">&quot;http://192.168.48.10:2380&quot;</span><br><span class="hljs-attribute">ETCD_ADVERTISE_CLIENT_URLS</span>=<span class="hljs-string">&quot;http://192.168.48.10:2379&quot;</span><br><span class="hljs-attribute">ETCD_INITIAL_CLUSTER</span>=<span class="hljs-string">&quot;controller-48=http://192.168.48.10:2380&quot;</span><br><span class="hljs-attribute">ETCD_INITIAL_CLUSTER_TOKEN</span>=<span class="hljs-string">&quot;etcd-cluster-01&quot;</span><br><span class="hljs-attribute">ETCD_INITIAL_CLUSTER_STATE</span>=<span class="hljs-string">&quot;new&quot;</span><br>EOF<br>systemctl <span class="hljs-built_in">enable</span> etcd --now<br></code></pre></td></tr></table></figure>

<h2 id="Keystone-身份验证服务"><a href="#Keystone-身份验证服务" class="headerlink" title="Keystone(身份验证服务)"></a>Keystone(身份验证服务)</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment">#controller-48节点</span><br>mysql -u root -pMARIADB_PASS<br>CREATE DATABASE keystone;<br>GRANT ALL PRIVILEGES ON keystone.* TO <span class="hljs-string">&#x27;keystone&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> IDENTIFIED BY <span class="hljs-string">&#x27;KEYSTONE_DBPASS&#x27;</span>;<br>GRANT ALL PRIVILEGES ON keystone.* TO <span class="hljs-string">&#x27;keystone&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="hljs-string">&#x27;KEYSTONE_DBPASS&#x27;</span>;<br>flush privileges;<br><span class="hljs-keyword">exit</span><br><span class="hljs-comment"># KEYSTONE_DBPASS  为 Keystone 数据库密码</span><br>yum -y install yum-utils<br>yum -y install qpid-proton-c-<span class="hljs-number">0.26</span>.<span class="hljs-number">0</span>-<span class="hljs-number">2</span>.el7.x86_64<br>yum install -y openstack-keystone httpd mod_wsgi <br>mv <span class="hljs-regexp">/etc/</span>keystone/keystone.conf&#123;,.bak&#125;<br>cat&gt;&gt; <span class="hljs-regexp">/etc/</span>keystone/keystone.conf &lt;&lt; EOF<br>[database]<br>connection = mysql+pymysql:<span class="hljs-regexp">//</span>keystone:KEYSTONE_DBPASS@controller-<span class="hljs-number">48</span>/keystone<br>[token]<br>provider = fernet<br>EOF<br><span class="hljs-comment">#同步服务器</span><br>su -s <span class="hljs-regexp">/bin/</span>sh -c <span class="hljs-string">&quot;keystone-manage db_sync&quot;</span> keystone<br><span class="hljs-comment">#查看是否成功</span><br>mysql -u keystone -p<span class="hljs-string">&quot;KEYSTONE_DBPASS&quot;</span><br>use keystone;<br>show tables;<br><span class="hljs-keyword">exit</span><br><span class="hljs-comment">#有表就行</span><br><br><span class="hljs-comment">#配置</span><br>keystone-manage fernet_setup --keystone-user keystone --keystone-group keystone<br>keystone-manage credential_setup --keystone-user keystone --keystone-group keystone<br>keystone-manage bootstrap --bootstrap-password <span class="hljs-number">123456</span> \<br>  --bootstrap-admin-url http:<span class="hljs-regexp">//</span>controller-<span class="hljs-number">48</span>:<span class="hljs-number">5000</span><span class="hljs-regexp">/v3/</span> \<br>  --bootstrap-internal-url http:<span class="hljs-regexp">//</span>controller-<span class="hljs-number">48</span>:<span class="hljs-number">5000</span><span class="hljs-regexp">/v3/</span> \<br>  --bootstrap-public-url http:<span class="hljs-regexp">//</span>controller-<span class="hljs-number">48</span>:<span class="hljs-number">5000</span><span class="hljs-regexp">/v3/</span> \<br>  --bootstrap-region-id RegionOne<br><span class="hljs-comment"># 123456 为 admin 账户密码</span><br><br>cp <span class="hljs-regexp">/etc/</span>httpd<span class="hljs-regexp">/conf/</span>httpd.conf&#123;,.bak&#125;<br>sed -i <span class="hljs-string">&quot;s/#ServerName www.example.com:80/ServerName controller-48/g&quot;</span> <span class="hljs-regexp">/etc/</span>httpd<span class="hljs-regexp">/conf/</span>httpd.conf<br>ln -s <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/keystone/</span>wsgi-keystone.conf <span class="hljs-regexp">/etc/</span>httpd<span class="hljs-regexp">/conf.d/</span><br>systemctl enable httpd  --now<br><br><span class="hljs-comment">#创建域、项目、用户、角色</span><br>source admin-openrc.sh<br><span class="hljs-comment"># service 项目 创建在 default 用于 OpenStack 服务</span><br>openstack project create --domain default \<br>  --description <span class="hljs-string">&quot;Service Project&quot;</span> service<br><span class="hljs-comment"># 创建一个 RegionOne 域名作为后续云实例创建域名</span><br>openstack domain create --description <span class="hljs-string">&quot;RegionOne Domain&quot;</span> RegionOne<br><span class="hljs-comment"># 在 RegionOne 域中创建一个 Train 项目</span><br>openstack project create --domain RegionOne \<br>  --description <span class="hljs-string">&quot;Train Project&quot;</span> Train<br><span class="hljs-comment"># 在 RegionOne 域中创建普通用户 user_dog </span><br>openstack user create --domain RegionOne \<br>  --password <span class="hljs-number">123456</span> user_dog<br><span class="hljs-comment"># 创建普通用户 user_dog  的规则 user_dog_role</span><br>openstack role create user_dog_role<br><span class="hljs-comment"># 将规则与用户绑定</span><br>openstack role add --project Train --user user_dog user_dog_role<br><span class="hljs-comment"># 注：可以重复上边步骤以创建更多项目、用户及规则</span><br><br><span class="hljs-comment"># 验证服务可用性</span><br><span class="hljs-comment"># 卸载 admin 用户的环境</span><br>unset OS_AUTH_URL OS_PASSWORD<br><span class="hljs-comment"># 验证 admin 用户可用性</span><br>openstack --os-auth-url http:<span class="hljs-regexp">//</span>controller-<span class="hljs-number">48</span>:<span class="hljs-number">5000</span>/v3 \<br>  --os-project-domain-name Default --os-user-domain-name Default --os-project-name admin --os-username admin token issue<br><span class="hljs-comment"># 输入后将要求输入 管理员 admin 的密码</span><br><span class="hljs-comment"># 返回  token 信息则服务正常</span><br><br><span class="hljs-comment"># 验证 user_dog 用户可用性</span><br>openstack --os-auth-url http:<span class="hljs-regexp">//</span>controller-<span class="hljs-number">48</span>:<span class="hljs-number">5000</span>/v3 \<br>  --os-project-domain-name RegionOne --os-user-domain-name RegionOne --os-project-name Train --os-username user_dog token issue<br><br>source admin-openrc.sh<br><span class="hljs-comment"># 列举当前所有域名</span><br>openstack domain list<br>+----------------------------------+-----------+---------+--------------------+<br>| ID                               | Name      | Enabled | Description        |<br>+----------------------------------+-----------+---------+--------------------+<br>| <span class="hljs-number">7</span>fcb64a8c47f40a48265a9db94f0c963 | RegionOne | True    | RegionOne Domain   |<br>| default                          | Default   | True    | The default domain |<br>+----------------------------------+-----------+---------+--------------------+<br></code></pre></td></tr></table></figure>

<h2 id="Glance-镜像服务"><a href="#Glance-镜像服务" class="headerlink" title="Glance(镜像服务)"></a>Glance(镜像服务)</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment">#控制节点</span><br>mysql -u root -pMARIADB_PASS<br>CREATE DATABASE glance;<br>GRANT ALL PRIVILEGES ON glance.* TO <span class="hljs-string">&#x27;glance&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> \<br>  IDENTIFIED BY <span class="hljs-string">&#x27;GLANCE_DBPASS&#x27;</span>;<br>GRANT ALL PRIVILEGES ON glance.* TO <span class="hljs-string">&#x27;glance&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> \<br>  IDENTIFIED BY <span class="hljs-string">&#x27;GLANCE_DBPASS&#x27;</span>;<br>flush privileges;<br><span class="hljs-keyword">exit</span><br><span class="hljs-comment">#将 GLANCE_DBPASS 替换为 glance数据库服务的密码</span><br>source admin-openrc.sh<br><span class="hljs-comment">#创建用户服务和api端点</span><br>openstack user create --domain default --password GLANCE_PASS glance<br><span class="hljs-comment">#GLANCE_PASS 为 glance 服务的密码</span><br><br><span class="hljs-comment"># 为 Glance 用户添加 admin 规则到系统项目 service</span><br>openstack role add --project service --user glance admin<br><span class="hljs-comment"># 没有输出内容</span><br><br><span class="hljs-comment"># 为 Glance 添加管理镜像的服务</span><br>openstack service create --name glance \<br>  --description <span class="hljs-string">&quot;OpenStack Image&quot;</span> image<br><br><span class="hljs-comment"># 为 RegionOne 域名添加服务接口</span><br>openstack endpoint create --region RegionOne \<br>  image public http:<span class="hljs-regexp">//</span>controller-<span class="hljs-number">48</span>:<span class="hljs-number">9292</span><br><br>openstack endpoint create --region RegionOne \<br>  image internal http:<span class="hljs-regexp">//</span>controller-<span class="hljs-number">48</span>:<span class="hljs-number">9292</span><br><br>openstack endpoint create --region RegionOne \<br>  image admin http:<span class="hljs-regexp">//</span>controller-<span class="hljs-number">48</span>:<span class="hljs-number">9292</span><br><br><span class="hljs-comment">#安装glance服务</span><br>yum install openstack-glance -y<br>mv <span class="hljs-regexp">/etc/g</span>lance/glance-api.conf&#123;,.bak&#125;<br>cat &gt;&gt;<span class="hljs-regexp">/etc/g</span>lance/glance-api.conf &lt;&lt; EOF<br>[DEFAULT]<br>use_keystone_quotas = True<br>log_file = <span class="hljs-regexp">/var/</span>log<span class="hljs-regexp">/glance/g</span>lance.log<br>[database]<br>connection = mysql+pymysql:<span class="hljs-regexp">//g</span>lance:GLANCE_DBPASS@controller-<span class="hljs-number">48</span>/glance<br><span class="hljs-comment"># GLANCE_DBPASS 为 Glance 服务的数据库账户密码</span><br>[keystone_authtoken]<br>www_authenticate_uri  = http:<span class="hljs-regexp">//</span>controller-<span class="hljs-number">48</span>:<span class="hljs-number">5000</span><br>auth_url = http:<span class="hljs-regexp">//</span>controller-<span class="hljs-number">48</span>:<span class="hljs-number">5000</span><br>memcached_servers = controller-<span class="hljs-number">48</span>:<span class="hljs-number">11211</span><br>auth_type = password<br>project_domain_name = Default<br>user_domain_name = Default<br>project_name = service<br>username = glance<br>password = GLANCE_PASS<br>service_token_roles_required = true<br><span class="hljs-comment"># GLANCE_PASS 为 Glance 服务的数据库账户密码</span><br>[paste_deploy]<br>flavor = keystone<br>[glance_store]<br>stores = file,http<br>default_store = file<br>default_backend = &#123;<span class="hljs-string">&#x27;store_one&#x27;</span>: <span class="hljs-string">&#x27;http&#x27;</span>, <span class="hljs-string">&#x27;store_two&#x27;</span>: <span class="hljs-string">&#x27;file&#x27;</span>&#125;<br>filesystem_store_datadir = <span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/glance/im</span>ages/<br>EOF<br><span class="hljs-comment"># 同步 Glance 数据到数据库</span><br>su -s <span class="hljs-regexp">/bin/</span>sh -c <span class="hljs-string">&quot;glance-manage db_sync&quot;</span> glance<br>systemctl enable openstack-glance-api  --now<br><span class="hljs-comment"># 验证服务可用性</span><br>source admin-openrc.sh<br>wget https:<span class="hljs-regexp">//</span>download.cirros-cloud.net<span class="hljs-regexp">/0.3.3/</span>cirros-<span class="hljs-number">0.3</span>.<span class="hljs-number">3</span>-x86_64-disk.img<br><span class="hljs-comment">#可能会拉取失败，可以自行复制网址，去浏览器下载，然后上传到/root/目录下</span><br><br>glance image-create --name <span class="hljs-string">&quot;cirros&quot;</span> \<br>  --file cirros-<span class="hljs-number">0.3</span>.<span class="hljs-number">3</span>-x86_64-disk.img \<br>  --disk-format qcow2 --container-format bare \<br>  --visibility=public<br><br>openstack image list<br><span class="hljs-comment"># +--------------------------------------+--------+--------+</span><br><span class="hljs-comment"># | ID                                   | Name   | Status |</span><br><span class="hljs-comment"># +--------------------------------------+--------+--------+</span><br><span class="hljs-comment"># | 4e022193-03c2-40c4-872f-0adb606f31e4 | cirros | active |</span><br><span class="hljs-comment"># +--------------------------------------+--------+--------+</span><br></code></pre></td></tr></table></figure>

<h2 id="Placement（资源调度）"><a href="#Placement（资源调度）" class="headerlink" title="Placement（资源调度）"></a>Placement（资源调度）</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs awk">mysql -u root -pMARIADB_PASS<br>CREATE DATABASE placement;<br>GRANT ALL PRIVILEGES ON placement.* TO <span class="hljs-string">&#x27;placement&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span>  IDENTIFIED BY <span class="hljs-string">&#x27;PLACEMENT_DBPASS&#x27;</span>;<br>GRANT ALL PRIVILEGES ON placement.* TO <span class="hljs-string">&#x27;placement&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="hljs-string">&#x27;PLACEMENT_DBPASS&#x27;</span>;<br>flush privileges;<br><span class="hljs-keyword">exit</span><br><span class="hljs-comment">#PLACEMENT_DBPASS 为 placement 服务的密码</span><br>source admin-openrc.sh<br>openstack user create --domain default --password PLACEMENT_PASS placement<br>openstack role add --project service --user placement admin<br>openstack service create --name placement \<br>  --description <span class="hljs-string">&quot;Placement API&quot;</span> placement<br>openstack endpoint create --region RegionOne \<br>  placement public http:<span class="hljs-regexp">//</span>controller-<span class="hljs-number">48</span>:<span class="hljs-number">8778</span><br>openstack endpoint create --region RegionOne \<br>  placement internal http:<span class="hljs-regexp">//</span>controller-<span class="hljs-number">48</span>:<span class="hljs-number">8778</span><br>openstack endpoint create --region RegionOne \<br>  placement admin http:<span class="hljs-regexp">//</span>controller-<span class="hljs-number">48</span>:<span class="hljs-number">8778</span><br>yum install openstack-placement-api -y<br>mv <span class="hljs-regexp">/etc/</span>placement/placement.conf&#123;,.bak&#125;<br>cat &gt;&gt; <span class="hljs-regexp">/etc/</span>placement/placement.conf &lt;&lt; EOF<br>[placement_database]<br>connection = mysql+pymysql:<span class="hljs-regexp">//</span>placement:PLACEMENT_DBPASS@controller-<span class="hljs-number">48</span>/placement<br><span class="hljs-comment"># PLACEMENT_DBPASS 为 placement 服务的数据库账户密码</span><br>[api]<br>auth_strategy = keystone<br>[keystone_authtoken]<br>auth_url = http:<span class="hljs-regexp">//</span>controller-<span class="hljs-number">48</span>:<span class="hljs-number">5000</span>/v3<br>memcached_servers = controller-<span class="hljs-number">48</span>:<span class="hljs-number">11211</span><br>auth_type = password<br>project_domain_name = Default<br>user_domain_name = Default<br>project_name = service<br>username = placement<br>password = PLACEMENT_PASS<br><span class="hljs-comment"># PLACEMENT_PASS 为 placement 服务的密码</span><br>EOF<br><br><span class="hljs-comment">#同步数据库</span><br>su -s <span class="hljs-regexp">/bin/</span>sh -c <span class="hljs-string">&quot;placement-manage db sync&quot;</span> placement<br>cp <span class="hljs-regexp">/etc/</span>httpd<span class="hljs-regexp">/conf.d/</span><span class="hljs-number">00</span>-placement-api.conf&#123;,.bak&#125;<br>cat &gt;&gt; <span class="hljs-regexp">/etc/</span>httpd<span class="hljs-regexp">/conf.d/</span><span class="hljs-number">00</span>-placement-api.conf &lt;&lt; EOF<br><span class="hljs-comment">#在#SSLCertificateKeyFile ...下添加</span><br>&lt;Directory <span class="hljs-regexp">/usr/</span>bin&gt;<br>&lt;IfVersion &gt;= <span class="hljs-number">2.4</span>&gt;<br>	Require all granted<br>&lt;/IfVersion&gt;<br>&lt;IfVersion &lt; <span class="hljs-number">2.4</span>&gt;<br>	Order allow,deny	<br>	Allow from all<br>&lt;/IfVersion&gt;<br>&lt;/Directory&gt;<br>EOF<br>systemctl restart httpd<br><br><span class="hljs-comment"># 验证服务</span><br>source admin-openrc.sh<br>placement-status upgrade check<br><span class="hljs-comment">#安装pip osc组件验证资源</span><br>yum install python-pip -y<br>pip install osc-placement==<span class="hljs-number">2.2</span>.<span class="hljs-number">0</span><br>systemctl restart httpd<br><br><span class="hljs-comment"># 验证</span><br>openstack --os-placement-api-version <span class="hljs-number">1.2</span> resource class list --sort-column name<br><span class="hljs-comment"># +----------------------------------------+</span><br><span class="hljs-comment"># | name                                   |</span><br><span class="hljs-comment"># +----------------------------------------+</span><br><span class="hljs-comment"># | DISK_GB                                |</span><br>......<br><br>openstack --os-placement-api-version <span class="hljs-number">1.6</span> trait list --sort-column name<br><span class="hljs-comment"># +---------------------------------------+</span><br><span class="hljs-comment"># | name                                  |</span><br><span class="hljs-comment"># +---------------------------------------+</span><br><span class="hljs-comment"># | computer-48_ACCELERATORS                  |</span><br><span class="hljs-comment"># | computer-48_ARCH_AARCH64                  |</span><br><span class="hljs-comment"># ...</span><br></code></pre></td></tr></table></figure>

<h2 id="Nova-计算服务"><a href="#Nova-计算服务" class="headerlink" title="Nova(计算服务)"></a>Nova(计算服务)</h2><h3 id="控制节点"><a href="#控制节点" class="headerlink" title="控制节点"></a>控制节点</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">#控制节点controller<span class="hljs-number">-48</span><br>mysql -u root -pMARIADB_PASS<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">DATABASE</span> nova_api;<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">DATABASE</span> nova;<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">DATABASE</span> nova_cell0;<br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> <span class="hljs-keyword">PRIVILEGES</span> <span class="hljs-keyword">ON</span> nova_api.* <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;nova&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> \<br>  IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;NOVA_DBPASS&#x27;</span>;<br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> <span class="hljs-keyword">PRIVILEGES</span> <span class="hljs-keyword">ON</span> nova_api.* <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;nova&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> \<br>  IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;NOVA_DBPASS&#x27;</span>;<br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> <span class="hljs-keyword">PRIVILEGES</span> <span class="hljs-keyword">ON</span> nova.* <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;nova&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> \<br>  IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;NOVA_DBPASS&#x27;</span>;<br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> <span class="hljs-keyword">PRIVILEGES</span> <span class="hljs-keyword">ON</span> nova.* <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;nova&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> \<br>  IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;NOVA_DBPASS&#x27;</span>;<br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> <span class="hljs-keyword">PRIVILEGES</span> <span class="hljs-keyword">ON</span> nova_cell0.* <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;nova&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> \<br>  IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;NOVA_DBPASS&#x27;</span>;<br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> <span class="hljs-keyword">PRIVILEGES</span> <span class="hljs-keyword">ON</span> nova_cell0.* <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;nova&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> \<br>  IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;NOVA_DBPASS&#x27;</span>;<br>flush <span class="hljs-keyword">privileges</span>;<br><span class="hljs-keyword">exit</span><br><br># NOVA_DBPASS 为 nova 服务的密码<br><br>source <span class="hljs-keyword">admin</span>-openrc.sh<br>openstack <span class="hljs-keyword">user</span> <span class="hljs-keyword">create</span> <span class="hljs-comment">--domain default --password NOVA_PASS nova</span><br>openstack <span class="hljs-keyword">role</span> <span class="hljs-keyword">add</span> <span class="hljs-comment">--project service --user nova admin</span><br>openstack service <span class="hljs-keyword">create</span> <span class="hljs-comment">--name nova \</span><br>  <span class="hljs-comment">--description &quot;OpenStack Compute&quot; compute</span><br>openstack endpoint <span class="hljs-keyword">create</span> <span class="hljs-comment">--region RegionOne \</span><br>  compute <span class="hljs-built_in">public</span> http://controller<span class="hljs-number">-48</span>:<span class="hljs-number">8774</span>/v2<span class="hljs-number">.1</span><br>openstack endpoint <span class="hljs-keyword">create</span> <span class="hljs-comment">--region RegionOne \</span><br>  compute <span class="hljs-type">internal</span> http://controller<span class="hljs-number">-48</span>:<span class="hljs-number">8774</span>/v2<span class="hljs-number">.1</span><br>openstack endpoint <span class="hljs-keyword">create</span> <span class="hljs-comment">--region RegionOne \</span><br>  compute <span class="hljs-keyword">admin</span> http://controller<span class="hljs-number">-48</span>:<span class="hljs-number">8774</span>/v2<span class="hljs-number">.1</span><br>mv /etc/yum.repos.d/epel.repo&#123;,.bak&#125; <br>yum install -y \<br>    openstack-nova-api \<br>    openstack-nova-scheduler \<br>    openstack-nova-conductor \<br>    openstack-nova-novncproxy<br>mv /etc/yum.repos.d/epel.repo&#123;.bak,&#125; <br>mv /etc/nova/nova.conf&#123;,.bak&#125;<br>cat &gt;&gt; /etc/nova/nova.conf &lt;&lt;EOF<br>[<span class="hljs-keyword">DEFAULT</span>]<br>enabled_apis = osapi_compute,metadata<br>transport_url = rabbit://openstack:RABBIT_PASS@controller<span class="hljs-number">-48</span>:<span class="hljs-number">5672</span>/<br># RABBIT_PASS为 rabbitmq 密码<br>my_ip = <span class="hljs-number">192.168</span><span class="hljs-number">.48</span><span class="hljs-number">.10</span><br># 控制节点控制网络的 IP<br>log_file = /var/<span class="hljs-keyword">log</span>/nova/nova-controller.<span class="hljs-keyword">log</span><br>rootwrap_config = /etc/nova/rootwrap.conf<br>[api_database]<br><span class="hljs-keyword">connection</span> = mysql+pymysql://nova:NOVA_DBPASS@controller<span class="hljs-number">-48</span>/nova_api<br># NOVA_DBPASS 为数据库 Nova 账户密码<br>[<span class="hljs-keyword">database</span>]<br><span class="hljs-keyword">connection</span> = mysql+pymysql://nova:NOVA_DBPASS@controller<span class="hljs-number">-48</span>/nova<br># NOVA_DBPASS 为数据库 Nova 账户密码<br>[api]<br>auth_strategy = keystone<br>[keystone_authtoken]<br>www_authenticate_uri = http://controller<span class="hljs-number">-48</span>:<span class="hljs-number">5000</span>/<br>auth_url = http://controller<span class="hljs-number">-48</span>:<span class="hljs-number">5000</span>/<br>memcached_servers = controller<span class="hljs-number">-48</span>:<span class="hljs-number">11211</span><br>auth_type = <span class="hljs-keyword">password</span><br>project_domain_name = <span class="hljs-keyword">Default</span><br>user_domain_name = <span class="hljs-keyword">Default</span><br>project_name = service<br>username = nova<br><span class="hljs-keyword">password</span> =NOVA_PASS<br># NOVA_PASS 为 Nova 服务的密码<br>[vnc]<br>enabled = <span class="hljs-keyword">true</span><br>server_listen = \$my_ip<br>server_proxyclient_address = \$my_ip<br>[glance]<br>api_servers = http://controller<span class="hljs-number">-48</span>:<span class="hljs-number">9292</span><br>[oslo_concurrency]<br>lock_path = /var/run/nova<br>[placement]<br>region_name = RegionOne<br>project_domain_name = <span class="hljs-keyword">Default</span><br>project_name = service<br>auth_type = <span class="hljs-keyword">password</span><br>user_domain_name = <span class="hljs-keyword">Default</span><br>auth_url = http://controller<span class="hljs-number">-48</span>:<span class="hljs-number">5000</span>/v3<br>username = placement<br><span class="hljs-keyword">password</span> = PLACEMENT_PASS<br># PLACEMENT_PASS 为 placement 服务的密码<br>EOF<br>su -s /bin/sh -c &quot;nova-manage api_db sync&quot; nova<br>su -s /bin/sh -c &quot;nova-manage cell_v2 map_cell0&quot; nova<br>su -s /bin/sh -c &quot;nova-manage cell_v2 create_cell --name=cell1 --verbose&quot; nova<br>su -s /bin/sh -c &quot;nova-manage db sync&quot; nova<br><br># 验证<br><br>su -s /bin/sh -c &quot;nova-manage cell_v2 list_cells&quot; nova<br><br>systemctl <span class="hljs-keyword">enable</span> <span class="hljs-comment">--now \</span><br>    openstack-nova-api.service \<br>    openstack-nova-scheduler.service \<br>    openstack-nova-conductor.service \<br>    openstack-nova-novncproxy.service<br>    <br>systemctl status \<br>    openstack-nova-api.service \<br>    openstack-nova-scheduler.service \<br>    openstack-nova-conductor.service \<br>    openstack-nova-novncproxy.service<br>    <br></code></pre></td></tr></table></figure>

<h3 id="计算节点"><a href="#计算节点" class="headerlink" title="计算节点"></a>计算节点</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment">##computer-48计算节点</span><br>cat &gt;&gt;<span class="hljs-regexp">/etc/yum</span>.repos.d/CentOS-Base.repo&lt;&lt;EOF<br>[Virt]<br>name=CentOS-\<span class="hljs-variable">$releasever</span> - Base<br>baseurl=http:<span class="hljs-regexp">//mi</span>rrors.aliyun.com<span class="hljs-regexp">/centos/</span><span class="hljs-number">7.9</span>.<span class="hljs-number">2009</span><span class="hljs-regexp">/virt/</span>x86_64<span class="hljs-regexp">/kvm-common/</span><br>gpgcheck=<span class="hljs-number">0</span><br>gpgkey=file:<span class="hljs-regexp">//</span><span class="hljs-regexp">/etc/</span>pki<span class="hljs-regexp">/rpm-gpg/</span>RPM-GPG-KEY-CentOS-<span class="hljs-number">7</span><br>EOF<br>yum install qpid-proton-c-<span class="hljs-number">0.26</span>.<span class="hljs-number">0</span>-<span class="hljs-number">2</span>.el7.x86_64 -y<br>yum install openstack-nova-compute -y<br>mv <span class="hljs-regexp">/etc/</span>nova/nova.conf&#123;,.bak&#125;<br>cat &gt;&gt; <span class="hljs-regexp">/etc/</span>nova/nova.conf &lt;&lt;EOF<br>[DEFAULT]<br>enabled_apis = osapi_compute,metadata<br>transport_url = rabbit:<span class="hljs-regexp">//</span>openstack:RABBIT_PASS@controller-<span class="hljs-number">48</span><br>my_ip = <span class="hljs-number">192.168</span>.<span class="hljs-number">48.20</span><br>compute_driver=libvirt.LibvirtDriver<br>log_file = <span class="hljs-regexp">/var/</span>log<span class="hljs-regexp">/nova/</span>nova-compute.log<br><span class="hljs-comment"># 192.168.48.20替换为 计算节点管理网络 IP 地址</span><br>[api]<br>auth_strategy = keystone<br>[keystone_authtoken]<br>www_authenticate_uri = http:<span class="hljs-regexp">//</span>controller-<span class="hljs-number">48</span>:<span class="hljs-number">5000</span>/<br>auth_url = http:<span class="hljs-regexp">//</span>controller-<span class="hljs-number">48</span>:<span class="hljs-number">5000</span>/<br>memcached_servers = controller-<span class="hljs-number">48</span>:<span class="hljs-number">11211</span><br>auth_type = password<br>project_domain_name = Default<br>user_domain_name = Default<br>project_name = service<br>username = nova<br>password = NOVA_PASS<br><span class="hljs-comment">#NOVA_PASS为nova服务密码</span><br>[vnc]<br>enabled = true<br>server_listen = <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span><br>server_proxyclient_address = \<span class="hljs-variable">$my_ip</span><br>novncproxy_base_url = http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">48.10</span>:<span class="hljs-number">6080</span>/vnc_auto.html<br><span class="hljs-comment"># 将 192.168.48.10修改为控制节点管理网络 IP </span><br>[glance]<br>api_servers = http:<span class="hljs-regexp">//</span>controller-<span class="hljs-number">48</span>:<span class="hljs-number">9292</span><br>[oslo_concurrency]<br>lock_path = <span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/nova/</span>tmp<br>[placement]<br>region_name = RegionOne<br>project_domain_name = Default<br>project_name = service<br>auth_type = password<br>user_domain_name = Default<br>auth_url = http:<span class="hljs-regexp">//</span>controller-<span class="hljs-number">48</span>:<span class="hljs-number">5000</span>/v3<br>username = placement<br>password = PLACEMENT_PASS<br><span class="hljs-comment">#PLACEMENT_PASS 为 Placement 服务密码</span><br>[neutron]<br>auth_url = http:<span class="hljs-regexp">//</span>controller-<span class="hljs-number">48</span>:<span class="hljs-number">5000</span><br>auth_type = password<br>project_domain_name = default<br>user_domain_name = default<br>region_name = RegionOne<br>project_name = service<br>username = neutron<br>password = NEUTRON_PASS<br><span class="hljs-comment"># NEUTRON_PASS 为 Neutron 服务密码</span><br>EOF<br><br>egrep -c <span class="hljs-string">&#x27;(vmx|svm)&#x27;</span> <span class="hljs-regexp">/proc/</span>cpuinfo<br>---------------------------------------------------------------------------------<br><span class="hljs-comment"># 如果返回值大于 1 则说明已经开启硬件虚拟化，无需配置 qemu</span><br><span class="hljs-comment"># 如等于 0 ，则需要配置 qemu 以代替默认的 kvm</span><br>vi <span class="hljs-regexp">/etc/</span>nova/nova.conf<br>[libvirt]<br><span class="hljs-comment"># ...</span><br>virt_type = qemu<br><br><span class="hljs-comment"># 以上配置仅当 egrep -c &#x27;(vmx|svm)&#x27; /proc/cpuinfo 结果为 0 时才进行配置</span><br>---------------------------------------------------------------------------------<br>systemctl enable libvirtd.service openstack-nova-compute.service --now<br>systemctl status libvirtd.service openstack-nova-compute.service <br></code></pre></td></tr></table></figure>

<h3 id="控制节点验证"><a href="#控制节点验证" class="headerlink" title="控制节点验证"></a>控制节点验证</h3><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><code class="hljs gherkin"><span class="hljs-comment"># 在控制节点执行验证</span><br>source admin-openrc.sh<br>openstack compute service list --service nova-compute<br>+----+--------------+----------+------+---------+-------+----------------------------+<br>|<span class="hljs-string"> ID </span>|<span class="hljs-string"> Binary       </span>|<span class="hljs-string"> Host     </span>|<span class="hljs-string"> Zone </span>|<span class="hljs-string"> Status  </span>|<span class="hljs-string"> State </span>|<span class="hljs-string"> Updated At                 </span>|<br>+----+--------------+----------+------+---------+-------+----------------------------+<br>|<span class="hljs-string"> 10 </span>|<span class="hljs-string"> nova-computer </span>|<span class="hljs-string"> computer-48 </span>|<span class="hljs-string"> nova </span>|<span class="hljs-string"> enabled </span>|<span class="hljs-string"> up    </span>|<span class="hljs-string"> 2023-04-02T17:17:08.000000 </span>|<br>+----+--------------+----------+------+---------+-------+----------------------------+<br><br><span class="hljs-comment"># 在控制节点执行验证</span><br>su -s /bin/sh -c <span class="hljs-string">&quot;nova-manage cell_v2 discover_hosts --verbose&quot;</span> nova<br><span class="hljs-comment">####</span><br>Found 2 cell mappings.<br>Skipping cell0 since it does not contain hosts.<br>Getting computer-48s from cell &#x27;cell1&#x27;: 89e02b18-2a3c-437a-8dd5-15deb98676a4<br>Checking host mapping for computer-48 host &#x27;computer-48r-48&#x27;: e862bd61-8f56-4d3a-a2b2-21ab7db90ede<br>Creating host mapping for computer-48 host &#x27;computer-48r-48&#x27;: e862bd61-8f56-4d3a-a2b2-21ab7db90ede<br>Found 1 unmapped computer-48s in cell: 89e02b18-2a3c-437a-8dd5-15deb98676a4<br><br><br>openstack compute service list<br>[root<span class="hljs-meta">@controller-48</span> ~]<span class="hljs-comment"># openstack compute service list</span><br>+----+----------------+---------------+----------+---------+-------+----------------------------+<br>|<span class="hljs-string"> ID </span>|<span class="hljs-string"> Binary         </span>|<span class="hljs-string"> Host          </span>|<span class="hljs-string"> Zone     </span>|<span class="hljs-string"> Status  </span>|<span class="hljs-string"> State </span>|<span class="hljs-string"> Updated At                 </span>|<br>+----+----------------+---------------+----------+---------+-------+----------------------------+<br>|<span class="hljs-string">  1 </span>|<span class="hljs-string"> nova-conductor </span>|<span class="hljs-string"> controller-48 </span>|<span class="hljs-string"> internal </span>|<span class="hljs-string"> enabled </span>|<span class="hljs-string"> up    </span>|<span class="hljs-string"> 2023-05-27T17:44:38.000000 </span>|<br>|<span class="hljs-string">  4 </span>|<span class="hljs-string"> nova-scheduler </span>|<span class="hljs-string"> controller-48 </span>|<span class="hljs-string"> internal </span>|<span class="hljs-string"> enabled </span>|<span class="hljs-string"> up    </span>|<span class="hljs-string"> 2023-05-27T17:44:40.000000 </span>|<br>|<span class="hljs-string">  5 </span>|<span class="hljs-string"> nova-compute   </span>|<span class="hljs-string"> computer-48   </span>|<span class="hljs-string"> nova     </span>|<span class="hljs-string"> enabled </span>|<span class="hljs-string"> up    </span>|<span class="hljs-string"> 2023-05-27T17:44:43.000000 </span>|<br>+----+----------------+---------------+----------+---------+-------+----------------------------+<br><br>openstack catalog list<br>+-----------+-----------+----------------------------------------------------------------------+<br>|<span class="hljs-string"> Name      </span>|<span class="hljs-string"> Type      </span>|<span class="hljs-string"> Endpoints                                                            </span>|<br>+-----------+-----------+----------------------------------------------------------------------+<br>|<span class="hljs-string"> placement </span>|<span class="hljs-string"> placement </span>|<span class="hljs-string"> RegionOne                                                            </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">   internal: http://controller-48:8778                                   </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string"> RegionOne                                                            </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">   admin: http://controller-48:8778                                      </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string"> RegionOne                                                            </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">   public: http://controller-48:8778                                     </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">                                                                      </span>|<br>|<span class="hljs-string"> keystone  </span>|<span class="hljs-string"> identity  </span>|<span class="hljs-string"> RegionOne                                                            </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">   admin: http://controller-48:5000/v3/                                  </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string"> RegionOne                                                            </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">   internal: http://controller-48:5000/v3/                               </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string"> RegionOne                                                            </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">   public: http://controller-48:5000/v3/                                 </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">                                                                      </span>|<br>|<span class="hljs-string"> neutron   </span>|<span class="hljs-string"> network   </span>|<span class="hljs-string"> RegionOne                                                            </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">   public: http://controller-48:9696                                     </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string"> RegionOne                                                            </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">   internal: http://controller-48:9696                                   </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string"> RegionOne                                                            </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">   admin: http://controller-48:9696                                      </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">                                                                      </span>|<br>|<span class="hljs-string"> glance    </span>|<span class="hljs-string"> image     </span>|<span class="hljs-string"> RegionOne                                                            </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">   admin: http://controller-48:9292                                      </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string"> RegionOne                                                            </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">   internal: http://controller-48:9292                                   </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string"> RegionOne                                                            </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">   public: http://controller-48:9292                                     </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">                                                                      </span>|<br>|<span class="hljs-string"> nova      </span>|<span class="hljs-string"> computer-48   </span>|<span class="hljs-string"> RegionOne                                                            </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">   admin: http://controller-48:8774/v2.1                                 </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string"> RegionOne                                                            </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">   internal: http://controller-48:8774/v2.1                              </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string"> RegionOne                                                            </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">   public: http://controller-48:8774/v2.1                                </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">                                                                      </span>|<br>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|<span class="hljs-string">                                                                      </span>|<br>+-----------+-----------+----------------------------------------------------------------------+<br><br>openstack image list<br>+--------------------------------------+--------+--------+<br>|<span class="hljs-string"> ID                                   </span>|<span class="hljs-string"> Name   </span>|<span class="hljs-string"> Status </span>|<br>+--------------------------------------+--------+--------+<br>|<span class="hljs-string"> 4e022193-03c2-40c4-872f-0adb606f31e4 </span>|<span class="hljs-string"> cirros </span>|<span class="hljs-string"> active </span>|<br>+--------------------------------------+--------+--------+<br><br><br>nova-status upgrade check<br>[root<span class="hljs-meta">@controller-48</span> ~]<span class="hljs-comment"># nova-status upgrade check</span><br>+--------------------------------+<br>|<span class="hljs-string"> Upgrade Check Results          </span>|<br>+--------------------------------+<br>|<span class="hljs-string"> Check: Cells v2                </span>|<br>|<span class="hljs-string"> Result: Success                </span>|<br>|<span class="hljs-string"> Details: None                  </span>|<br>+--------------------------------+<br>|<span class="hljs-string"> Check: Placement API           </span>|<br>|<span class="hljs-string"> Result: Success                </span>|<br>|<span class="hljs-string"> Details: None                  </span>|<br>+--------------------------------+<br>|<span class="hljs-string"> Check: Ironic Flavor Migration </span>|<br>|<span class="hljs-string"> Result: Success                </span>|<br>|<span class="hljs-string"> Details: None                  </span>|<br>+--------------------------------+<br>|<span class="hljs-string"> Check: Cinder API              </span>|<br>|<span class="hljs-string"> Result: Success                </span>|<br>|<span class="hljs-string"> Details: None                  </span>|<br>+--------------------------------+<br><br><span class="hljs-comment">#在控制节点修改自动注册nova-computer-48节点</span><br>cat &gt;&gt; /etc/nova/nova.conf <span class="hljs-variable">&lt;&lt; EOF</span><br><span class="hljs-variable">[scheduler]</span><br><span class="hljs-variable">discover_hosts_in_cells_interval = 300</span><br><span class="hljs-variable">EOF</span><br><span class="hljs-variable"></span><br></code></pre></td></tr></table></figure>

<h2 id="Neutron（网络服务）"><a href="#Neutron（网络服务）" class="headerlink" title="Neutron（网络服务）"></a>Neutron（网络服务）</h2><h3 id="控制节点-1"><a href="#控制节点-1" class="headerlink" title="控制节点"></a>控制节点</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment">##控制节点controller-48</span><br>mysql -u root -pMARIADB_PASS<br>CREATE DATABASE neutron;<br>GRANT ALL PRIVILEGES ON neutron.* TO <span class="hljs-string">&#x27;neutron&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> \<br>  IDENTIFIED BY <span class="hljs-string">&#x27;NEUTRON_DBPASS&#x27;</span>;<br>GRANT ALL PRIVILEGES ON neutron.* TO <span class="hljs-string">&#x27;neutron&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> \<br>  IDENTIFIED BY <span class="hljs-string">&#x27;NEUTRON_DBPASS&#x27;</span>;<br>flush privileges;<br><span class="hljs-keyword">exit</span><br>source admin-openrc.sh<br>openstack user create --domain default --password NEUTRON_PASS neutron<br>openstack role add --project service --user neutron admin<br>openstack service create --name neutron \<br>  --description <span class="hljs-string">&quot;OpenStack Networking&quot;</span> network<br>openstack endpoint create --region RegionOne \<br>  network public http:<span class="hljs-regexp">//</span>controller-<span class="hljs-number">48</span>:<span class="hljs-number">9696</span><br>openstack endpoint create --region RegionOne \<br>  network internal http:<span class="hljs-regexp">//</span>controller-<span class="hljs-number">48</span>:<span class="hljs-number">9696</span><br>openstack endpoint create --region RegionOne \<br>  network admin http:<span class="hljs-regexp">//</span>controller-<span class="hljs-number">48</span>:<span class="hljs-number">9696</span><br><span class="hljs-comment"># 选择安装 大二层 网络</span><br>yum install openstack-neutron openstack-neutron-ml2 \<br>  openstack-neutron-linuxbridge ebtables -y<br><br>mv <span class="hljs-regexp">/etc/</span>neutron/neutron.conf&#123;,.bak&#125;<br>cat &gt;&gt; <span class="hljs-regexp">/etc/</span>neutron/neutron.conf &lt;&lt;EOF<br>[database]<br>connection = mysql+pymysql:<span class="hljs-regexp">//</span>neutron:NEUTRON_DBPASS@controller-<span class="hljs-number">48</span>/neutron<br><span class="hljs-comment">#NEUTRON_DBPASS为 数据库 neutron 账户密码</span><br>[DEFAULT]<br>core_plugin = ml2<br>service_plugins = router<br>allow_overlapping_ips = true<br>transport_url = rabbit:<span class="hljs-regexp">//</span>openstack:RABBIT_PASS@controller-<span class="hljs-number">48</span><br>auth_strategy = keystone<br>notify_nova_on_port_status_changes = true<br>notify_nova_on_port_data_changes = true<br><span class="hljs-comment"># RABBIT_PASS 为 消息队列密码</span><br>[keystone_authtoken]<br>www_authenticate_uri = http:<span class="hljs-regexp">//</span>controller-<span class="hljs-number">48</span>:<span class="hljs-number">5000</span><br>auth_url = http:<span class="hljs-regexp">//</span>controller-<span class="hljs-number">48</span>:<span class="hljs-number">5000</span><br>memcached_servers = controller-<span class="hljs-number">48</span>:<span class="hljs-number">11211</span><br>auth_type = password<br>project_domain_name = default<br>user_domain_name = default<br>project_name = service<br>username = neutron<br>password = NEUTRON_PASS<br><span class="hljs-comment"># NEUTRON_PASS为 neutron 服务密码</span><br>[nova]<br>auth_url = http:<span class="hljs-regexp">//</span>controller-<span class="hljs-number">48</span>:<span class="hljs-number">5000</span><br>auth_type = password<br>project_domain_name = default<br>user_domain_name = default<br>region_name = RegionOne<br>project_name = service<br>username = nova<br>password = NOVA_PASS<br><span class="hljs-comment"># [nova]  没有则添加</span><br><span class="hljs-comment"># NOVA_PASS为 Nova 服务密码</span><br>[oslo_concurrency]<br>EOF<br><br>mv <span class="hljs-regexp">/etc/</span>neutron<span class="hljs-regexp">/plugins/m</span>l2/ml2_conf.ini&#123;,.bak&#125;<br>cat &gt;&gt; <span class="hljs-regexp">/etc/</span>neutron<span class="hljs-regexp">/plugins/m</span>l2/ml2_conf.ini &lt;&lt; EOF<br>[ml2]<br>type_drivers = flat,vlan,vxlan<br>tenant_network_types = vxlan<br>mechanism_drivers = linuxbridge,l2population<br>extension_drivers = port_security<br>[ml2_type_flat]<br>flat_networks = provider<br>[ml2_type_vxlan]<br>vni_ranges = <span class="hljs-number">1</span>:<span class="hljs-number">1000</span><br>[securitygroup]<br>enable_ipset = true<br>EOF<br><br>mv <span class="hljs-regexp">/etc/</span>neutron<span class="hljs-regexp">/plugins/m</span>l2/linuxbridge_agent.ini&#123;,.bak&#125;<br>cat &gt;&gt; <span class="hljs-regexp">/etc/</span>neutron<span class="hljs-regexp">/plugins/m</span>l2/linuxbridge_agent.ini &lt;&lt;EOF<br>[linux_bridge]<br>physical_interface_mappings = provider:ens33<br><span class="hljs-comment"># ens33 为第一块网卡名称</span><br>[vxlan]<br>enable_vxlan = true<br>local_ip = <span class="hljs-number">192.168</span>.<span class="hljs-number">48.10</span><br>l2_population = true<br><span class="hljs-comment"># 192.168.48.10 为管理网络 控制节点的 IP  即 controller-48 IP</span><br>[securitygroup]<br>enable_security_group = true<br>firewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver<br>EOF<br><br>mv <span class="hljs-regexp">/etc/</span>neutron/l3_agent.ini&#123;,.bak&#125;<br>cat &gt;&gt; <span class="hljs-regexp">/etc/</span>neutron/l3_agent.ini &lt;&lt; EOF<br>[DEFAULT]<br>interface_driver = linuxbridge<br>EOF<br><br>mv <span class="hljs-regexp">/etc/</span>neutron/dhcp_agent.ini&#123;,.bak&#125;<br>cat &gt;&gt; <span class="hljs-regexp">/etc/</span>neutron/dhcp_agent.ini &lt;&lt; EOF<br>[DEFAULT]<br>interface_driver = linuxbridge<br>dhcp_driver = neutron.agent.linux.dhcp.Dnsmasq<br>enable_isolated_metadata = true<br>EOF<br><br>----------------------<br>modprobe br_netfilter<br>cat &gt;&gt;<span class="hljs-regexp">/etc/</span>rc.sysinit&lt;&lt;EOF<br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> <span class="hljs-regexp">/etc/</span>sysconfig<span class="hljs-regexp">/modules/</span>*.modules ; <span class="hljs-keyword">do</span><br>[ -x <span class="hljs-variable">$file</span> ] &amp;&amp; <span class="hljs-variable">$file</span><br>done<br>EOF<br>echo <span class="hljs-string">&quot;modprobe br_netfilter&quot;</span> &gt;<span class="hljs-regexp">/etc/</span>sysconfig<span class="hljs-regexp">/modules/</span>br_netfilter.modules<br>chmod <span class="hljs-number">755</span> <span class="hljs-regexp">/etc/</span>sysconfig<span class="hljs-regexp">/modules/</span>br_netfilter.modules<br>sysctl -a | grep net.bridge.bridge-nf-call<br>----------------------<br>mv <span class="hljs-regexp">/etc/</span>neutron/metadata_agent.ini&#123;,.bak&#125;<br>cat &gt;&gt; <span class="hljs-regexp">/etc/</span>neutron/metadata_agent.ini &lt;&lt; EOF<br>[DEFAULT]<br>nova_metadata_host = controller-<span class="hljs-number">48</span><br>metadata_proxy_shared_secret = METADATA_SECRET<br><span class="hljs-comment"># METADATA_SECRET 为 元数据 的密钥</span><br>EOF<br><br>-------------------<br>cat &gt;&gt; <span class="hljs-regexp">/etc/</span>nova/nova.conf &lt;&lt; EOF<br><span class="hljs-comment">#追加在末尾</span><br>[neutron]<br>auth_url = http:<span class="hljs-regexp">//</span>controller-<span class="hljs-number">48</span>:<span class="hljs-number">5000</span><br>auth_type = password<br>project_domain_name = default<br>user_domain_name = default<br>region_name = RegionOne<br>project_name = service<br>username = neutron<br>password = NEUTRON_PASS<br>service_metadata_proxy = true<br>metadata_proxy_shared_secret = METADATA_SECRET<br><span class="hljs-comment"># NEUTRON_PASS  为 neutron 服务的密码</span><br><span class="hljs-comment"># METADATA_SECRET 为上边设置的元数据密钥</span><br>EOF<br><br>-------------------<br>ln -s <span class="hljs-regexp">/etc/</span>neutron<span class="hljs-regexp">/plugins/m</span>l2<span class="hljs-regexp">/ml2_conf.ini /</span>etc<span class="hljs-regexp">/neutron/</span>plugin.ini<br><br>su -s <span class="hljs-regexp">/bin/</span>sh -c <span class="hljs-string">&quot;neutron-db-manage --config-file /etc/neutron/neutron.conf --config-file /etc/neutron/plugins/ml2/ml2_conf.ini upgrade head&quot;</span> neutron<br><br>sudo ip route del default<br>sudo ip route add default via <span class="hljs-number">192.168</span>.<span class="hljs-number">48.2</span> dev ens33<br><span class="hljs-comment">#192.168.48.2为ens33网关</span><br><br>systemctl enable --now neutron-server.service neutron-linuxbridge-agent.service neutron-dhcp-agent.service neutron-metadata-agent.service neutron-l3-agent.service<br><br>systemctl status neutron-server.service  neutron-linuxbridge-agent.service neutron-dhcp-agent.service   neutron-metadata-agent.service  neutron-l3-agent.service<br><br></code></pre></td></tr></table></figure>

<h3 id="计算节点-1"><a href="#计算节点-1" class="headerlink" title="计算节点"></a>计算节点</h3><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs gradle">###compute计算节点<br>yum install openstack-neutron-linuxbridge ebtables ipset -y <br><br>mv <span class="hljs-regexp">/etc/</span>neutron/neutron.conf&#123;,.bak&#125;<br>cat &gt;&gt; <span class="hljs-regexp">/etc/</span>neutron/neutron.conf &lt;&lt; EOF<br>[<span class="hljs-keyword">DEFAULT</span>]<br>transport_url = rabbit:<span class="hljs-comment">//openstack:RABBIT_PASS@controller-48</span><br>#RABBIT_PASS为 控制节点 消息队列 密码<br>auth_strategy = keystone<br>[keystone_authtoken]<br>www_authenticate_uri = http:<span class="hljs-comment">//controller-48:5000</span><br>auth_url = http:<span class="hljs-comment">//controller-48:5000</span><br>memcached_servers = controller-<span class="hljs-number">48</span>:<span class="hljs-number">11211</span><br>auth_type = password<br>project_domain_name = <span class="hljs-keyword">default</span><br>user_domain_name = <span class="hljs-keyword">default</span><br>project_name = service<br>username = neutron<br>password = NEUTRON_PASS<br># NEUTRON_PASS  为控制节点 neutron 服务密码<br>[oslo_concurrency]<br>lock_path = <span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/neutron/</span>tmp<br>EOF<br><br>mv <span class="hljs-regexp">/etc/</span>neutron<span class="hljs-regexp">/plugins/m</span>l2/linuxbridge_agent.ini&#123;,.bak&#125;<br>cat &gt;&gt; <span class="hljs-regexp">/etc/</span>neutron<span class="hljs-regexp">/plugins/m</span>l2/linuxbridge_agent.ini &lt;&lt;EOF<br>[linux_bridge]<br>physical_interface_mappings = provider:ens36<br># ens36 为 第二块网卡名字<br>[vxlan]<br>enable_vxlan = <span class="hljs-keyword">true</span><br>local_ip = <span class="hljs-number">192.168</span>.<span class="hljs-number">48.20</span><br>l2_population = <span class="hljs-keyword">true</span><br># <span class="hljs-number">192.168</span>.<span class="hljs-number">48.20</span>  为 计算节点 管理网络的 IP 地址<br>[securitygroup]<br>enable_security_group = <span class="hljs-keyword">true</span><br>firewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver<br>EOF<br>-------------------<br>modprobe br_netfilter<br>cat &gt;&gt;<span class="hljs-regexp">/etc/</span>rc.sysinit&lt;&lt;EOF<br>#!<span class="hljs-regexp">/bin/</span>bash<br><span class="hljs-keyword">for</span> <span class="hljs-keyword">file</span> in <span class="hljs-regexp">/etc/</span>sysconfig<span class="hljs-regexp">/modules/</span>*.modules ; <span class="hljs-keyword">do</span><br>[ -x $<span class="hljs-keyword">file</span> ] &amp;&amp; $<span class="hljs-keyword">file</span><br>done<br>EOF<br>echo <span class="hljs-string">&quot;modprobe br_netfilter&quot;</span> &gt;<span class="hljs-regexp">/etc/</span>sysconfig<span class="hljs-regexp">/modules/</span>br_netfilter.modules<br>chmod <span class="hljs-number">755</span> <span class="hljs-regexp">/etc/</span>sysconfig<span class="hljs-regexp">/modules/</span>br_netfilter.modules<br>sysctl -a | <span class="hljs-keyword">grep</span> net.bridge.bridrge-nf-<span class="hljs-keyword">call</span><br>-------------------<br><br>systemctl enable neutron-linuxbridge-agent.service --now<br>systemctl restart openstack-nova-compute.service neutron-linuxbridge-agent.service<br>systemctl status neutron-linuxbridge-agent.service<br><br></code></pre></td></tr></table></figure>

<h3 id="控制节点验证-1"><a href="#控制节点验证-1" class="headerlink" title="控制节点验证"></a>控制节点验证</h3><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs gherkin"><span class="hljs-comment"># 验证</span><br><span class="hljs-comment"># 控制节点执行</span><br>source admin-openrc.sh<br>openstack network agent list<br><span class="hljs-comment">###等几分钟</span><br>[root<span class="hljs-meta">@controller-48</span> ~]<span class="hljs-comment"># openstack network agent list</span><br>+--------------------------------------+--------------------+---------------+-------------------+-------+-------+---------------------------+<br>|<span class="hljs-string"> ID                                   </span>|<span class="hljs-string"> Agent Type         </span>|<span class="hljs-string"> Host          </span>|<span class="hljs-string"> Availability Zone </span>|<span class="hljs-string"> Alive </span>|<span class="hljs-string"> State </span>|<span class="hljs-string"> Binary                    </span>|<br>+--------------------------------------+--------------------+---------------+-------------------+-------+-------+---------------------------+<br>|<span class="hljs-string"> 201870b9-aac0-4830-9788-03da13b125c7 </span>|<span class="hljs-string"> Metadata agent     </span>|<span class="hljs-string"> controller-48 </span>|<span class="hljs-string"> None              </span>|<span class="hljs-string"> :-)   </span>|<span class="hljs-string"> UP    </span>|<span class="hljs-string"> neutron-metadata-agent    </span>|<br>|<span class="hljs-string"> 55ae2391-4cd6-4cd1-bf4f-4465f1b561a1 </span>|<span class="hljs-string"> L3 agent           </span>|<span class="hljs-string"> controller-48 </span>|<span class="hljs-string"> nova              </span>|<span class="hljs-string"> :-)   </span>|<span class="hljs-string"> UP    </span>|<span class="hljs-string"> neutron-l3-agent          </span>|<br>|<span class="hljs-string"> bae3fe77-a005-4cdf-aee6-8cfe3cf918ba </span>|<span class="hljs-string"> Linux bridge agent </span>|<span class="hljs-string"> controller-48 </span>|<span class="hljs-string"> None              </span>|<span class="hljs-string"> :-)   </span>|<span class="hljs-string"> UP    </span>|<span class="hljs-string"> neutron-linuxbridge-agent </span>|<br>|<span class="hljs-string"> f0bd6fbc-2889-4558-80fa-8f2a08989b74 </span>|<span class="hljs-string"> Linux bridge agent </span>|<span class="hljs-string"> computer-48   </span>|<span class="hljs-string"> None              </span>|<span class="hljs-string"> :-)   </span>|<span class="hljs-string"> UP    </span>|<span class="hljs-string"> neutron-linuxbridge-agent </span>|<br>|<span class="hljs-string"> f5546196-9950-4c5a-b709-060a1bba5944 </span>|<span class="hljs-string"> DHCP agent         </span>|<span class="hljs-string"> controller-48 </span>|<span class="hljs-string"> nova              </span>|<span class="hljs-string"> :-)   </span>|<span class="hljs-string"> UP    </span>|<span class="hljs-string"> neutron-dhcp-agent        </span>|<br>+--------------------------------------+--------------------+---------------+-------------------+-------+-------+---------------------------+<br><br><span class="hljs-comment"># 确保以上五个 Agent 都为 :-) 及 UP</span><br><br></code></pre></td></tr></table></figure>

<h2 id="Horizon-Web管理页面"><a href="#Horizon-Web管理页面" class="headerlink" title="Horizon(Web管理页面)"></a>Horizon(Web管理页面)</h2><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs gradle">systemctl restart neutron* openstack-nova*<br>###控制节点<br>yum install openstack-dashboard -y<br>cp <span class="hljs-regexp">/etc/</span>openstack-dashboard/local_settings&#123;,.bak&#125;<br>#注释以下信息<br>sed -i <span class="hljs-string">&#x27;s/^ALLOWED_HOSTS/#&amp;/&#x27;</span> <span class="hljs-regexp">/etc/</span>openstack-dashboard/local_settings<br>sed -i <span class="hljs-string">&#x27;s/^OPENSTACK_HOST/#&amp;/&#x27;</span> <span class="hljs-regexp">/etc/</span>openstack-dashboard/local_settings<br>sed -i <span class="hljs-string">&#x27;s/^OPENSTACK_KEYSTONE_URL/#&amp;/&#x27;</span> <span class="hljs-regexp">/etc/</span>openstack-dashboard/local_settings<br>sed -i <span class="hljs-string">&#x27;s/^TIME_ZONE/#&amp;/&#x27;</span> <span class="hljs-regexp">/etc/</span>openstack-dashboard/local_settings<br><br>追加内容<br>cat &gt;&gt; <span class="hljs-regexp">/etc/</span>openstack-dashboard/local_settings &lt;&lt;EOF<br>ALLOWED_HOSTS = [<span class="hljs-string">&#x27;*&#x27;</span>]<br>SESSION_ENGINE = <span class="hljs-string">&#x27;django.contrib.sessions.backends.cache&#x27;</span><br>CACHES = &#123;<br>    <span class="hljs-string">&#x27;default&#x27;</span>: &#123;<br>         <span class="hljs-string">&#x27;BACKEND&#x27;</span>: <span class="hljs-string">&#x27;django.core.cache.backends.memcached.MemcachedCache&#x27;</span>,<br>         <span class="hljs-string">&#x27;LOCATION&#x27;</span>: <span class="hljs-string">&#x27;controller-48:11211&#x27;</span>,<br>    &#125;<br>&#125;<br>OPENSTACK_HOST = <span class="hljs-string">&quot;controller-48&quot;</span><br>OPENSTACK_KEYSTONE_URL = <span class="hljs-string">&quot;http://%s:5000/identity/v3&quot;</span> % OPENSTACK_HOST<br>OPENSTACK_KEYSTONE_MULTIDOMAIN_SUPPORT = <span class="hljs-keyword">True</span><br>OPENSTACK_API_VERSIONS = &#123;<br>    <span class="hljs-string">&quot;identity&quot;</span>: <span class="hljs-number">3</span>,<br>    <span class="hljs-string">&quot;image&quot;</span>: <span class="hljs-number">2</span>,<br>    <span class="hljs-string">&quot;volume&quot;</span>: <span class="hljs-number">3</span>,<br>&#125;<br>OPENSTACK_KEYSTONE_DEFAULT_DOMAIN = <span class="hljs-string">&quot;Default&quot;</span><br>OPENSTACK_KEYSTONE_DEFAULT_ROLE = <span class="hljs-string">&quot;user&quot;</span><br>TIME_ZONE = <span class="hljs-string">&quot;Asia/Shanghai&quot;</span><br># 有则修改没有则添加<br>EOF<br><br>cp <span class="hljs-regexp">/etc/</span>httpd<span class="hljs-regexp">/conf.d/</span>openstack-dashboard.conf&#123;,.bak&#125;<br>cat &gt;&gt; <span class="hljs-regexp">/etc/</span>httpd<span class="hljs-regexp">/conf.d/</span>openstack-dashboard.conf &lt;&lt; EOF<br>WSGIApplicationGroup %&#123;GLOBAL&#125;<br>EOF<br>------------------------------------------------------------------------------------<br>#把下面所有文件里面有WEBROOT = <span class="hljs-string">&#x27;/&#x27;</span> 中的 <span class="hljs-regexp">/ 改成 /</span>dashboard<br>sed -i.bak <span class="hljs-string">&quot;s#WEBROOT\s*=.*#WEBROOT = &#x27;/dashboard&#x27;#&quot;</span> <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/openstack-dashboard/</span>openstack_dashboard/defaults.py<br>sed -i.bak <span class="hljs-string">&quot;s#WEBROOT\s*=.*#WEBROOT = &#x27;/dashboard&#x27;#&quot;</span>  <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/openstack-dashboard/</span>openstack_dashboard<span class="hljs-regexp">/test/</span>settings.py<br>sed -i.bak <span class="hljs-string">&#x27;s|WEBROOT\s*=.*|WEBROOT = &quot;/dashboard&quot;|&#x27;</span> <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/openstack-dashboard/</span><span class="hljs-keyword">static</span><span class="hljs-regexp">/dashboard/</span>js/<span class="hljs-number">1453</span>ede06e9f.js<br>#如果第三条不行，注意一下<span class="hljs-number">1453</span>ede06e9f.js是否存在，若不存在，则看下面三个文件中有WEBROOT = <span class="hljs-string">&#x27;/&#x27;</span>替换文件名即可<br>[root@controller-<span class="hljs-number">48</span> ~]# cd <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/openstack-dashboard/</span><span class="hljs-keyword">static</span><span class="hljs-regexp">/dashboard/</span>js/<br>[root@controller-<span class="hljs-number">48</span> js]# ll<br>total <span class="hljs-number">2472</span>   #以下几个文件也要改 ，我这里就一个文件有<br>-rw-r--r-- <span class="hljs-number">1</span> root root  <span class="hljs-number">606959</span> May <span class="hljs-number">17</span>  <span class="hljs-number">2021</span> <span class="hljs-number">1453</span>ede06e9f.js<br>-rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">1659039</span> May <span class="hljs-number">17</span>  <span class="hljs-number">2021</span> b5e88d434bd1.js<br>-rw-r--r-- <span class="hljs-number">1</span> root root  <span class="hljs-number">254022</span> May <span class="hljs-number">17</span>  <span class="hljs-number">2021</span> eb687af7228a.js<br>------------------------------------------------------------------------------------<br>systemctl restart httpd memcached<br>systemctl status httpd memcached<br><br><br># 验证<br># 访问 http:<span class="hljs-comment">//192.168.48.10/dashboard  （控制节点ip）</span><br># 登录用户密码 可使用 admin 或 user_dog<br># 域名 使用 <span class="hljs-keyword">Default</span><br></code></pre></td></tr></table></figure>

<p><img src="/../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/bf319a6ff702ffea01d5eb18616705db479b66b2-1709275202730-28.png" srcset="/img/loading.gif" lazyload alt="image-20230402220424221"></p>
<h2 id="cinder（块存储服务）"><a href="#cinder（块存储服务）" class="headerlink" title="cinder（块存储服务）"></a>cinder（块存储服务）</h2><h3 id="控制节点-2"><a href="#控制节点-2" class="headerlink" title="控制节点"></a>控制节点</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment">###控制节点</span><br>mysql -u root -pMARIADB_PASS<br>CREATE DATABASE cinder;<br>GRANT ALL PRIVILEGES ON cinder.* TO <span class="hljs-string">&#x27;cinder&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> \<br>  IDENTIFIED BY <span class="hljs-string">&#x27;CINDER_DBPASS&#x27;</span>;<br>GRANT ALL PRIVILEGES ON cinder.* TO <span class="hljs-string">&#x27;cinder&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> \<br>  IDENTIFIED BY <span class="hljs-string">&#x27;CINDER_DBPASS&#x27;</span>;<br><span class="hljs-keyword">exit</span><br><span class="hljs-comment"># CINDER_DBPASS 为 cinder 数据库账户密码</span><br>source admin-openrc.sh<br>openstack user create --domain default --password CINDER_PASS cinder<br>openstack role add --project service --user cinder admin<br>  openstack service create --name cinderv3 \<br>  --description <span class="hljs-string">&quot;OpenStack Block Storage&quot;</span> volumev3<br>openstack endpoint create --region RegionOne \<br>  volumev3 public http:<span class="hljs-regexp">//</span>controller-<span class="hljs-number">48</span>:<span class="hljs-number">8776</span><span class="hljs-regexp">/v3/</span>%\(project_id\)s<br>openstack endpoint create --region RegionOne \<br>  volumev3 internal http:<span class="hljs-regexp">//</span>controller-<span class="hljs-number">48</span>:<span class="hljs-number">8776</span><span class="hljs-regexp">/v3/</span>%\(project_id\)s<br>openstack endpoint create --region RegionOne \<br>  volumev3 admin http:<span class="hljs-regexp">//</span>controller-<span class="hljs-number">48</span>:<span class="hljs-number">8776</span><span class="hljs-regexp">/v3/</span>%\(project_id\)s<br><br>yum install openstack-cinder -y<br>mv <span class="hljs-regexp">/etc/</span>cinder/cinder.conf&#123;,.bak&#125;<br>cat &gt;&gt; <span class="hljs-regexp">/etc/</span>cinder/cinder.conf &lt;&lt; EOF<br>[DEFAULT]<br>transport_url = rabbit:<span class="hljs-regexp">//</span>openstack:RABBIT_PASS@controller-<span class="hljs-number">48</span><br>auth_strategy = keystone<br>my_ip = <span class="hljs-number">192.168</span>.<span class="hljs-number">48.10</span><br><span class="hljs-comment"># 控制节点管理网络 IP</span><br>[database]<br>connection = mysql+pymysql:<span class="hljs-regexp">//</span>cinder:CINDER_DBPASS@controller-<span class="hljs-number">48</span>/cinder<br><span class="hljs-comment"># CINDER_DBPASS 为数据库 Cinder 账户密码</span><br>[keystone_authtoken]<br>www_authenticate_uri = http:<span class="hljs-regexp">//</span>controller-<span class="hljs-number">48</span>:<span class="hljs-number">5000</span><br>auth_url = http:<span class="hljs-regexp">//</span>controller-<span class="hljs-number">48</span>:<span class="hljs-number">5000</span><br>memcached_servers = controller-<span class="hljs-number">48</span>:<span class="hljs-number">11211</span><br>auth_type = password<br>project_domain_name = default<br>user_domain_name = default<br>project_name = service<br>username = cinder<br>password = CINDER_PASS<br><span class="hljs-comment"># CINDER_PASS 为 Cinder 服务密码</span><br>[oslo_concurrency]<br>lock_path = <span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/cinder/</span>tmp<br>EOF<br><br>su -s <span class="hljs-regexp">/bin/</span>sh -c <span class="hljs-string">&quot;cinder-manage db sync&quot;</span> cinder<br><br>cat &gt;&gt; <span class="hljs-regexp">/etc/</span>nova/nova.conf &lt;&lt; EOF<br>[cinder]<br>os_region_name = RegionOne<br>EOF<br><br>systemctl restart openstack-nova-api.service<br>systemctl status openstack-nova-api.service<br>systemctl enable --now openstack-cinder-api.service openstack-cinder-scheduler.service<br>systemctl status openstack-cinder-api.service openstack-cinder-scheduler.service<br><br></code></pre></td></tr></table></figure>

<h3 id="计算节点-2"><a href="#计算节点-2" class="headerlink" title="计算节点"></a>计算节点</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment">###computer-48节点</span><br><br>添加一块物理磁盘<br>[root@computer-<span class="hljs-number">48</span> ~]<span class="hljs-comment"># lsblk</span><br>NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT<br>sda               <span class="hljs-number">8</span>:<span class="hljs-number">0</span>    <span class="hljs-number">0</span>  <span class="hljs-number">100</span>G  <span class="hljs-number">0</span> disk<br>├─sda1            <span class="hljs-number">8</span>:<span class="hljs-number">1</span>    <span class="hljs-number">0</span>    <span class="hljs-number">1</span>G  <span class="hljs-number">0</span> part /boot<br>└─sda2            <span class="hljs-number">8</span>:<span class="hljs-number">2</span>    <span class="hljs-number">0</span>   <span class="hljs-number">99</span>G  <span class="hljs-number">0</span> part<br>  ├─centos-root <span class="hljs-number">253</span>:<span class="hljs-number">0</span>    <span class="hljs-number">0</span>   <span class="hljs-number">50</span>G  <span class="hljs-number">0</span> lvm  /<br>  ├─centos-swap <span class="hljs-number">253</span>:<span class="hljs-number">1</span>    <span class="hljs-number">0</span>  <span class="hljs-number">3.6</span>G  <span class="hljs-number">0</span> lvm  [SWAP]<br>  └─centos-home <span class="hljs-number">253</span>:<span class="hljs-number">2</span>    <span class="hljs-number">0</span> <span class="hljs-number">45.4</span>G  <span class="hljs-number">0</span> lvm  /home<br>sdb               <span class="hljs-number">8</span>:<span class="hljs-number">16</span>   <span class="hljs-number">0</span>  <span class="hljs-number">100</span>G  <span class="hljs-number">0</span> disk<br>sr0              <span class="hljs-number">11</span>:<span class="hljs-number">0</span>    <span class="hljs-number">1</span> <span class="hljs-number">1024</span>M  <span class="hljs-number">0</span> rom<br><br>yum install lvm2 device-mapper-persistent-data -y<br>systemctl enable lvm2-lvmetad.service --now<br><span class="hljs-comment"># 如显示不存在则说明系统默认安装了 lvm  以上步骤可忽略</span><br><br><span class="hljs-comment">#创建/dev/sdb卷组</span><br>pvcreate <span class="hljs-regexp">/dev/</span>sdb<br><span class="hljs-comment"># Physical volume &quot;/dev/sdb&quot; successfully created.</span><br><br>vgcreate cinder-volumes <span class="hljs-regexp">/dev/</span>sdb<br><span class="hljs-comment"># Volume group &quot;cinder-volumes&quot; successfully created</span><br><span class="hljs-comment"># sdb 为划分给块存储使用的磁盘</span><br><span class="hljs-comment"># 如有多个磁盘，则需重复以上两个命令</span><br><br><br>cp <span class="hljs-regexp">/etc/</span>lvm/lvm.conf&#123;,.bak&#125;<br>sed -i <span class="hljs-string">&#x27;130 a\filter = [ &quot;a/sdb/&quot;,&quot;r/.*/&quot;]&#x27;</span> <span class="hljs-regexp">/etc/</span>lvm/lvm.conf<br><span class="hljs-comment">#sdb是上面添加的新的物理磁盘</span><br><span class="hljs-comment"># 如有多个磁盘，则将磁盘编号以固定格式添加到过滤设备中，例如有两个磁盘 sdb sdc ，则为 filter = [ &quot;a/sdb/&quot;, &quot;a/sdc/&quot;,&quot;r/.*/&quot;]</span><br><br><br>yum install openstack-cinder targetcli python-keystone -y<br>mv <span class="hljs-regexp">/etc/</span>cinder/cinder.conf&#123;,.bak&#125;<br>cat &gt;&gt; <span class="hljs-regexp">/etc/</span>cinder/cinder.conf &lt;&lt; EOF<br>[DEFAULT]<br>transport_url = rabbit:<span class="hljs-regexp">//</span>openstack:RABBIT_PASS@controller-<span class="hljs-number">48</span><br>auth_strategy = keystone<br>my_ip = <span class="hljs-number">192.168</span>.<span class="hljs-number">48.20</span><br>enabled_backends = lvm<br>glance_api_servers = http:<span class="hljs-regexp">//</span>controller-<span class="hljs-number">48</span>:<span class="hljs-number">9292</span><br><span class="hljs-comment"># 192.168.48.20  为块存储节点 computer-48管理网络 的接口IP</span><br>[database]<br>connection = mysql+pymysql:<span class="hljs-regexp">//</span>cinder:CINDER_DBPASS@controller-<span class="hljs-number">48</span>/cinder<br><span class="hljs-comment"># CINDER_DBPASS 为数据库 Cinder 账户密码</span><br>[keystone_authtoken]<br>www_authenticate_uri = http:<span class="hljs-regexp">//</span>controller-<span class="hljs-number">48</span>:<span class="hljs-number">5000</span><br>auth_url = http:<span class="hljs-regexp">//</span>controller-<span class="hljs-number">48</span>:<span class="hljs-number">5000</span><br>memcached_servers = controller-<span class="hljs-number">48</span>:<span class="hljs-number">11211</span><br>auth_type = password<br>project_domain_name = default<br>user_domain_name = default<br>project_name = service<br>username = cinder<br>password = CINDER_PASS<br><span class="hljs-comment"># CINDER_PASS 为 cinder 数据库账户密码</span><br>[lvm]<br>volume_driver = cinder.volume.drivers.lvm.LVMVolumeDriver<br>volume_group = cinder-volumes<br>target_protocol = iscsi<br>target_helper = lioadm<br><span class="hljs-comment"># [lvm]  没有则新建</span><br>[oslo_concurrency]<br>lock_path = <span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/cinder/</span>tmp<br>EOF<br><br>systemctl enable openstack-cinder-volume.service target.service --now<br>systemctl status openstack-cinder-volume.service target.service<br><br></code></pre></td></tr></table></figure>

<h3 id="控制节点验证-2"><a href="#控制节点验证-2" class="headerlink" title="控制节点验证"></a>控制节点验证</h3><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs gherkin"><span class="hljs-comment"># 验证</span><br><span class="hljs-comment"># 控制节点执行</span><br>source admin-openrc.sh<br>openstack volume service list<br>systemctl restart httpd memcached<br>[root<span class="hljs-meta">@controller-48</span> ~]<span class="hljs-comment"># openstack volume service list</span><br>+------------------+-------------+------+---------+-------+----------------------------+<br>|<span class="hljs-string"> Binary           </span>|<span class="hljs-string"> Host        </span>|<span class="hljs-string"> Zone </span>|<span class="hljs-string"> Status  </span>|<span class="hljs-string"> State </span>|<span class="hljs-string"> Updated At                 </span>|<br>+------------------+-------------+------+---------+-------+----------------------------+<br>|<span class="hljs-string"> cinder-scheduler </span>|<span class="hljs-string"> controller-48  </span>|<span class="hljs-string"> nova </span>|<span class="hljs-string"> enabled </span>|<span class="hljs-string"> up    </span>|<span class="hljs-string"> 2023-05-24T08:24:18.000000 </span>|<br>|<span class="hljs-string"> cinder-volume    </span>|<span class="hljs-string"> computer-48@lvm </span>|<span class="hljs-string"> nova </span>|<span class="hljs-string"> enabled </span>|<span class="hljs-string"> up    </span>|<span class="hljs-string"> 2023-05-24T08:24:17.000000 </span>|<br>+------------------+-------------+------+---------+-------+----------------------------+<br><br></code></pre></td></tr></table></figure>



<h2 id="Swift（对象存储）"><a href="#Swift（对象存储）" class="headerlink" title="Swift（对象存储）"></a>Swift（对象存储）</h2><h3 id="控制节点-3"><a href="#控制节点-3" class="headerlink" title="控制节点"></a>控制节点</h3><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-comment">###控制节点</span><br>source admin-openrc.sh<br>openstack user create --domain default --password SWIFT_PASS swift<br>openstack role add --project service --user swift admin<br><span class="hljs-comment">#创建swift服务实体：</span><br>openstack service create --name swift \<br>  --description <span class="hljs-string">&quot;OpenStack Object Storage&quot;</span> object-store<br><span class="hljs-comment">#创建swift服务实体：</span><br>openstack endpoint create --region RegionOne \<br>object-store public http://controller-48:8080/v1/AUTH_%\(project_id\)s<br><br>openstack endpoint create --region RegionOne \<br>object-store internal http://controller-48:8080/v1/AUTH_%\(project_id\)s<br><br>openstack endpoint create --region RegionOne \<br>object-store admin http://controller-48:8080/v1<br><br><span class="hljs-comment">#安装swift组件</span><br>yum install -y openstack-swift-proxy python-swiftclient \<br>  python-keystoneclient python-keystonemiddleware \<br>  Memcached<br><br>mv /etc/swift/proxy-server.conf&#123;,.bak&#125;<br>cat&gt; /etc/swift/proxy-server.conf&lt;&lt;EOF<br>[DEFAULT]<br>bind_ip = 0.0.0.0<br>bind_port = 8080<br>user = swift<br><span class="hljs-section">[pipeline:main]</span><br>pipeline = catch_errors gatekeeper healthcheck proxy-logging cache container_sync bulk ratelimit authtoken keystoneauth container-quotas account-quotas slo dlo versioned_writes proxy-logging proxy-server<br><span class="hljs-section">[app:proxy-server]</span><br>use = egg:swift<span class="hljs-comment">#proxy</span><br>allow_account_management = true<br>account_autocreate = true<br><span class="hljs-comment">#Keystone auth info</span><br><span class="hljs-section">[filter:authtoken]</span><br>paste.filter_factory = keystonemiddleware.auth_token:filter_factory<br>www_authenticate_uri = http://controller-48:5000<br>auth_url = http://controller-48:5000/v3<br>memcached_servers = controller-48:11211<br>auth_type = password<br>project_domain_name = default<br>user_domain_name = default<br>project_name = service<br>username = swift<br>password = SWIFT_PASS<br>delay_auth_decision = true<br>service_token_roles_required = True<br><span class="hljs-section">[filter:keystoneauth]</span><br>use = egg:swift<span class="hljs-comment">#keystoneauth</span><br>operator_roles = admin,user<br><span class="hljs-section">[filter:healthcheck]</span><br>use = egg:swift<span class="hljs-comment">#healthcheck</span><br><span class="hljs-section">[filter:cache]</span><br>use = egg:swift<span class="hljs-comment">#memcache</span><br>memcache_servers = controller-48:11211<br><span class="hljs-section">[filter:ratelimit]</span><br>use = egg:swift<span class="hljs-comment">#ratelimit</span><br><span class="hljs-section">[filter:domain_remap]</span><br>use = egg:swift<span class="hljs-comment">#domain_remap</span><br><span class="hljs-section">[filter:catch_errors]</span><br>use = egg:swift<span class="hljs-comment">#catch_errors</span><br><span class="hljs-section">[filter:cname_lookup]</span><br>use = egg:swift<span class="hljs-comment">#cname_lookup</span><br><span class="hljs-section">[filter:staticweb]</span><br>use = egg:swift<span class="hljs-comment">#staticweb</span><br><span class="hljs-section">[filter:tempurl]</span><br>use = egg:swift<span class="hljs-comment">#tempurl</span><br><span class="hljs-section">[filter:formpost]</span><br>use = egg:swift<span class="hljs-comment">#formpost</span><br><span class="hljs-section">[filter:name_check]</span><br>use = egg:swift<span class="hljs-comment">#name_check</span><br><span class="hljs-section">[filter:list-endpoints]</span><br>use = egg:swift<span class="hljs-comment">#list_endpoints</span><br><span class="hljs-section">[filter:proxy-logging]</span><br>use = egg:swift<span class="hljs-comment">#proxy_logging</span><br><span class="hljs-section">[filter:bulk]</span><br>use = egg:swift<span class="hljs-comment">#bulk</span><br><span class="hljs-section">[filter:slo]</span><br>use = egg:swift<span class="hljs-comment">#slo</span><br><span class="hljs-section">[filter:dlo]</span><br>use = egg:swift<span class="hljs-comment">#dlo</span><br><span class="hljs-section">[filter:container-quotas]</span><br>use = egg:swift<span class="hljs-comment">#container_quotas</span><br><span class="hljs-section">[filter:account-quotas]</span><br>use = egg:swift<span class="hljs-comment">#account_quotas</span><br><span class="hljs-section">[filter:gatekeeper]</span><br>use = egg:swift<span class="hljs-comment">#gatekeeper</span><br><span class="hljs-section">[filter:container_sync]</span><br>use = egg:swift<span class="hljs-comment">#container_sync</span><br><span class="hljs-section">[filter:xprofile]</span><br>use = egg:swift<span class="hljs-comment">#xprofile</span><br><span class="hljs-section">[filter:versioned_writes]</span><br>use = egg:swift<span class="hljs-comment">#versioned_writes</span><br>EOF<br></code></pre></td></tr></table></figure>

<h3 id="computer-48"><a href="#computer-48" class="headerlink" title="computer-48"></a>computer-48</h3><p>添加4张硬盘</p>
<p><img src="/../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/65a2b757e9272dea0844d5ed3b29915a881521da-1709275202730-29.png" srcset="/img/loading.gif" lazyload alt="image-20230527155112604"></p>
<p><img src="/../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/9f33d320e2c43241ab5a4c74f10441445310ecd2-1709275202730-30.png" srcset="/img/loading.gif" lazyload alt="image-20230524083115643"></p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment">#conpute节点</span><br>yum install xfsprogs rsync -y<br><br>lsblk<br><span class="hljs-comment">#将/dev/sdb和/dev/sdc设备格式化为XFS：</span><br>mkfs.xfs <span class="hljs-regexp">/dev/</span>sdc<br>mkfs.xfs <span class="hljs-regexp">/dev/</span>sdd<br>mkfs.xfs <span class="hljs-regexp">/dev/</span>sde<br>mkfs.xfs <span class="hljs-regexp">/dev/</span>sdf<br><span class="hljs-comment">#创建安装点目录结构：</span><br>mkdir -p <span class="hljs-regexp">/srv/</span>node/sdc<br>mkdir -p <span class="hljs-regexp">/srv/</span>node/sdd<br>mkdir -p <span class="hljs-regexp">/srv/</span>node/sde<br>mkdir -p <span class="hljs-regexp">/srv/</span>node/sdf<br><br>cat &gt;&gt; <span class="hljs-regexp">/etc/</span>fstab &lt;&lt; EOF<br><span class="hljs-regexp">/dev/</span>sdc <span class="hljs-regexp">/srv/</span>node/sdc xfs noatime,nodiratime,nobarrier,logbufs=<span class="hljs-number">8</span> <span class="hljs-number">0</span> <span class="hljs-number">2</span><br><span class="hljs-regexp">/dev/</span>sdd <span class="hljs-regexp">/srv/</span>node/sdd xfs noatime,nodiratime,nobarrier,logbufs=<span class="hljs-number">8</span> <span class="hljs-number">0</span> <span class="hljs-number">2</span><br><span class="hljs-regexp">/dev/</span>sdc <span class="hljs-regexp">/srv/</span>node/sde xfs noatime,nodiratime,nobarrier,logbufs=<span class="hljs-number">8</span> <span class="hljs-number">0</span> <span class="hljs-number">2</span><br><span class="hljs-regexp">/dev/</span>sdd <span class="hljs-regexp">/srv/</span>node/sdf xfs noatime,nodiratime,nobarrier,logbufs=<span class="hljs-number">8</span> <span class="hljs-number">0</span> <span class="hljs-number">2</span><br>EOF<br><br><span class="hljs-comment">#安装设备</span><br>mount <span class="hljs-regexp">/srv/</span>node/sdc<br>mount <span class="hljs-regexp">/srv/</span>node/sdd<br>mount <span class="hljs-regexp">/srv/</span>node/sde<br>mount <span class="hljs-regexp">/srv/</span>node/sdf<br><br>cat&gt;<span class="hljs-regexp">/etc/</span>rsyncd.conf&lt;&lt;EOF<br>uid = swift<br>gid = swift<br>log file = <span class="hljs-regexp">/var/</span>log/rsyncd.log<br>pid file = <span class="hljs-regexp">/var/</span>run/rsyncd.pid<br>address = <span class="hljs-number">192.168</span>.<span class="hljs-number">148.20</span><br><br>[account]<br>max connections = <span class="hljs-number">2</span><br>path = <span class="hljs-regexp">/srv/</span>node/<br>read only = False<br>lock file = <span class="hljs-regexp">/var/</span>lock/account.lock<br><br>[container]<br>max connections = <span class="hljs-number">2</span><br>path = <span class="hljs-regexp">/srv/</span>node/<br>read only = False<br>lock file = <span class="hljs-regexp">/var/</span>lock/container.lock<br><br>[object]<br>max connections = <span class="hljs-number">2</span><br>path = <span class="hljs-regexp">/srv/</span>node/<br>read only = False<br>lock file = <span class="hljs-regexp">/var/</span>lock/object.lock<br>EOF<br><br><span class="hljs-comment">#重启服务</span><br>systemctl enable rsyncd.service<br>systemctl start rsyncd.service<br><br><span class="hljs-comment">#安装swift组件</span><br>yum install -y openstack-swift-account openstack-swift-container \<br>  openstack-swift-object<br>  <br>mv <span class="hljs-regexp">/etc/</span>swift/account-server.conf&#123;,.bak&#125;<br>cat&gt; <span class="hljs-regexp">/etc/</span>swift/account-server.conf&lt;&lt;EOF<br>[DEFAULT]<br>bind_ip = <span class="hljs-number">192.168</span>.<span class="hljs-number">148.20</span><br>bind_port = <span class="hljs-number">6202</span><br>user = swift<br>swift_dir = <span class="hljs-regexp">/etc/</span>swift<br>devices = <span class="hljs-regexp">/srv/</span>node<br>mount_check = true<br>[pipeline:main]<br>pipeline = healthcheck recon account-server<br>[app:account-server]<br>use = egg:swift<span class="hljs-comment">#account</span><br>[filter:healthcheck]<br>use = egg:swift<span class="hljs-comment">#healthcheck</span><br>[filter:recon]<br>use = egg:swift<span class="hljs-comment">#recon</span><br>recon_cache_path = <span class="hljs-regexp">/var/</span>cache/swift<br>[account-replicator]<br>[account-auditor]<br>[account-reaper]<br>[filter:xprofile]<br>use = egg:swift<span class="hljs-comment">#xprofile</span><br>EOF<br><br>mv <span class="hljs-regexp">/etc/</span>swift/container-server.conf&#123;,.bak&#125;<br>cat&gt; <span class="hljs-regexp">/etc/</span>swift/container-server.conf&lt;&lt;EOF<br>[DEFAULT]<br>bind_ip = <span class="hljs-number">192.168</span>.<span class="hljs-number">148.20</span><br>bind_port = <span class="hljs-number">6201</span><br>user = swift<br>swift_dir = <span class="hljs-regexp">/etc/</span>swift<br>devices = <span class="hljs-regexp">/srv/</span>node<br>mount_check = true<br>[pipeline:main]<br>pipeline = healthcheck recon container-server<br>[app:container-server]<br>use = egg:swift<span class="hljs-comment">#container</span><br>[filter:healthcheck]<br>use = egg:swift<span class="hljs-comment">#healthcheck</span><br>[filter:recon]<br>use = egg:swift<span class="hljs-comment">#recon</span><br>[container-replicator]<br>[container-updater]<br>[container-auditor]<br>[container-sync]<br>[filter:xprofile]<br>use = egg:swift<span class="hljs-comment">#xprofile</span><br>[container-sharder]<br>EOF<br><br>mv <span class="hljs-regexp">/etc/</span>swift/object-server.conf&#123;,.bak&#125;<br>cat&gt; <span class="hljs-regexp">/etc/</span>swift/object-server.conf&lt;&lt;EOF<br>[DEFAULT]<br>bind_ip = <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span><br>bind_port = <span class="hljs-number">6200</span><br>user = swift<br>swift_dir = <span class="hljs-regexp">/etc/</span>swift<br>devices = <span class="hljs-regexp">/srv/</span>node<br>mount_check = true<br>[pipeline:main]<br>pipeline = healthcheck recon object-server<br>[app:object-server]<br>use = egg:swift<span class="hljs-comment">#object</span><br>recon_cache_path = <span class="hljs-regexp">/var/</span>cache/swift<br>recon_lock_path = <span class="hljs-regexp">/var/</span>lock<br>[filter:healthcheck]<br>use = egg:swift<span class="hljs-comment">#healthcheck</span><br>[filter:recon]<br>use = egg:swift<span class="hljs-comment">#recon</span><br>[object-replicator]<br>[object-reconstructor]<br>[object-updater]<br>[object-expirer]<br>[filter:xprofile]<br>use = egg:swift<span class="hljs-comment">#xprofile</span><br>[object-relinker]<br>[object-auditor]<br>log_name = object-auditor<br>log_facility = LOG_LOCAL0<br>log_level = INFO<br>log_address=<span class="hljs-regexp">/dev/</span>log   <br>EOF<br><span class="hljs-comment">#确保对安装点目录结构拥有适当的所有权：</span><br>chown -R swift:swift <span class="hljs-regexp">/srv/</span>node<br><br><span class="hljs-comment">#创建recon目录并确保对其拥有适当的所有权：</span><br> mkdir -p <span class="hljs-regexp">/var/</span>cache/swift<br> chown -R root:swift <span class="hljs-regexp">/var/</span>cache/swift<br> chmod -R <span class="hljs-number">775</span> <span class="hljs-regexp">/var/</span>cache/swift<br> <br><span class="hljs-comment"># 在防火墙中启用必要的访问(实验忽略)</span><br>firewall-cmd --permanent --add-port=<span class="hljs-number">6200</span>/tcp<br>firewall-cmd --permanent --add-port=<span class="hljs-number">6201</span>/tcp<br>firewall-cmd --permanent --add-port=<span class="hljs-number">6202</span>/tcp<br><br></code></pre></td></tr></table></figure>

<h3 id="创建和分发初始环-controller-48"><a href="#创建和分发初始环-controller-48" class="headerlink" title="创建和分发初始环 controller-48"></a>创建和分发初始环 controller-48</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs stylus">#控制节点<br>转到/etc/swift目录。(所以操作在此目录，执行)<br>创建用户环account.builder文件：<br>cd /etc/swift<br>##第一部分（<span class="hljs-number">6202</span>）创建用户环<br>swift-ring-builder account<span class="hljs-selector-class">.builder</span> create <span class="hljs-number">10</span> <span class="hljs-number">3</span> <span class="hljs-number">1</span><br>swift-ring-builder account<span class="hljs-selector-class">.builder</span> add \<br>   <span class="hljs-attr">--region</span> <span class="hljs-number">1</span> <span class="hljs-attr">--zone</span> <span class="hljs-number">1</span> <span class="hljs-attr">--ip</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">148.20</span> <span class="hljs-attr">--port</span> <span class="hljs-number">6202</span> <span class="hljs-attr">--device</span> sdc <span class="hljs-attr">--weight</span> <span class="hljs-number">100</span><br>swift-ring-builder account<span class="hljs-selector-class">.builder</span> add \<br>   <span class="hljs-attr">--region</span> <span class="hljs-number">1</span> <span class="hljs-attr">--zone</span> <span class="hljs-number">1</span> <span class="hljs-attr">--ip</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">148.20</span> <span class="hljs-attr">--port</span> <span class="hljs-number">6202</span> <span class="hljs-attr">--device</span> sdd <span class="hljs-attr">--weight</span> <span class="hljs-number">100</span><br>swift-ring-builder account<span class="hljs-selector-class">.builder</span> add \<br>   <span class="hljs-attr">--region</span> <span class="hljs-number">1</span> <span class="hljs-attr">--zone</span> <span class="hljs-number">2</span> <span class="hljs-attr">--ip</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">148.20</span> <span class="hljs-attr">--port</span> <span class="hljs-number">6202</span> <span class="hljs-attr">--device</span> sde <span class="hljs-attr">--weight</span> <span class="hljs-number">100</span><br>swift-ring-builder account<span class="hljs-selector-class">.builder</span> add \<br>   <span class="hljs-attr">--region</span> <span class="hljs-number">1</span> <span class="hljs-attr">--zone</span> <span class="hljs-number">2</span> <span class="hljs-attr">--ip</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">148.20</span> <span class="hljs-attr">--port</span> <span class="hljs-number">6202</span> <span class="hljs-attr">--device</span> sdf <span class="hljs-attr">--weight</span> <span class="hljs-number">100</span><br>swift-ring-builder account<span class="hljs-selector-class">.builder</span><br>##重新平衡环且验证<br>swift-ring-builder account<span class="hljs-selector-class">.builder</span> rebalance<br>swift-ring-builder account<span class="hljs-selector-class">.builder</span><br><br><br>##第二部分（<span class="hljs-number">6201</span>）创建容器环<br>swift-ring-builder container<span class="hljs-selector-class">.builder</span> create <span class="hljs-number">10</span> <span class="hljs-number">3</span> <span class="hljs-number">1</span><br>swift-ring-builder container<span class="hljs-selector-class">.builder</span> add \<br>   <span class="hljs-attr">--region</span> <span class="hljs-number">1</span> <span class="hljs-attr">--zone</span> <span class="hljs-number">1</span> <span class="hljs-attr">--ip</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">148.20</span> <span class="hljs-attr">--port</span> <span class="hljs-number">6201</span> <span class="hljs-attr">--device</span> sdc <span class="hljs-attr">--weight</span> <span class="hljs-number">100</span><br>swift-ring-builder container<span class="hljs-selector-class">.builder</span> add \<br>   <span class="hljs-attr">--region</span> <span class="hljs-number">1</span> <span class="hljs-attr">--zone</span> <span class="hljs-number">1</span> <span class="hljs-attr">--ip</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">148.20</span> <span class="hljs-attr">--port</span> <span class="hljs-number">6201</span> <span class="hljs-attr">--device</span> sdd <span class="hljs-attr">--weight</span> <span class="hljs-number">100</span><br>swift-ring-builder container<span class="hljs-selector-class">.builder</span> add \<br>   <span class="hljs-attr">--region</span> <span class="hljs-number">1</span> <span class="hljs-attr">--zone</span> <span class="hljs-number">2</span> <span class="hljs-attr">--ip</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">148.20</span> <span class="hljs-attr">--port</span> <span class="hljs-number">6201</span> <span class="hljs-attr">--device</span> sde <span class="hljs-attr">--weight</span> <span class="hljs-number">100</span><br>swift-ring-builder container<span class="hljs-selector-class">.builder</span> add \<br>   <span class="hljs-attr">--region</span> <span class="hljs-number">1</span> <span class="hljs-attr">--zone</span> <span class="hljs-number">2</span> <span class="hljs-attr">--ip</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">148.20</span> <span class="hljs-attr">--port</span> <span class="hljs-number">6201</span> <span class="hljs-attr">--device</span> sdf <span class="hljs-attr">--weight</span> <span class="hljs-number">100</span><br>swift-ring-builder container<span class="hljs-selector-class">.builder</span><br>swift-ring-builder container<span class="hljs-selector-class">.builder</span> rebalance<br><br>##第三部分（<span class="hljs-number">6200</span>）创建对象环<br>swift-ring-builder <span class="hljs-selector-tag">object</span><span class="hljs-selector-class">.builder</span> create <span class="hljs-number">10</span> <span class="hljs-number">3</span> <span class="hljs-number">1</span><br>swift-ring-builder <span class="hljs-selector-tag">object</span><span class="hljs-selector-class">.builder</span> add \<br>   <span class="hljs-attr">--region</span> <span class="hljs-number">1</span> <span class="hljs-attr">--zone</span> <span class="hljs-number">1</span> <span class="hljs-attr">--ip</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">148.20</span> <span class="hljs-attr">--port</span> <span class="hljs-number">6200</span> <span class="hljs-attr">--device</span> sdc <span class="hljs-attr">--weight</span> <span class="hljs-number">100</span><br>swift-ring-builder <span class="hljs-selector-tag">object</span><span class="hljs-selector-class">.builder</span> add \<br>   <span class="hljs-attr">--region</span> <span class="hljs-number">1</span> <span class="hljs-attr">--zone</span> <span class="hljs-number">1</span> <span class="hljs-attr">--ip</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">148.20</span> <span class="hljs-attr">--port</span> <span class="hljs-number">6200</span> <span class="hljs-attr">--device</span> sdd <span class="hljs-attr">--weight</span> <span class="hljs-number">100</span><br>swift-ring-builder <span class="hljs-selector-tag">object</span><span class="hljs-selector-class">.builder</span> add \<br>   <span class="hljs-attr">--region</span> <span class="hljs-number">1</span> <span class="hljs-attr">--zone</span> <span class="hljs-number">2</span> <span class="hljs-attr">--ip</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">148.20</span> <span class="hljs-attr">--port</span> <span class="hljs-number">6200</span> <span class="hljs-attr">--device</span> sde <span class="hljs-attr">--weight</span> <span class="hljs-number">100</span><br>swift-ring-builder <span class="hljs-selector-tag">object</span><span class="hljs-selector-class">.builder</span> add \<br>   <span class="hljs-attr">--region</span> <span class="hljs-number">1</span> <span class="hljs-attr">--zone</span> <span class="hljs-number">2</span> <span class="hljs-attr">--ip</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">148.20</span> <span class="hljs-attr">--port</span> <span class="hljs-number">6200</span> <span class="hljs-attr">--device</span> sdf <span class="hljs-attr">--weight</span> <span class="hljs-number">100</span><br>swift-ring-builder <span class="hljs-selector-tag">object</span><span class="hljs-selector-class">.builder</span><br>swift-ring-builder <span class="hljs-selector-tag">object</span><span class="hljs-selector-class">.builder</span> rebalance<br><br>将swift目录下生成三个.gz文件复制到存储节点的swift目录下<br>scp account<span class="hljs-selector-class">.ring</span><span class="hljs-selector-class">.gz</span> container<span class="hljs-selector-class">.ring</span><span class="hljs-selector-class">.gz</span> <span class="hljs-selector-tag">object</span><span class="hljs-selector-class">.ring</span><span class="hljs-selector-class">.gz</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">148.20</span>:/etc/swift<br><br>##完成安装 controller-<span class="hljs-number">48</span><br>mv  /etc/swift/swift.conf&#123;,.bak&#125;<br>cat&gt; /etc/swift/swift.conf&lt;&lt;EOF<br><span class="hljs-selector-attr">[swift-hash]</span><br>swift_hash_path_suffix = swift<br>swift_hash_path_prefix = swift<br><span class="hljs-selector-attr">[storage-policy:0]</span><br>name = Policy-<span class="hljs-number">0</span><br>default = yes<br>EOF<br><br>#复制到存储节点<br>scp swift<span class="hljs-selector-class">.conf</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">148.20</span>:/etc/swift<br>swift_hash_path_suffix和swift_hash_path_prefix作为哈希算法的一部分用于确定数据在集群中的位置。<br>这些值应该保持机密，并且在部署集群之后不能更改丢失。可自定义<br>在所有节点确保对配置目录拥有适当的所有权：<br>####存储节点与控制节点同时执行（注意！！！！两个节点同时执行）<br>chown -R root:swift /etc/swift <br>在控制器节点和任何其他运行代理服务的节点上，启动对象存储代理服务及其相关性，并将它们配置为在系统启动时启动(存储节点无代理服务)<br><br>#重启服务<br>systemctl enable openstack-swift-proxy<span class="hljs-selector-class">.service</span> memcached<span class="hljs-selector-class">.service</span> <span class="hljs-attr">--now</span><br>systemctl restart openstack-swift-proxy<span class="hljs-selector-class">.service</span> memcached.service<br></code></pre></td></tr></table></figure>

<h3 id="计算节点-3"><a href="#计算节点-3" class="headerlink" title="计算节点"></a>计算节点</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs stylus">在存储节点启动所有服务<br> systemctl enable openstack-swift-account<span class="hljs-selector-class">.service</span> openstack-swift-account-auditor<span class="hljs-selector-class">.service</span> \<br>  openstack-swift-account-reaper<span class="hljs-selector-class">.service</span> openstack-swift-account-replicator<span class="hljs-selector-class">.service</span><br> systemctl start openstack-swift-account<span class="hljs-selector-class">.service</span> openstack-swift-account-auditor<span class="hljs-selector-class">.service</span> \<br>  openstack-swift-account-reaper<span class="hljs-selector-class">.service</span> openstack-swift-account-replicator<span class="hljs-selector-class">.service</span><br> systemctl enable openstack-swift-container<span class="hljs-selector-class">.service</span> \<br>  openstack-swift-container-auditor<span class="hljs-selector-class">.service</span> openstack-swift-container-replicator<span class="hljs-selector-class">.service</span> \<br>  openstack-swift-container-updater<span class="hljs-selector-class">.service</span><br> systemctl start openstack-swift-container<span class="hljs-selector-class">.service</span> \<br>  openstack-swift-container-auditor<span class="hljs-selector-class">.service</span> openstack-swift-container-replicator<span class="hljs-selector-class">.service</span> \<br>  openstack-swift-container-updater<span class="hljs-selector-class">.service</span><br> systemctl enable openstack-swift-<span class="hljs-selector-tag">object</span><span class="hljs-selector-class">.service</span> openstack-swift-object-auditor<span class="hljs-selector-class">.service</span> \<br>  openstack-swift-object-replicator<span class="hljs-selector-class">.service</span> openstack-swift-object-updater<span class="hljs-selector-class">.service</span><br> systemctl start openstack-swift-<span class="hljs-selector-tag">object</span><span class="hljs-selector-class">.service</span> openstack-swift-object-auditor<span class="hljs-selector-class">.service</span> \<br>  openstack-swift-object-replicator<span class="hljs-selector-class">.service</span> openstack-swift-object-updater.service<br></code></pre></td></tr></table></figure>

<h3 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs yaml">[<span class="hljs-string">root@controller-48</span> <span class="hljs-string">swift</span>]<span class="hljs-comment"># swift stat</span><br>               <span class="hljs-attr">Account:</span> <span class="hljs-string">AUTH_07a1ce96dca54f1bb0d3b968f1343617</span><br>            <span class="hljs-attr">Containers:</span> <span class="hljs-number">0</span><br>               <span class="hljs-attr">Objects:</span> <span class="hljs-number">0</span><br>                 <span class="hljs-attr">Bytes:</span> <span class="hljs-number">0</span><br>       <span class="hljs-attr">X-Put-Timestamp:</span> <span class="hljs-number">1684919814.32783</span><br>           <span class="hljs-attr">X-Timestamp:</span> <span class="hljs-number">1684919814.32783</span><br>            <span class="hljs-attr">X-Trans-Id:</span> <span class="hljs-string">txd6f3affa0140455b935ff-00646dd605</span><br>          <span class="hljs-attr">Content-Type:</span> <span class="hljs-string">text/plain;</span> <span class="hljs-string">charset=utf-8</span><br><span class="hljs-attr">X-Openstack-Request-Id:</span> <span class="hljs-string">txd6f3affa0140455b935ff-00646dd605</span><br>[<span class="hljs-string">root@controller-48</span> <span class="hljs-string">swift</span>]<span class="hljs-comment"># cd</span><br>[<span class="hljs-string">root@controller-48</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># swift upload demo cirros-0.5.2-x86_64-disk.img --object-name image</span><br><span class="hljs-string">image</span><br><br><span class="hljs-comment">##重启nova服务</span><br><span class="hljs-string">sudo</span> <span class="hljs-string">systemctl</span> <span class="hljs-string">restart</span> <span class="hljs-string">openstack-nova*</span><br><br></code></pre></td></tr></table></figure>

<h2 id="Heat（编排）"><a href="#Heat（编排）" class="headerlink" title="Heat（编排）"></a>Heat（编排）</h2><h3 id="控制节点-4"><a href="#控制节点-4" class="headerlink" title="控制节点"></a>控制节点</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">#创建heat数据库和用户<br>mysql -u root -pMARIADB_PASS<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">DATABASE</span> heat;<br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> <span class="hljs-keyword">PRIVILEGES</span> <span class="hljs-keyword">ON</span> heat.* <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;heat&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> \<br>  IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;HEAT_DBPASS&#x27;</span>;<br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> <span class="hljs-keyword">PRIVILEGES</span> <span class="hljs-keyword">ON</span> heat.* <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;heat&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> \<br>  IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;HEAT_DBPASS&#x27;</span>;<br>flush <span class="hljs-keyword">privileges</span>;<br><span class="hljs-keyword">exit</span><br><br>source <span class="hljs-keyword">admin</span>-openrc.sh<br>openstack <span class="hljs-keyword">user</span> <span class="hljs-keyword">create</span> <span class="hljs-comment">--domain default --password HEAT_PASS heat</span><br>#添加 <span class="hljs-keyword">admin</span> 角色到 heat 用户上<br>openstack <span class="hljs-keyword">role</span> <span class="hljs-keyword">add</span> <span class="hljs-comment">--project service --user heat admin</span><br>##创建heat和 heat-cfn 服务实体<br>openstack service <span class="hljs-keyword">create</span> <span class="hljs-comment">--name heat \</span><br>  <span class="hljs-comment">--description &quot;Orchestration&quot; orchestration</span><br>openstack service <span class="hljs-keyword">create</span> <span class="hljs-comment">--name heat-cfn \</span><br>  <span class="hljs-comment">--description &quot;Orchestration&quot;  cloudformation  </span><br>##创建 Orchestration 服务的 API 端点<br>openstack endpoint <span class="hljs-keyword">create</span> <span class="hljs-comment">--region RegionOne \</span><br>  orchestration <span class="hljs-built_in">public</span> http://controller<span class="hljs-number">-48</span>:<span class="hljs-number">8004</span>/v1/%\(tenant_id\)s<br>openstack endpoint <span class="hljs-keyword">create</span> <span class="hljs-comment">--region RegionOne \</span><br>  orchestration <span class="hljs-type">internal</span> http://controller<span class="hljs-number">-48</span>:<span class="hljs-number">8004</span>/v1/%\(tenant_id\)s<br>openstack endpoint <span class="hljs-keyword">create</span> <span class="hljs-comment">--region RegionOne \</span><br>  orchestration <span class="hljs-keyword">admin</span> http://controller<span class="hljs-number">-48</span>:<span class="hljs-number">8004</span>/v1/%\(tenant_id\)s<br><br>openstack endpoint <span class="hljs-keyword">create</span> <span class="hljs-comment">--region RegionOne \</span><br>  cloudformation <span class="hljs-built_in">public</span> http://controller<span class="hljs-number">-48</span>:<span class="hljs-number">8000</span>/v1<br>openstack endpoint <span class="hljs-keyword">create</span> <span class="hljs-comment">--region RegionOne \</span><br>  cloudformation <span class="hljs-type">internal</span> http://controller<span class="hljs-number">-48</span>:<span class="hljs-number">8000</span>/v1<br>openstack endpoint <span class="hljs-keyword">create</span> <span class="hljs-comment">--region RegionOne \</span><br>  cloudformation <span class="hljs-keyword">admin</span> http://controller<span class="hljs-number">-48</span>:<span class="hljs-number">8000</span>/v1<br></code></pre></td></tr></table></figure>

<p>为了管理栈，在认证服务中Orchestration需要更多信息</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs crmsh"><span class="hljs-comment">#控制节点</span><br><span class="hljs-comment">#为栈创建 heat 包含项目和用户的域</span><br>openstack domain create --description <span class="hljs-string">&quot;Stack projects and users&quot;</span> heat<br><br><span class="hljs-comment">#在 heat 域中创建管理项目和用户的heat_domain_admin用户：</span><br>openstack <span class="hljs-keyword">user</span> <span class="hljs-title">create</span> --domain heat --<span class="hljs-attr">password=</span>HEAT_DOMAIN_USER_PASS heat_domain_admin<br><br><span class="hljs-comment">#)添加admin角色到 heat 域 中的heat_domain_admin用户，启用heat_domain_admin用户#管理栈的管理权限</span><br>openstack <span class="hljs-keyword">role</span> <span class="hljs-title">add</span> --domain heat --user-domain heat --<span class="hljs-keyword">user</span> <span class="hljs-title">heat_domain_admin</span> admin<br><br><span class="hljs-comment">#为栈创建 heat 包含项目和用户的域</span><br>openstack <span class="hljs-keyword">role</span> <span class="hljs-title">create</span> heat_stack_owner<br><br><span class="hljs-comment">#添加heat_stack_owner 角色到demo 项目和用户，启用demo 用户管理栈。</span><br>openstack <span class="hljs-keyword">role</span> <span class="hljs-title">add</span> --project demo --<span class="hljs-keyword">user</span> <span class="hljs-title">demo</span> heat_stack_owner<br><span class="hljs-comment">#必须添加 heat_stack_owner 角色到每个管理栈的用户。</span><br><br><span class="hljs-comment">#heat_stack_user 角色</span><br>openstack <span class="hljs-keyword">role</span> <span class="hljs-title">create</span> heat_stack_user<br><br></code></pre></td></tr></table></figure>

<p>安装并配置Heat组件相关软件</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment">#控制节点</span><br>yum install openstack-heat-api openstack-heat-api-cfn \<br>  openstack-heat-engine -y<br><br>mv <span class="hljs-regexp">/etc/</span>heat/heat.conf&#123;,.bak&#125;<br>cat &gt;&gt; <span class="hljs-regexp">/etc/</span>heat/heat.conf &lt;&lt; EOF<br>[database]<br>connection = mysql+pymysql:<span class="hljs-regexp">//</span>heat:HEAT_DBPASS@controller-<span class="hljs-number">48</span>/heat  <br><span class="hljs-comment">#HEAT_DBPASS是HEAT数据库密码</span><br>[DEFAULT]<br>transport_url = rabbit:<span class="hljs-regexp">//</span>openstack:RABBIT_PASS@controller-<span class="hljs-number">48</span><br><span class="hljs-comment">#RABBIT_PASS为Rabbitmq服务密码 用户名是openstack</span><br>[keystone_authtoken]<br>www_authenticate_uri = http:<span class="hljs-regexp">//</span>controller-<span class="hljs-number">48</span>:<span class="hljs-number">5000</span><br>auth_url = http:<span class="hljs-regexp">//</span>controller-<span class="hljs-number">48</span>:<span class="hljs-number">5000</span><br>memcached_servers = controller-<span class="hljs-number">48</span>:<span class="hljs-number">11211</span><br>auth_type = password<br>project_domain_name = default<br>user_domain_name = default<br>project_name = service<br>username = heat<br>password = HEAT_PASS<br><span class="hljs-comment">#HEAT_PASS是heat用户密码</span><br>[trustee]<br>auth_type = password<br>auth_url = http:<span class="hljs-regexp">//</span>controller-<span class="hljs-number">48</span>:<span class="hljs-number">5000</span><br>username = heat<br>password = HEAT_PASS<br><span class="hljs-comment">#HEAT_PASS是heat用户密码</span><br>user_domain_name = default<br>[clients_keystone]<br>auth_uri = http:<span class="hljs-regexp">//</span>controller-<span class="hljs-number">48</span>:<span class="hljs-number">5000</span><br>[DEFAULT]<br>heat_metadata_server_url = http:<span class="hljs-regexp">//</span>controller-<span class="hljs-number">48</span>:<span class="hljs-number">8000</span><br>heat_waitcondition_server_url = http:<span class="hljs-regexp">//</span>controller-<span class="hljs-number">48</span>:<span class="hljs-number">8000</span><span class="hljs-regexp">/v1/</span>waitcondition<br>[DEFAULT]<br>stack_domain_admin = heat_domain_admin<br>stack_domain_admin_password = HEAT_DOMAIN_USER_PASS<br>stack_user_domain_name = heat<br>EOF<br><br>su -s <span class="hljs-regexp">/bin/</span>sh -c <span class="hljs-string">&quot;heat-manage db_sync&quot;</span> heat<br><span class="hljs-comment">##启动 Orchestration 编排服务heat组件并将其设置为随系统启动</span><br>systemctl enable openstack-heat-api.service \<br>  openstack-heat-api-cfn.service openstack-heat-engine.service<br><br>systemctl restart openstack-heat-api.service \<br>  openstack-heat-api-cfn.service openstack-heat-engine.service<br>  <br>[root@controller-<span class="hljs-number">48</span> ~]<span class="hljs-comment"># systemctl list-unit-files |grep openstack-heat*</span><br>openstack-heat-api-cfn.service                enabled<br>openstack-heat-api.service                    enabled<br>openstack-heat-engine.service                 enabled<br><br></code></pre></td></tr></table></figure>

<h3 id="验证-1"><a href="#验证-1" class="headerlink" title="验证"></a>验证</h3><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">cd<br>source admin-openrc.sh<br>openstack service list<br>openstack orchestration service list<br>该输出显示表明在控制节点上有应该四个heat-engine组件。<br><br>[root<span class="hljs-meta">@controller-48</span> ~]<span class="hljs-comment"># openstack orchestration service list</span><br>+------------+-------------+--------------------------------------+------------+--------+----------------------------+--------+<br>|<span class="hljs-string"> Hostname   </span>|<span class="hljs-string"> Binary      </span>|<span class="hljs-string"> Engine ID                            </span>|<span class="hljs-string"> Host       </span>|<span class="hljs-string"> Topic  </span>|<span class="hljs-string"> Updated At                 </span>|<span class="hljs-string"> Status </span>|<br>+------------+-------------+--------------------------------------+------------+--------+----------------------------+--------+<br>|<span class="hljs-string"> controller-48 </span>|<span class="hljs-string"> heat-engine </span>|<span class="hljs-string"> 230ae8e8-3c9f-4b82-b0ca-caef3d5497f1 </span>|<span class="hljs-string"> controller-48 </span>|<span class="hljs-string"> engine </span>|<span class="hljs-string"> 2023-05-27T14:42:52.000000 </span>|<span class="hljs-string"> up     </span>|<br>|<span class="hljs-string"> controller-48 </span>|<span class="hljs-string"> heat-engine </span>|<span class="hljs-string"> 626e74a4-918b-46b8-8993-d6db92eb861e </span>|<span class="hljs-string"> controller-48 </span>|<span class="hljs-string"> engine </span>|<span class="hljs-string"> 2023-05-27T14:42:52.000000 </span>|<span class="hljs-string"> up     </span>|<br>|<span class="hljs-string"> controller-48 </span>|<span class="hljs-string"> heat-engine </span>|<span class="hljs-string"> f648e766-cdb9-4e06-b190-a713baf33df8 </span>|<span class="hljs-string"> controller-48 </span>|<span class="hljs-string"> engine </span>|<span class="hljs-string"> 2023-05-27T14:42:52.000000 </span>|<span class="hljs-string"> up     </span>|<br>|<span class="hljs-string"> controller-48 </span>|<span class="hljs-string"> heat-engine </span>|<span class="hljs-string"> 2cb3dfd3-0636-432c-8d59-f22d850510d5 </span>|<span class="hljs-string"> controller-48 </span>|<span class="hljs-string"> engine </span>|<span class="hljs-string"> 2023-05-27T14:42:52.000000 </span>|<span class="hljs-string"> up     </span>|<br>+------------+-------------+--------------------------------------+------------+--------+----------------------------+--------+<br><br></code></pre></td></tr></table></figure>

<h2 id="创建实例"><a href="#创建实例" class="headerlink" title="创建实例"></a>创建实例</h2><h3 id="创建实例类型"><a href="#创建实例类型" class="headerlink" title="创建实例类型"></a>创建实例类型</h3><p>左侧选择管理员，点击计算，点击实例类型，右侧点击创建实例类型。</p>
<p><img src="/../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/55d5112b942c438d89818b728d7d3062697559838-1709275708073-159.png" srcset="/img/loading.gif" lazyload alt="image-20240106230035149"></p>
<p>根据以上图片步骤依次填入：实例名称、VCPU数量、内存大小、根磁盘大小，确认无误后点击创建实例类型。</p>
<h3 id="创建镜像"><a href="#创建镜像" class="headerlink" title="创建镜像"></a>创建镜像</h3><p>测试镜像：<a target="_blank" rel="noopener" href="https://download.cirros-cloud.net/0.6.2/cirros-0.6.2-x86_64-disk.img">https://download.cirros-cloud.net/0.6.2/cirros-0.6.2-x86_64-disk.img</a></p>
<p><font color='red'>有两种上传方式（二选一）！！！</font></p>
<p><font color='red'>1.Windows上传镜像方式</font></p>
<p>左侧选择管理员，点击计算，点击镜像，右侧点击创建镜像。</p>
<p>Windows下载到本地即可</p>
<p><img src="/../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/f2ea42f3b57b4b7a5fb9bd242f78e526697559838-1709275708073-160.png" srcset="/img/loading.gif" lazyload alt="image-20240106230649633"></p>
<p>根据以上图片步骤依次填入：镜像名称、选择文件、镜像格式，确认无误后点击创建镜像。<br><strong>注</strong>：演示上传的 img 镜像格式需选用 QCOW2 - QEMU模拟器 才可正常加载。</p>
<p><font color='red'>2.Linux上传镜像方式</font></p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">source admin-openrc<br>wget https://download.cirros-cloud.net/0.6.2/cirros-0.6.2-x86<span class="hljs-emphasis">_64-disk.img</span><br><span class="hljs-emphasis">#可能会下载不到，可以复制链接到浏览器下载，然后移到/root/目录下</span><br><span class="hljs-emphasis">glance image-create --name &quot;cirros&quot; \</span><br><span class="hljs-emphasis">  --file cirros-0.6.2-x86_</span>64-disk.img \<br><span class="hljs-code">  --disk-format qcow2 --container-format bare \</span><br><span class="hljs-code">  --visibility=public</span><br><br>openstack image list<br><br>[root@controller-1 ~]# openstack image list<br><span class="hljs-code">+--------------------------------------+</span>--------<span class="hljs-code">+--------+</span><br><span class="hljs-section">| ID                                   | Name   | Status |</span><br><span class="hljs-section">+--------------------------------------+--------+--------+</span><br><span class="hljs-section">| 627761da-7f8c-4780-842a-e50e62f5c464 | cirros | active |</span><br><span class="hljs-section">+--------------------------------------+--------+--------+</span><br><br></code></pre></td></tr></table></figure>

<h3 id="创建内部网络"><a href="#创建内部网络" class="headerlink" title="创建内部网络"></a>创建内部网络</h3><p>左侧选择管理员，点击网络，点击网络，右侧点击创建网络。</p>
<p><img src="/../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/cea509bcbba7395e7c5710616943c0bd697559838-1709275708073-161.png" srcset="/img/loading.gif" lazyload alt="image-20240106231124036"></p>
<p><img src="/../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/6bab28f65a2c56a624df71c4b9866347697559838-1709275708073-162.png" srcset="/img/loading.gif" lazyload alt="image-20240106231151367"></p>
<p><img src="/../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/0b1b24f8d99f5c3f49662532c68ac046697559838-1709275708073-163.png" srcset="/img/loading.gif" lazyload alt="image-20240106231323081"></p>
<h3 id="创建外部网络"><a href="#创建外部网络" class="headerlink" title="创建外部网络"></a>创建外部网络</h3><p>左侧选择管理员，点击网络，点击网络，右侧点击创建网络。</p>
<p><font color='red'>如果你是按照本文档搭建的，就填provider</font></p>
<p><img src="/../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/5fbbf082bc66e60949bdd81825facd02697559838-1709275708073-164.png" srcset="/img/loading.gif" lazyload alt="image-20240106231633793"></p>
<p><img src="/../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/070d5393f9a1b8dd7dee9d2fea10086e697559838-1709275708073-165.png" srcset="/img/loading.gif" lazyload alt="image-20240106231854446"></p>
<p><img src="/../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/d0a471b28e40019c7fc79bc8918cda04697559838-1709275708074-166.png" srcset="/img/loading.gif" lazyload alt="image-20240106232011057"></p>
<h3 id="创建路由"><a href="#创建路由" class="headerlink" title="创建路由"></a>创建路由</h3><p>左侧选择管理员，点击网络，点击路由，右侧点击创建路由。</p>
<p><img src="/../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/31d170f9b1e99be47760fd014bb6809d697559838-1709275708074-167.png" srcset="/img/loading.gif" lazyload alt="image-20240106232138022"></p>
<p><img src="/../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/cb31565a3cfeb2dc853ac38cded0043e697559838-1709275708074-168.png" srcset="/img/loading.gif" lazyload alt="image-20240106232201129"></p>
<p><img src="/../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/ce7823ed963eca1a54ca8b97f14928e5697559838-1709275708074-169.png" srcset="/img/loading.gif" lazyload alt="image-20240106232242376"></p>
<h3 id="添加安全组规则"><a href="#添加安全组规则" class="headerlink" title="添加安全组规则"></a>添加安全组规则</h3><p><img src="/../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/757fee2ef006d00f258da6008163fe91697559838-1709275708074-170.png" srcset="/img/loading.gif" lazyload alt="image-20240106232342515"></p>
<p><img src="/../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/b99fadf3fe10a6ddba4ba221b3c2ff87697559838-1709275708074-171.png" srcset="/img/loading.gif" lazyload alt="image-20240106232725982"></p>
<p>最后效果长这样</p>
<p><img src="/../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/485233affd839f8fbce7ea1c0ae2765d697559838-1709275708074-172.png" srcset="/img/loading.gif" lazyload alt="image-20240106232758711"></p>
<h3 id="创建实例-1"><a href="#创建实例-1" class="headerlink" title="创建实例"></a>创建实例</h3><p><img src="/../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/0105c7af8682dc647d6cf79473cd9fbc697559838-1709275708074-173.png" srcset="/img/loading.gif" lazyload alt="image-20240106232939110"></p>
<p><img src="/../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/86ffdba6219b46e5a387f8b67fa5edf7697559838-1709275708074-174.png" srcset="/img/loading.gif" lazyload alt="image-20240106233038731"></p>
<p><img src="/../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/8bf413d2923a38d956d41f905d1a4f6b697559838-1709275708074-175.png" srcset="/img/loading.gif" lazyload alt="image-20240106233101509"></p>
<p><img src="/../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/3083c4669cd60df3c5a53b7b5f661629697559838-1709275708074-176.png" srcset="/img/loading.gif" lazyload alt="image-20240106233129659"></p>
<p>然后点击创建实例</p>
<p>分配浮动ip</p>
<p><img src="/../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/bfb7b78b90815059f8171048bcb0683b697559838-1709275708074-177.png" srcset="/img/loading.gif" lazyload alt="image-20240106233251169"></p>
<p><img src="/../img/OpenStack-Train%E5%8F%8C%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/f584f2ac4bb92bb8043c2c07c670dbf4697559838-1709275708075-178.png" srcset="/img/loading.gif" lazyload alt="image-20240106233418787"></p>
<p><font color='red'>结论：创建实例成功</font></p>
<div class="tbsm" style="margin-top:54px;">
<div class="tbsm-top"><span><svg t="1674654360507" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="987" data-spm-anchor-id="a313x.7781069.0.i0" width="35" height="35"><path d="M410.49 97.74H155.08a56.74 56.74 0 0 0-56.84 56.73V410a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 410V154.58a56.83 56.83 0 0 0-56.83-56.84zM410.49 558.74H155.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z" fill="#66EEFF" p-id="988"></path><path d="M410.49 558.74h-4.14A475 475 0 0 0 299.52 859.6a481.16 481.16 0 0 0 4.84 68.22h106.13A56.83 56.83 0 0 0 467.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84zM871.49 558.74H616.08a56.74 56.74 0 0 0-56.84 56.73V871a56.84 56.84 0 0 0 56.84 56.84h255.41A56.83 56.83 0 0 0 928.32 871V615.58a56.83 56.83 0 0 0-56.83-56.84z" fill="#C2F8FF" p-id="989"></path></svg></span><span style="font-size:30px;"> 特别声明</span></div>
<div class="tbsm-wz">千屹博客旗下的所有文章，是通过本人课堂学习和课外自学所精心整理的知识巨著<br/>难免会有出错的地方<br/>如果细心的你发现了小失误，可以在下方评论区告诉我，或者私信我！<br />非常感谢大家的热烈支持！</div>
</div>
                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Centos-7/">#Centos 7</a>
      
        <a href="/tags/OpenStack/">#OpenStack</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>OpenStack-Train双节点部署</div>
      <div>https://blog.qianyios.top/2023/04/02/OpenStack-Train双节点部署/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>严千屹</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2023年4月2日</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>更新于</div>
          <div>2024年3月1日</div>
        </div>
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by-nc-nd/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
                <a target="_blank" href="https://creativecommons.org/licenses/by-nc-nd/4.0/">
                  <span class="hint--top hint--rounded" aria-label="NC - 非商业性使用">
                    <i class="iconfont icon-nc"></i>
                  </span>
                </a>
              
                <a target="_blank" href="https://creativecommons.org/licenses/by-nc-nd/4.0/">
                  <span class="hint--top hint--rounded" aria-label="ND - 禁止演绎">
                    <i class="iconfont icon-nd"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/04/13/Hadoop_zj/" title="Hadoop组件部署">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Hadoop组件部署</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/03/26/Docker%20node/" title="Docker笔记">
                        <span class="hidden-mobile">Docker笔记</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            

          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <div class="zsqk"> <p>(￣▽￣)" 赞赏！</p> <div class="zstb"> <a  class="qr-trigger" target="_self"> <i class="iconfont icon-wechat-fill" aria-hidden="true"></i> <img class="qr-img animate__animated animate__bounc animate__fadeInDown" src="https://blog.qianyios.top/img/zansang/wxzf.png" srcset="/img/loading.gif" lazyload alt="qrcode" /> </a> <a  class="qr-trigger" target="_self"> <i class="iconfont icon-alipay-fill" aria-hidden="true"></i> <img class="qr-img animate__animated animate__bounc animate__fadeInDown" src="https://blog.qianyios.top/img/zansang/zfb.png" srcset="/img/loading.gif" lazyload alt="qrcode" /> </a>
</div>
<p class="zsyy animate__animated animate__bounce animate__flash animate__infinite	infinite animate__slow">如果对你有帮助，就请我喝一杯吧！！</p> </div> <br /> <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    
  
</div>

  
  
    <!-- 备案信息 ICP for China -->
    <div class="beian">
  <span>
    <a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">
     ICP备案号: 粤ICP备2024250479号-1
    </a>
  </span>
</div>

  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
