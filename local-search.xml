<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Centos 8 使用Docker实现容器</title>
    <link href="/2023/01/17/docker/"/>
    <url>/2023/01/17/docker/</url>
    
    <content type="html"><![CDATA[<h1 id="Centos-8-使用Docker实现容器"><a href="#Centos-8-使用Docker实现容器" class="headerlink" title="Centos 8 使用Docker实现容器"></a>Centos 8 使用Docker实现容器</h1><h2 id="基础信息"><a href="#基础信息" class="headerlink" title="基础信息"></a>基础信息</h2><table><thead><tr><th>系统</th><th>ip  (NAT)</th><th>内存</th><th>硬盘</th></tr></thead><tbody><tr><td>Centos 8.5</td><td>192.168.48.10</td><td>2G</td><td>40G</td></tr></tbody></table><p>基本配置好可以访问互联网即可</p><h3 id="切换阿里yum"><a href="#切换阿里yum" class="headerlink" title="切换阿里yum"></a>切换阿里yum</h3><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs autoit">[root<span class="hljs-symbol">@Docker</span> ~]<span class="hljs-meta"># mkdir repo.bak</span><br>[root<span class="hljs-symbol">@Docker</span> ~]<span class="hljs-meta"># cp /etc/yum.repos.d/* repo.bak/</span><br>[root<span class="hljs-symbol">@Docker</span> ~]<span class="hljs-meta"># rename <span class="hljs-string">&#x27;.repo&#x27;</span> <span class="hljs-string">&#x27;.repo.bak&#x27;</span> /etc/yum.repos.d/*.repo</span><br>[root<span class="hljs-symbol">@Docker</span> ~]<span class="hljs-meta"># wget -O /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-vault-8.5.2111.repo</span><br>[root<span class="hljs-symbol">@Docker</span>~]<span class="hljs-meta"># yum clean all &amp;&amp; yum makecache</span><br>[root<span class="hljs-symbol">@Docker</span>~]<span class="hljs-meta"># systemctl disable --now firewalld</span><br>[root<span class="hljs-symbol">@Docker</span>~]<span class="hljs-meta"># sed -i <span class="hljs-string">&#x27;s/^SELINUX=.*/SELINUX=disabled/&#x27;</span> /etc/selinux/config</span><br>[root<span class="hljs-symbol">@Docker</span>~]<span class="hljs-meta"># yum update -y</span><br></code></pre></td></tr></table></figure><h2 id="安装Docker"><a href="#安装Docker" class="headerlink" title="安装Docker"></a>安装Docker</h2><h3 id="删除旧版docker"><a href="#删除旧版docker" class="headerlink" title="删除旧版docker"></a>删除旧版docker</h3><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript">[root@Docker ~]<span class="hljs-comment"># sudo yum remove docker docker-client docker-client-latest docker-common docker-latest docker-latest-logrotate docker-logrotate docker-engine -y</span><br></code></pre></td></tr></table></figure><h3 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h3><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autoit">[root<span class="hljs-symbol">@Docker</span> ~]<span class="hljs-meta"># yum install -y yum-utils device-mapper-persistent-data lvm2</span><br></code></pre></td></tr></table></figure><h3 id="添加阿里docker存储库"><a href="#添加阿里docker存储库" class="headerlink" title="添加阿里docker存储库"></a>添加阿里docker存储库</h3><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript">[root@Docker ~]<span class="hljs-comment"># dnf config-manager --add-repo=https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br>[root@Docker ~]<span class="hljs-comment"># yum clean all &amp;&amp; yum makecache </span><br></code></pre></td></tr></table></figure><h3 id="安装docker软件"><a href="#安装docker软件" class="headerlink" title="安装docker软件"></a>安装docker软件</h3><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autoit">[root<span class="hljs-symbol">@Docker</span> ~]<span class="hljs-meta"># yum install -y --allowerasing docker-ce docker-ce-cli</span><br></code></pre></td></tr></table></figure><h3 id="启动docker服务"><a href="#启动docker服务" class="headerlink" title="启动docker服务"></a>启动docker服务</h3><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript">[root@Docker ~]<span class="hljs-comment"># systemctl enable docker </span><br></code></pre></td></tr></table></figure><h3 id="验证是否安装成功"><a href="#验证是否安装成功" class="headerlink" title="验证是否安装成功"></a>验证是否安装成功</h3><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs livescript">[root@Docker ~]<span class="hljs-comment"># docker run hello-world</span><br><span class="hljs-comment">#未检测到hello-world镜像</span><br>Unable <span class="hljs-keyword">to</span> find image <span class="hljs-string">&#x27;hello-world:latest&#x27;</span> locally<br><span class="hljs-comment">#从远程的DockerHub仓库拉取镜像</span><br>latest: Pulling <span class="hljs-keyword">from</span> library/hello-world<br><span class="hljs-number">2db</span>29710123e: Pull complete<br>Digest: sha256:aa0cc8055b82dc2509bed2e19b275c8f463506616377219d9642221ab53cf9fe<br>Status: Downloaded newer image <span class="hljs-keyword">for</span> hello-world:latest<br><span class="hljs-comment">#出现下面说明docker运行成功</span><br>Hello <span class="hljs-keyword">from</span> Docker!  -------<br>This message shows <span class="hljs-literal">that</span> your installation appears <span class="hljs-keyword">to</span> be working correctly.<br><br>To generate this message, Docker took the following steps:<br> <span class="hljs-number">1.</span> The Docker client contacted the Docker daemon.<br> <span class="hljs-number">2.</span> The Docker daemon pulled the <span class="hljs-string">&quot;hello-world&quot;</span> image <span class="hljs-keyword">from</span> the Docker Hub.<br>    (amd64)<br> <span class="hljs-number">3.</span> The Docker daemon created a <span class="hljs-keyword">new</span> container <span class="hljs-keyword">from</span> <span class="hljs-literal">that</span> image which runs the<br>    executable <span class="hljs-literal">that</span> produces the output you are currently reading.<br> <span class="hljs-number">4.</span> The Docker daemon streamed <span class="hljs-literal">that</span> output <span class="hljs-keyword">to</span> the Docker client, which sent <span class="hljs-literal">it</span><br>    <span class="hljs-keyword">to</span> your terminal.<br>To <span class="hljs-keyword">try</span> something more ambitious, you can run an Ubuntu container with:<br> $ docker run -<span class="hljs-literal">it</span> ubuntu bash<br>Share images, automate workflows, <span class="hljs-keyword">and</span> more <span class="hljs-keyword">with</span> a free Docker ID:<br> https:<span class="hljs-regexp">//hub.docker.com/</span><br><span class="hljs-regexp">For more examples and ideas, visit:</span><br><span class="hljs-regexp"> https://</span>docs.docker.com<span class="hljs-regexp">/get-started/</span><br><br></code></pre></td></tr></table></figure><h2 id="使用Docker创建新的镜像"><a href="#使用Docker创建新的镜像" class="headerlink" title="使用Docker创建新的镜像"></a>使用Docker创建新的镜像</h2><h3 id="检索Docker仓库中的Ubuntu镜像"><a href="#检索Docker仓库中的Ubuntu镜像" class="headerlink" title="检索Docker仓库中的Ubuntu镜像"></a>检索Docker仓库中的Ubuntu镜像</h3><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript">[root@Docker ~]<span class="hljs-comment"># docker search ubuntu</span><br>NAME                             DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED<br>ubuntu                           Ubuntu <span class="hljs-keyword">is</span> a Debian-based Linux operating sys…   <span class="hljs-number">15464</span>     [OK]     <br>......<br></code></pre></td></tr></table></figure><h3 id="获取Ubuntu镜像"><a href="#获取Ubuntu镜像" class="headerlink" title="获取Ubuntu镜像"></a>获取Ubuntu镜像</h3><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs makefile">[root@Docker ~]<span class="hljs-comment"># docker pull ubuntu</span><br>Using default tag: latest<br><span class="hljs-section">latest: Pulling from library/ubuntu</span><br><span class="hljs-section">6e3729cf69e0: Pull complete</span><br><span class="hljs-section">Digest: sha256:27cb6e6ccef575a4698b66f5de06c7ecd61589132d5a91d098f7f3f9285415a9</span><br><span class="hljs-section">Status: Downloaded newer image for ubuntu:latest</span><br><span class="hljs-section">docker.io/library/ubuntu:latest</span><br></code></pre></td></tr></table></figure><h3 id="查看本地Docker镜像"><a href="#查看本地Docker镜像" class="headerlink" title="查看本地Docker镜像"></a>查看本地Docker镜像</h3><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">[root@Docker ~]<span class="hljs-comment"># docker images</span><br>REPOSITORY    <span class="hljs-keyword">TAG</span>       <span class="hljs-title">IMAGE</span> ID       CREATED         SIZE<br>ubuntu        latest    <span class="hljs-number">6</span>b7dfa7e8fdb   <span class="hljs-number">5</span> weeks ago     <span class="hljs-number">77.8M</span>B<br>hello-world   latest    feb5d9fea6a5   <span class="hljs-number">16</span> months ago   <span class="hljs-number">13.3</span>kB<br></code></pre></td></tr></table></figure><blockquote><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">Docker镜像列表选项字段说明如下。<br>REPOSITORY  镜像的名称<br><span class="hljs-keyword">TAG</span>   <span class="hljs-title">镜像的标签</span><br><span class="hljs-title">IMAGE</span> ID    镜像的ID<br>CREATED     镜像创建时间<br>SIZE        镜像大小<br></code></pre></td></tr></table></figure></blockquote><h3 id="启动docker容器"><a href="#启动docker容器" class="headerlink" title="启动docker容器"></a>启动docker容器</h3><blockquote><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs routeros">使用docker <span class="hljs-built_in">run</span> 命令可启动容器，Docker 启动时其执行过程如下。<br>· 检查本地是否存在指定的Docker 镜像，如果不存在将从Docker仓库下载。<br>· 使用Docker 镜像创建并启动Docker 容器。<br>· 为Docker容器分配一个文件系统，并在只读的镜像层外面挂载一层可读写层。<br>· 从Docker宿主机中配置的网桥接口中桥接一个虚拟接口到容器。<br>· 从Docker 网络的地址池中分配一个IP地址给当前容器。<br>· 执行用户指定的程序。<br>` 执行完毕后终止容器。<br></code></pre></td></tr></table></figure></blockquote><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs awk">创建基于本地ubuntu镜像的docker容器<br>[root@Docker ~]<span class="hljs-comment"># docker run -it ubuntu /bin/bash</span><br>root@<span class="hljs-number">136156</span>e4c448:/<span class="hljs-comment">#</span><br>root@<span class="hljs-number">136156</span>e4c448:/<span class="hljs-comment"># exit</span><br><span class="hljs-keyword">exit</span><br>[root@Docker ~]<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><h3 id="更新并创建Docker镜像"><a href="#更新并创建Docker镜像" class="headerlink" title="更新并创建Docker镜像"></a>更新并创建Docker镜像</h3><h4 id="更新ubuntu镜像添加ping"><a href="#更新ubuntu镜像添加ping" class="headerlink" title="更新ubuntu镜像添加ping"></a>更新ubuntu镜像添加ping</h4><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs autoit">当本地的镜像不能满足日常需求，可从已创建的容器中更新并提交镜像。最新版的ubuntu没有安装<span class="hljs-built_in">ping</span>，本步骤将在ubuntu安装<span class="hljs-built_in">ping</span>，并建立新的镜像<br><span class="hljs-meta">#启动 ubuntu容器，每次创建容器会产生新的id（9eac21a09449）要记录好</span><br>[root<span class="hljs-symbol">@Docker</span> ~]<span class="hljs-meta"># docker run -t -i  ubuntu:latest /bin/bash</span><br>root<span class="hljs-symbol">@9eac21a09449</span>:/<span class="hljs-meta"># apt update</span><br>Get:<span class="hljs-number">1</span> http://security.ubuntu.com/ubuntu jammy-security InRelease [<span class="hljs-number">110</span> kB]<br>......<br>root<span class="hljs-symbol">@9eac21a09449</span>:/<span class="hljs-meta"># ping jd.com</span><br>bash: <span class="hljs-built_in">ping</span>: command <span class="hljs-literal">not</span> found<br><span class="hljs-meta">#安装ping</span><br>root<span class="hljs-symbol">@9eac21a09449</span>:/<span class="hljs-meta"># apt-get install -y iputils-ping</span><br>Reading package lists... Done<br>root<span class="hljs-symbol">@9eac21a09449</span>:/<span class="hljs-meta"># ping -c 2 jd.com</span><br><span class="hljs-built_in">PING</span> jd.com (<span class="hljs-number">111.13</span><span class="hljs-number">.149</span><span class="hljs-number">.108</span>) <span class="hljs-number">56</span>(<span class="hljs-number">84</span>) bytes of data.<br><span class="hljs-number">64</span> bytes from <span class="hljs-number">111.13</span><span class="hljs-number">.149</span><span class="hljs-number">.108</span> (<span class="hljs-number">111.13</span><span class="hljs-number">.149</span><span class="hljs-number">.108</span>): icmp_seq=<span class="hljs-number">1</span> ttl=<span class="hljs-number">127</span> time=<span class="hljs-number">43.7</span> ms<br><span class="hljs-number">64</span> bytes from <span class="hljs-number">111.13</span><span class="hljs-number">.149</span><span class="hljs-number">.108</span>: icmp_seq=<span class="hljs-number">2</span> ttl=<span class="hljs-number">127</span> time=<span class="hljs-number">44.6</span> ms<br><span class="hljs-meta">#退出</span><br>root<span class="hljs-symbol">@9eac21a09449</span>:/<span class="hljs-meta"># exit</span><br><span class="hljs-keyword">exit</span><br><span class="hljs-meta">#操作完成后可基于该docker容器创建新的docker镜像</span><br><span class="hljs-meta">#创建新的docker镜像</span><br>[root<span class="hljs-symbol">@Docker</span> ~]<span class="hljs-meta"># docker commit -m <span class="hljs-string">&#x27;ubuntu增加ping命令&#x27;</span> -a <span class="hljs-string">&#x27;docker&#x27;</span> 9eac21a09449 ping/ubuntu:v2</span><br>sha256:<span class="hljs-number">7655</span>d7758bcfa635dde3cf8064602a32ac625100a1b7763e7856ff6052c8abee<br>[root<span class="hljs-symbol">@Docker</span> ~]<span class="hljs-meta"># docker images</span><br>REPOSITORY    TAG       IMAGE ID       CREATED          SIZE<br><span class="hljs-built_in">ping</span>/ubuntu   v2        <span class="hljs-number">7655</span>d7758bcf   <span class="hljs-number">10</span> seconds ago   <span class="hljs-number">120</span>MB<br>ubuntu        latest    <span class="hljs-number">6</span>b7dfa7e8fdb   <span class="hljs-number">5</span> weeks ago      <span class="hljs-number">77.8</span>MB<br>hello-world   latest    feb5d9fea6a5   <span class="hljs-number">16</span> months ago    <span class="hljs-number">13.3</span>kB<br><span class="hljs-meta">#运行新创建的容器，测试ping</span><br>[root<span class="hljs-symbol">@Docker</span> ~]<span class="hljs-meta"># docker run -it ping/ubuntu:v2 /bin/bash</span><br>root<span class="hljs-symbol">@7015378380d7</span>:/<span class="hljs-meta"># ping jd.com -c 3</span><br><span class="hljs-built_in">PING</span> jd.com (<span class="hljs-number">111.13</span><span class="hljs-number">.149</span><span class="hljs-number">.108</span>) <span class="hljs-number">56</span>(<span class="hljs-number">84</span>) bytes of data.<br><span class="hljs-number">64</span> bytes from <span class="hljs-number">111.13</span><span class="hljs-number">.149</span><span class="hljs-number">.108</span> (<span class="hljs-number">111.13</span><span class="hljs-number">.149</span><span class="hljs-number">.108</span>): icmp_seq=<span class="hljs-number">1</span> ttl=<span class="hljs-number">127</span> time=<span class="hljs-number">44.1</span> ms<br><span class="hljs-number">64</span> bytes from <span class="hljs-number">111.13</span><span class="hljs-number">.149</span><span class="hljs-number">.108</span> (<span class="hljs-number">111.13</span><span class="hljs-number">.149</span><span class="hljs-number">.108</span>): icmp_seq=<span class="hljs-number">2</span> ttl=<span class="hljs-number">127</span> time=<span class="hljs-number">44.9</span> ms<br><span class="hljs-number">64</span> bytes from <span class="hljs-number">111.13</span><span class="hljs-number">.149</span><span class="hljs-number">.108</span>: icmp_seq=<span class="hljs-number">3</span> ttl=<span class="hljs-number">127</span> time=<span class="hljs-number">45.1</span> ms<br><br></code></pre></td></tr></table></figure><h4 id="使用dockerfile创建镜像"><a href="#使用dockerfile创建镜像" class="headerlink" title="使用dockerfile创建镜像"></a>使用dockerfile创建镜像</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">Dockerfile是由一系列命令和参数脚本构成的脚本，这些命令可在基础镜像上一次执行，最终创建一个新的Docker镜像<br></code></pre></td></tr></table></figure><p>编辑dockerfile</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">[root@Docker ~]<span class="hljs-comment"># vi /root/Dockerfile</span><br><span class="hljs-comment">#基础镜像信息</span><br><span class="hljs-keyword">FROM</span> ubuntu<br><span class="hljs-comment">#维护者信息</span><br><span class="hljs-keyword">MAINTAINER</span> book_user book@<span class="hljs-number">123</span>.com<br><span class="hljs-comment">#镜像操作指令</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> apt update</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> apt-get install -y iputils-ping</span><br><span class="hljs-comment">#容器启动时执行的命令</span><br><span class="hljs-keyword">CMD</span><span class="language-bash"> <span class="hljs-built_in">cd</span> /opt</span><br><span class="hljs-keyword">CMD</span><span class="language-bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;new docker&#x27;</span> &gt; readme.txt</span><br></code></pre></td></tr></table></figure><blockquote><p>Dockerfile中每一个指令都会在镜像上创建一个新的镜像层，每一个指令的前缀都必须是大写的，其创建过程如下</p></blockquote><p>使用docker build 命令从dockerfile文件创建镜像</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs autoit">[root<span class="hljs-symbol">@Docker</span> ~]<span class="hljs-meta"># docker build -t <span class="hljs-string">&quot;book/ubuntu:v3&quot;</span> .</span><br><span class="hljs-meta">#末尾小数点别忘了，接下来，他就会按照dockerfile文件中的命令一一执行</span><br><br>[root<span class="hljs-symbol">@Docker</span> ~]<span class="hljs-meta"># docker images</span><br>REPOSITORY    TAG       IMAGE ID       CREATED          SIZE<br>book/ubuntu   v3        <span class="hljs-number">90</span>bbd384b2a3   <span class="hljs-number">59</span> seconds ago   <span class="hljs-number">120</span>MB<br><span class="hljs-built_in">ping</span>/ubuntu   v2        <span class="hljs-number">7655</span>d7758bcf   <span class="hljs-number">17</span> minutes ago   <span class="hljs-number">120</span>MB<br>ubuntu        latest    <span class="hljs-number">6</span>b7dfa7e8fdb   <span class="hljs-number">5</span> weeks ago      <span class="hljs-number">77.8</span>MB<br>hello-world   latest    feb5d9fea6a5   <span class="hljs-number">16</span> months ago    <span class="hljs-number">13.3</span>kB<br><br><span class="hljs-meta">#删除本地的docker镜像</span><br>[root<span class="hljs-symbol">@Docker</span> ~]<span class="hljs-meta"># docker rmi hello-world</span><br>Error response from daemon: conflict: unable <span class="hljs-keyword">to</span> remove repository reference <span class="hljs-string">&quot;hello-world&quot;</span> (must force) - container <span class="hljs-number">5542</span>ae3caafa is using its referenced image feb5d9fea6a5<br>出现报错说明container使用到了这个images，删除镜像前需要删除基于此镜像创建的容器<br><span class="hljs-meta">#查询容器列表</span><br>[root<span class="hljs-symbol">@Docker</span> ~]<span class="hljs-meta"># docker ps -a</span><br>CONTAINER ID   IMAGE            COMMAND       CREATED          STATUS                        PORTS     NAMES<br><span class="hljs-number">7015378380</span>d7   <span class="hljs-built_in">ping</span>/ubuntu:v2   <span class="hljs-string">&quot;/bin/bash&quot;</span>   <span class="hljs-number">19</span> minutes ago   Exited (<span class="hljs-number">127</span>) <span class="hljs-number">15</span> minutes ago             nervous_lamarr<br><span class="hljs-number">37</span>ac7bf75dbc   <span class="hljs-built_in">ping</span>/ubuntu:v2   <span class="hljs-string">&quot;/bin/bash&quot;</span>   <span class="hljs-number">19</span> minutes ago   Exited (<span class="hljs-number">0</span>) <span class="hljs-number">19</span> minutes ago               peaceful_galois<br><span class="hljs-number">9</span>eac21a09449   ubuntu:latest    <span class="hljs-string">&quot;/bin/bash&quot;</span>   <span class="hljs-number">32</span> minutes ago   Exited (<span class="hljs-number">130</span>) <span class="hljs-number">26</span> minutes ago             angry_golick<br><span class="hljs-number">136156e4</span>c448   ubuntu           <span class="hljs-string">&quot;/bin/bash&quot;</span>   <span class="hljs-number">34</span> minutes ago   Exited (<span class="hljs-number">130</span>) <span class="hljs-number">33</span> minutes ago             intelligent_proskuriakova<br><span class="hljs-number">5542</span>ae3caafa   hello-world      <span class="hljs-string">&quot;/hello&quot;</span>      <span class="hljs-number">46</span> minutes ago   Exited (<span class="hljs-number">0</span>) <span class="hljs-number">46</span> minutes ago               pensive_newton<br><span class="hljs-meta">#删除容器</span><br>[root<span class="hljs-symbol">@Docker</span> ~]<span class="hljs-meta"># docker rm 5542ae3caafa</span><br><span class="hljs-number">5542</span>ae3caafa<br>删除镜像<br>[root<span class="hljs-symbol">@Docker</span> ~]<span class="hljs-meta"># docker rmi hello-world</span><br>Untagged: hello-world:latest<br>Untagged: hello-world<span class="hljs-symbol">@sha256</span>:aa0cc8055b82dc2509bed2e19b275c8f463506616377219d9642221ab53cf9fe<br>Deleted: sha256:feb5d9fea6a5e9606aa995e879d862b825965ba48de054caab5ef356dc6b3412<br>Deleted: sha256:e07ee1baac5fae6a26f30cabfe54a36d3402f96afda318fe0a96cec4ca393359<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>Centos 8</tag>
      
      <tag>Docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Centos 8 stream 初始配置</title>
    <link href="/2023/01/14/C8/"/>
    <url>/2023/01/14/C8/</url>
    
    <content type="html"><![CDATA[<h1 id="Centos-8-strean-初始配置"><a href="#Centos-8-strean-初始配置" class="headerlink" title="Centos 8 strean 初始配置"></a>Centos 8 strean 初始配置</h1><h2 id="配置网络yum"><a href="#配置网络yum" class="headerlink" title="配置网络yum"></a>配置网络yum</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cp</span> /etc/yum.repos.d/CentOS-Stream-BaseOS.repo /etc/yum.repos.d/CentOS-Stream-BaseOS.repo.bak<br><br>sed -i <span class="hljs-string">&#x27;s/mirrorlist/#mirrorlist/&#x27;</span> /etc/yum.repos.d/CentOS-Stream-BaseOS.repo<br><br>sed -i <span class="hljs-string">&#x27;s/#baseurl=http:\/\/mirror.centos.org/baseurl=http:\/\/mirrors.aliyun.com/g&#x27;</span> /etc/yum.repos.d/CentOS-Stream-BaseOS.repo<br></code></pre></td></tr></table></figure><h2 id="配置本地yum"><a href="#配置本地yum" class="headerlink" title="配置本地yum"></a>配置本地yum</h2><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[root@localhost ~]</span><span class="hljs-comment"># mkdir repo.bak</span><br><span class="hljs-section">[root@localhost ~]</span><span class="hljs-comment"># mv /etc/yum.repos.d/* repo.bak/</span><br><span class="hljs-section">[root@localhost ~]</span><span class="hljs-comment"># vi /etc/yum.repos.d/centos.repo</span><br>    <span class="hljs-section">[BaseOS]</span><br>    <span class="hljs-attr">name</span>=BaseOS<br>    <span class="hljs-attr">baseurl</span>=file:///mnt/BaseOS<br>    <span class="hljs-attr">gpgcheck</span>=<span class="hljs-number">0</span><br>    <span class="hljs-attr">enabled</span>=<span class="hljs-number">1</span><br><br>    <span class="hljs-section">[AppStream]</span><br>    <span class="hljs-attr">name</span>=AppStream<br>    <span class="hljs-attr">baseurl</span>=file:///mnt/AppStream<br>    <span class="hljs-attr">gpgcheck</span>=<span class="hljs-number">0</span><br>    <span class="hljs-attr">enabled</span>=<span class="hljs-number">1</span><br><span class="hljs-section">[root@localhost ~]</span><span class="hljs-comment"># yum clean all &amp;&amp; yum makecache</span><br></code></pre></td></tr></table></figure><h2 id="配置防火墙和Selinux"><a href="#配置防火墙和Selinux" class="headerlink" title="配置防火墙和Selinux"></a>配置防火墙和Selinux</h2><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs autoit">[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># systemctl disable --now firewalld</span><br>    Removed <span class="hljs-string">&quot;/etc/systemd/system/multi-user.target.wants/firewalld.service&quot;</span>.<br>    Removed <span class="hljs-string">&quot;/etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service&quot;</span>.<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># sed -i <span class="hljs-string">&#x27;s/^SELINUX=.*/SELINUX=disabled/&#x27;</span> /etc/selinux/config</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>Centos 8 stream</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Centos7 部署 NFS 服务</title>
    <link href="/2023/01/14/NFS/"/>
    <url>/2023/01/14/NFS/</url>
    
    <content type="html"><![CDATA[<h1 id="Centos7-部署-NFS-服务"><a href="#Centos7-部署-NFS-服务" class="headerlink" title="Centos7 部署 NFS 服务"></a>Centos7 部署 NFS 服务</h1><h2 id="环境部署"><a href="#环境部署" class="headerlink" title="环境部署"></a>环境部署</h2><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript">[root@localhost ~]<span class="hljs-comment"># mkdir repo.bak</span><br>[root@localhost ~]<span class="hljs-comment"># mv /etc/yum.repos.d/* repo.bak/</span><br>[root@localhost ~]<span class="hljs-comment"># wget -O /etc/yum.repos.d/CentOS-Base.repo https://mirrors.ali yun.com/repo/Centos-7.repo</span><br>[root@localhost ~]<span class="hljs-comment"># yum clean all &amp;&amp; yum makecache</span><br>[root@localhost ~]<span class="hljs-comment"># systemctl disable firewalld --now</span><br>[root@localhost ~]<span class="hljs-comment"># sed -i &#x27;s/SELINUX=enforcing/SELINUX=disabled/g&#x27; /etc/sysconfig/selinux</span><br>[root@localhost ~]<span class="hljs-comment"># yum update -y</span><br></code></pre></td></tr></table></figure><h2 id="安装NFS服务"><a href="#安装NFS服务" class="headerlink" title="安装NFS服务"></a>安装NFS服务</h2><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs autoit">[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># yum install -y nfs-utils</span><br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># systemcenable --now rpcbind nfs-server</span><br></code></pre></td></tr></table></figure><h2 id="配置NFS服务"><a href="#配置NFS服务" class="headerlink" title="配置NFS服务"></a>配置NFS服务</h2><h3 id="创建共享目录"><a href="#创建共享目录" class="headerlink" title="创建共享目录"></a>创建共享目录</h3><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs autoit">[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># mkdir /nfs</span><br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># chmod -R 777 /nfs</span><br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># cp /etc/exports /etc/exports.bak</span><br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># vi /etc/exports</span><br>     /nfs *(rw,sync,no_root_squash)<br></code></pre></td></tr></table></figure><h3 id="重启NFS服务"><a href="#重启NFS服务" class="headerlink" title="重启NFS服务"></a>重启NFS服务</h3><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autoit">[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># systemctl restart nfs-server</span><br></code></pre></td></tr></table></figure><h2 id="挂载NFS磁盘"><a href="#挂载NFS磁盘" class="headerlink" title="挂载NFS磁盘"></a>挂载NFS磁盘</h2><h3 id="确认nfs模式开了没"><a href="#确认nfs模式开了没" class="headerlink" title="确认nfs模式开了没"></a>确认nfs模式开了没</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs routeros">[root@localhost ~]# systemctl status rpcbind nfs-server<br>● rpcbind.service - RPC bind<span class="hljs-built_in"> service</span><br><span class="hljs-built_in"></span>   Loaded: loaded (/usr/lib/systemd/system/rpcbind.service; enabled; vendor preset: enabled)<br>   Active: active (running) since Fri 2023-01-13 20:27:13 CST; 1h 46min ago<br>  Process: 727 <span class="hljs-attribute">ExecStart</span>=/sbin/rpcbind -w <span class="hljs-variable">$RPCBIND_ARGS</span> (<span class="hljs-attribute">code</span>=exited, <span class="hljs-attribute">status</span>=0/SUCCESS)<br> Main PID: 736 (rpcbind)<br>   CGroup: /system.slice/rpcbind.service<br>           └─736 /sbin/rpcbind -w<br><br>Jan 13 20:27:13 localhost.localdomain systemd[1]: Starting RPC bind service<span class="hljs-built_in">..</span>.<br>Jan 13 20:27:13 localhost.localdomain systemd[1]: Started RPC bind service.<br><br>● nfs-server.service - NFS<span class="hljs-built_in"> server </span><span class="hljs-keyword">and</span> services<br>   Loaded: loaded (/usr/lib/systemd/system/nfs-server.service; enabled; vendor preset: disabled)<br>  Drop-In: /run/systemd/generator/nfs-server.service.d<br>           └─order-with-mounts.conf<br>   Active: active (exited) since Fri 2023-01-13 20:27:16 CST; 1h 46min ago<br>  Process: 1118 <span class="hljs-attribute">ExecStartPost</span>=/bin/sh -c <span class="hljs-keyword">if</span> systemctl -q is-active gssproxy; then systemctl reload gssproxy ; fi (<span class="hljs-attribute">code</span>=exited, <span class="hljs-attribute">status</span>=0/SUCCESS)<br>  Process: 1069 <span class="hljs-attribute">ExecStart</span>=/usr/sbin/rpc.nfsd <span class="hljs-variable">$RPCNFSDARGS</span> (<span class="hljs-attribute">code</span>=exited, <span class="hljs-attribute">status</span>=0/SUCCESS)<br>  Process: 1067 <span class="hljs-attribute">ExecStartPre</span>=/usr/sbin/exportfs -r (<span class="hljs-attribute">code</span>=exited, <span class="hljs-attribute">status</span>=1/FAILURE)<br> Main PID: 1069 (<span class="hljs-attribute">code</span>=exited, <span class="hljs-attribute">status</span>=0/SUCCESS)<br><br></code></pre></td></tr></table></figure><h3 id="在此电脑中挂载"><a href="#在此电脑中挂载" class="headerlink" title="在此电脑中挂载"></a>在此电脑中挂载</h3><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs autoit">[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># showmount -e 192.168.48.128</span><br>Export list <span class="hljs-keyword">for</span> <span class="hljs-number">192.168</span><span class="hljs-number">.48</span><span class="hljs-number">.128</span>:<br>/nfs *<br></code></pre></td></tr></table></figure><p>等你不要了，一定要先断开连接，否则等你关了服务器，你再点他会卡住，而且删不掉</p><p><img src="https://qianyios.top/img/nfs/nfs.png" alt="image"></p>]]></content>
    
    
    
    <tags>
      
      <tag>Centos7</tag>
      
      <tag>NFS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Centos 8 stream 部署 kvm</title>
    <link href="/2023/01/12/KVM/"/>
    <url>/2023/01/12/KVM/</url>
    
    <content type="html"><![CDATA[<h1 id="Centos-8-stream-部署-kvm"><a href="#Centos-8-stream-部署-kvm" class="headerlink" title="Centos 8 stream 部署 kvm"></a>Centos 8 stream 部署 kvm</h1><h2 id="环境部署"><a href="#环境部署" class="headerlink" title="环境部署"></a>环境部署</h2><table><thead><tr><th>网卡模式</th><th align="left">NAT模式</th></tr></thead><tbody><tr><td>ip</td><td align="left">192.168.48.10</td></tr><tr><td>内存</td><td align="left">4G</td></tr><tr><td>核心</td><td align="left">4</td></tr><tr><td>硬盘</td><td align="left">100G</td></tr><tr><td>功能</td><td align="left">AMD-V</td></tr></tbody></table><h3 id="设置主机名"><a href="#设置主机名" class="headerlink" title="设置主机名"></a>设置主机名</h3><figure class="highlight graphql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs graphql"><span class="hljs-punctuation">[</span>root<span class="hljs-meta">@localhost</span> ~<span class="hljs-punctuation">]</span><span class="hljs-comment"># hostnamectl set-hostname KVM &amp;&amp; bash</span><br><span class="hljs-punctuation">[</span>root<span class="hljs-meta">@KVM</span> ~<span class="hljs-punctuation">]</span><span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><h3 id="设置网络"><a href="#设置网络" class="headerlink" title="设置网络"></a>设置网络</h3><h4 id="设置虚拟机网络（ens160是NAT模式）"><a href="#设置虚拟机网络（ens160是NAT模式）" class="headerlink" title="设置虚拟机网络（ens160是NAT模式）"></a>设置虚拟机网络（ens160是NAT模式）</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs routeros">[root@KVM ~]# vi /etc/sysconfig/network-scripts/ifcfg-ens160<br><span class="hljs-attribute">BOOTPROTO</span>=static<br><span class="hljs-attribute">ONBOOT</span>=<span class="hljs-literal">yes</span><br><span class="hljs-attribute">IPADDR</span>=192.168.48.10<br><span class="hljs-attribute">PREFIX</span>=24<br><span class="hljs-attribute">GATEWAY</span>=192.168.48.2<br><span class="hljs-attribute">DNS1</span>=192.168.48.2<br><span class="hljs-attribute">DOMAIN</span>=114.114.114.114<br>[root@KVM ~]# nmcli c reload<br>[root@KVM ~]# nmcli c up ens160<span class="hljs-built_in"></span><br><span class="hljs-built_in">Connection </span>successfully activated (D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/4)<br>[root@KVM ~]#<span class="hljs-built_in"> ip </span>a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN<span class="hljs-built_in"> group default </span>qlen 1000<br>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host<br>       valid_lft forever preferred_lft forever<br>2: ens160: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP<span class="hljs-built_in"> group default </span>qlen 1000<br>    link/ether 00:0c:29:ce:a9:48 brd ff:ff:ff:ff:ff:ff<br>    altname enp3s0<br>    inet 192.168.48.10/24 brd 192.168.48.255 scope global noprefixroute ens160<br>       valid_lft forever preferred_lft forever<br>    inet6 fe80::20c:29ff:fece:a948/64 scope link noprefixroute<br>       valid_lft forever preferred_lft forever<br>[root@KVM ~]#<span class="hljs-built_in"> ping </span>-c 4 jd.com<span class="hljs-built_in"></span><br><span class="hljs-built_in">PING </span>jd.com (111.13.149.108) 56(84) bytes of data.<br>64 bytes <span class="hljs-keyword">from</span> 111.13.149.108 (111.13.149.108): <span class="hljs-attribute">icmp_seq</span>=1 <span class="hljs-attribute">ttl</span>=48 <span class="hljs-attribute">time</span>=47.8 ms<br>64 bytes <span class="hljs-keyword">from</span> 111.13.149.108 (111.13.149.108): <span class="hljs-attribute">icmp_seq</span>=2 <span class="hljs-attribute">ttl</span>=48 <span class="hljs-attribute">time</span>=48.2 ms<br>64 bytes <span class="hljs-keyword">from</span> 111.13.149.108 (111.13.149.108): <span class="hljs-attribute">icmp_seq</span>=3 <span class="hljs-attribute">ttl</span>=48 <span class="hljs-attribute">time</span>=48.2 ms<br>64 bytes <span class="hljs-keyword">from</span> 111.13.149.108 (111.13.149.108): <span class="hljs-attribute">icmp_seq</span>=4 <span class="hljs-attribute">ttl</span>=48 <span class="hljs-attribute">time</span>=48.3 ms<br><br>--- jd.com<span class="hljs-built_in"> ping </span>statistics ---<br>4 packets transmitted, 4 received, 0% packet loss, time 6077ms<br>rtt min/avg/max/mdev = 47.845/48.146/48.297/0.235 ms<br></code></pre></td></tr></table></figure><h3 id="检查虚拟机是否支持虚拟化"><a href="#检查虚拟机是否支持虚拟化" class="headerlink" title="检查虚拟机是否支持虚拟化"></a>检查虚拟机是否支持虚拟化</h3><h4 id="勾选cpu虚拟化（宿主机是amd芯片）"><a href="#勾选cpu虚拟化（宿主机是amd芯片）" class="headerlink" title="勾选cpu虚拟化（宿主机是amd芯片）"></a>勾选cpu虚拟化（宿主机是amd芯片）</h4><p><img src="https://i.328888.xyz/2023/01/13/wlOtv.png" alt="1"></p><h4 id="查看虚拟化是否支持"><a href="#查看虚拟化是否支持" class="headerlink" title="查看虚拟化是否支持"></a>查看虚拟化是否支持</h4><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs autoit">[root<span class="hljs-symbol">@KVM</span> ~]<span class="hljs-meta"># lscpu</span><br>Virtualization:      AMD-V<br>说明已支持虚拟化<br></code></pre></td></tr></table></figure><h3 id="设置阿里yum源"><a href="#设置阿里yum源" class="headerlink" title="设置阿里yum源"></a>设置阿里yum源</h3><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs tap">[root@KVM ~]<span class="hljs-comment"># cp /etc/yum.repos.d/CentOS-Stream-BaseOS.repo /etc/yum.repos.d/CentOS-Stream-BaseOS.repo.bak</span><br>[root@KVM ~]<span class="hljs-comment"># sed -i &#x27;s/mirrorlist/#mirrorlist/&#x27; /etc/yum.repos.d/CentOS-Stream-BaseOS.repo</span><br>[root@KVM ~]<span class="hljs-comment"># sed -i &#x27;s/#baseurl=http:\/\/mirror.centos.org/baseurl=http:\/\/mirrors.aliyun.com/g&#x27; /etc/yum.repos.d/CentOS-Stream-BaseOS.repo</span><br>[root@KVM ~]<span class="hljs-comment"># yum clean all &amp;&amp; yum makecache</span><br>0 files removed<br>CentOS Stream<span class="hljs-number"> 8 </span>- AppStream                                       <span class="hljs-number"> 14 </span>MB/s | <span class="hljs-number"> 27 </span>MB     00:01<br>CentOS Stream<span class="hljs-number"> 8 </span>- BaseOS                                          4.0 MB/s | <span class="hljs-number"> 26 </span>MB     00:06<br>CentOS Stream<span class="hljs-number"> 8 </span>- Extras                                          <span class="hljs-number"> 28 </span>kB/s | <span class="hljs-number"> 18 </span>kB     00:00<br>CentOS Stream<span class="hljs-number"> 8 </span>- Extras common packages                          8.2 kB/s | 5.2 kB     00:00<br>Metadata cache created.<br>[root@KVM ~]<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><h2 id="安装kvm"><a href="#安装kvm" class="headerlink" title="安装kvm"></a>安装kvm</h2><h3 id="安装kvm及其工具"><a href="#安装kvm及其工具" class="headerlink" title="安装kvm及其工具"></a>安装kvm及其工具</h3><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs ada">[root@KVM ~]# yum install qemu-kvm qemu-img  virt-manager libvirt virt-manager libvirt-client virt-install virt-viewer -y<br>Waiting <span class="hljs-keyword">for</span> process <span class="hljs-keyword">with</span> pid <span class="hljs-number">8674</span> to finish.<br>Last metadata expiration check: <span class="hljs-number">0</span>:<span class="hljs-number">00</span>:<span class="hljs-number">05</span> ago on Sun <span class="hljs-number">08</span> Jan <span class="hljs-number">2023</span> <span class="hljs-number">06</span>:<span class="hljs-number">03</span>:<span class="hljs-number">34</span> AM EST.<br><span class="hljs-keyword">Package</span> <span class="hljs-title">qemu-kvm-15:6.2.0-20.module_el8.7.0+1218+f626c2ff.1.x86_64 </span><span class="hljs-keyword">is</span> already installed.<br><span class="hljs-keyword">Package</span> <span class="hljs-title">qemu-img-15:6.2.0-20.module_el8.7.0+1218+f626c2ff.1.x86_64 </span><span class="hljs-keyword">is</span> already installed.<br><span class="hljs-keyword">Package</span> <span class="hljs-title">virt-manager-3.2.0-4.el8.noarch </span><span class="hljs-keyword">is</span> already installed.<br><span class="hljs-keyword">Package</span> <span class="hljs-title">libvirt-8.0.0-10.module_el8.7.0+1218+f626c2ff.x86_64 </span><span class="hljs-keyword">is</span> already installed.<br><span class="hljs-keyword">Package</span> <span class="hljs-title">libvirt-client-8.0.0-10.module_el8.7.0+1218+f626c2ff.x86_64 </span><span class="hljs-keyword">is</span> already installed.<br><span class="hljs-keyword">Package</span> <span class="hljs-title">virt-install-3.2.0-4.el8.noarch </span><span class="hljs-keyword">is</span> already installed.<br><span class="hljs-keyword">Package</span> <span class="hljs-title">virt-viewer-9.0-11.el8.x86_64 </span><span class="hljs-keyword">is</span> already installed.<br>Dependencies resolved.<br>Nothing to <span class="hljs-keyword">do</span>.<br>Complete!<br></code></pre></td></tr></table></figure><h3 id="启动libvirtd服务"><a href="#启动libvirtd服务" class="headerlink" title="启动libvirtd服务"></a>启动libvirtd服务</h3><p>启动服务并设置韦开机自启动，查看状态</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dts">[root@KVM ~]<span class="hljs-meta"># systemctl enable --now libvirtd</span><br>[root@KVM ~]<span class="hljs-meta"># systemctl status libvirtd</span><br>● libvirtd.service - Virtualization daemon<br><span class="hljs-symbol">   Loaded:</span> loaded (<span class="hljs-keyword">/usr/</span>lib<span class="hljs-keyword">/systemd/</span>system/libvirtd.<span class="hljs-attr">service</span><span class="hljs-punctuation">;</span> <span class="hljs-attr">enabled</span><span class="hljs-punctuation">;</span> vendor preset: enabled)<br><span class="hljs-symbol">   Active:</span> active (running) since Sun <span class="hljs-number">2023</span><span class="hljs-number">-01</span><span class="hljs-number">-08</span> <span class="hljs-number">06</span>:<span class="hljs-number">05</span>:<span class="hljs-number">12</span> EST<span class="hljs-punctuation">;</span> <span class="hljs-number">12</span>s ago<br><span class="hljs-symbol">     Docs:</span> man:libvirtd(<span class="hljs-number">8</span>)<br><span class="hljs-symbol">           https:</span><span class="hljs-comment">//libvirt.org</span><br></code></pre></td></tr></table></figure><h3 id="验证是否已加载kvm模块"><a href="#验证是否已加载kvm模块" class="headerlink" title="验证是否已加载kvm模块"></a>验证是否已加载kvm模块</h3><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs tap">[root@KVM ~]<span class="hljs-comment"># lsmod | grep kvm</span><br>kvm_amd              <span class="hljs-number"> 143360 </span> 0<br>ccp                  <span class="hljs-number"> 106496 </span><span class="hljs-number"> 1 </span>kvm_amd<br>kvm                  <span class="hljs-number"> 942080 </span><span class="hljs-number"> 1 </span>kvm_amd<br>irqbypass             <span class="hljs-number"> 16384 </span><span class="hljs-number"> 1 </span>kvm<br></code></pre></td></tr></table></figure><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">[root@KVM ~]# virsh list<br><span class="hljs-section"> Id   Name   State</span><br><span class="hljs-section">--------------------</span><br>说明kvm安装成功<br></code></pre></td></tr></table></figure><h2 id="设置宿主机网络（kvm这个机子）"><a href="#设置宿主机网络（kvm这个机子）" class="headerlink" title="设置宿主机网络（kvm这个机子）"></a>设置宿主机网络（kvm这个机子）</h2><h3 id="查看网络情况"><a href="#查看网络情况" class="headerlink" title="查看网络情况"></a>查看网络情况</h3><p>KVN软件安装后默认以NAT方式实现网络通信。为了让KVM虚拟机能够与宿主机、本地主机、互联网相互通信，需将宿主机（KVM这个机子）网络设置为bridge方式。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">ip <span class="hljs-selector-tag">a</span><br></code></pre></td></tr></table></figure><p>lo为回环接口，该接口不从外界接收和发送数据包，仅在操作系统内部接收和发送数据包</p><p>ens160是以太网接口，与网卡对应，每个硬件网卡对应一个以太网接口</p><p>virbr0为虚拟网络接口，由kvm创建，为连接其上的kvm虚拟机网络提供访问外部网络的功能</p><h3 id="创建bridge"><a href="#创建bridge" class="headerlink" title="创建bridge"></a>创建bridge</h3><p>创建 bridge 时需使用nmcli命令创建 br0，并将其绑定到可以正常工作的网络接口上，同时让br0成为连接宿主机与互联网的接口。</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs llvm">[root<span class="hljs-title">@KVM</span> ~]# nmcli connection <span class="hljs-keyword">add</span> <span class="hljs-keyword">type</span> bridge con-name <span class="hljs-keyword">br</span><span class="hljs-number">0</span> ifname <span class="hljs-keyword">br</span><span class="hljs-number">0</span> autoconnect yes<br><br>Connection &#x27;<span class="hljs-keyword">br</span><span class="hljs-number">0</span>&#x27; (ac<span class="hljs-number">3429</span>bc<span class="hljs-number">-907</span><span class="hljs-keyword">c</span><span class="hljs-number">-4</span>ad<span class="hljs-number">1</span>-bd<span class="hljs-number">54</span>-bbf<span class="hljs-number">39</span>d<span class="hljs-number">853</span>a<span class="hljs-number">53</span>) successfully added.<br>查看是否创建成功<br>[root<span class="hljs-title">@KVM</span> ~]# nmcli <span class="hljs-keyword">c</span><br>NAME    UUID                                  TYPE      DEVICE<br><span class="hljs-keyword">br</span><span class="hljs-number">0</span>     ac<span class="hljs-number">3429</span>bc<span class="hljs-number">-907</span><span class="hljs-keyword">c</span><span class="hljs-number">-4</span>ad<span class="hljs-number">1</span>-bd<span class="hljs-number">54</span>-bbf<span class="hljs-number">39</span>d<span class="hljs-number">853</span>a<span class="hljs-number">53</span>  bridge    <span class="hljs-keyword">br</span><span class="hljs-number">0</span><br>ens<span class="hljs-number">160</span>  <span class="hljs-number">0</span>d<span class="hljs-number">45e631</span>-b<span class="hljs-number">256</span><span class="hljs-number">-4e08</span>-b<span class="hljs-number">8</span>d<span class="hljs-number">8</span><span class="hljs-number">-2</span><span class="hljs-keyword">c</span><span class="hljs-number">42</span>b<span class="hljs-number">9481594</span>  ethernet  ens<span class="hljs-number">160</span><br>virbr<span class="hljs-number">0</span>  <span class="hljs-number">7075</span>d<span class="hljs-number">19</span>e-a<span class="hljs-number">20</span><span class="hljs-keyword">c</span><span class="hljs-number">-43</span>da-b<span class="hljs-number">161</span>-e<span class="hljs-number">7</span><span class="hljs-keyword">c</span><span class="hljs-number">7519</span>febdb  bridge    virbr<span class="hljs-number">0</span><br>网桥创建成功后会自动生成配置文件<br>[root<span class="hljs-title">@KVM</span> ~]# ls -l /etc/sysconfig/network-scripts/<br>-rw-r--r--. <span class="hljs-number">1</span> root root <span class="hljs-number">312</span> Jan  <span class="hljs-number">8</span> <span class="hljs-number">06</span>:<span class="hljs-number">20</span> ifcfg-<span class="hljs-keyword">br</span><span class="hljs-number">0</span><br>-rw-r--r--. <span class="hljs-number">1</span> root root <span class="hljs-number">365</span> Jan  <span class="hljs-number">8</span> <span class="hljs-number">05</span>:<span class="hljs-number">40</span> ifcfg-ens<span class="hljs-number">160</span><br></code></pre></td></tr></table></figure><h3 id="设置br0和ens160网卡"><a href="#设置br0和ens160网卡" class="headerlink" title="设置br0和ens160网卡"></a>设置br0和ens160网卡</h3><p>将br0桥接到ens160</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs llvm">[root<span class="hljs-title">@KVM</span> ~]# vi /etc/sysconfig/network-scripts/ifcfg-<span class="hljs-keyword">br</span><span class="hljs-number">0</span><br>BOOTPROTO<span class="hljs-operator">=</span>static<br>IPADDR<span class="hljs-operator">=</span><span class="hljs-number">192.168</span>.<span class="hljs-number">48.10</span><br>GATEWAY<span class="hljs-operator">=</span><span class="hljs-number">192.168</span>.<span class="hljs-number">48.2</span><br>PREFIX<span class="hljs-operator">=</span><span class="hljs-number">24</span><br>DNS<span class="hljs-operator">=</span><span class="hljs-number">114.114</span>.<span class="hljs-number">114.114</span><br>[root<span class="hljs-title">@KVM</span> ~]# vi /etc/sysconfig/network-scripts/ifcfg-ens<span class="hljs-number">160</span><br>BOOTPROTO<span class="hljs-operator">=</span>none<br>BRIDGE<span class="hljs-operator">=</span><span class="hljs-keyword">br</span><span class="hljs-number">0</span><br>[root<span class="hljs-title">@KVM</span> ~]# nmcli <span class="hljs-keyword">c</span> reload<br>[root<span class="hljs-title">@KVM</span> ~]# nmcli <span class="hljs-keyword">c</span> drow <span class="hljs-keyword">br</span><span class="hljs-number">0</span>r<br>此时如果你是用ssh工具连着的，你会断开，此时你要去vm那里输入<br>[root<span class="hljs-title">@KVM</span> ~]# nmcli <span class="hljs-keyword">c</span> up <span class="hljs-keyword">br</span><span class="hljs-number">0</span><br>[root<span class="hljs-title">@KVM</span> ~]# nmcli <span class="hljs-keyword">c</span> up ens<span class="hljs-number">160</span><br>然后等<span class="hljs-number">1</span>分钟左右，就可以连上ssh工具了<br></code></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs routeros">测试网络连通性<br>[root@KVM ~]#<span class="hljs-built_in"> ping </span>-c 2 jd.com<span class="hljs-built_in"></span><br><span class="hljs-built_in">PING </span>jd.com (211.144.24.218) 56(84) bytes of data.<br>64 bytes <span class="hljs-keyword">from</span> 211.144.24.218 (211.144.24.218): <span class="hljs-attribute">icmp_seq</span>=1 <span class="hljs-attribute">ttl</span>=128 <span class="hljs-attribute">time</span>=50.7 ms<br>64 bytes <span class="hljs-keyword">from</span> 211.144.24.218 (211.144.24.218): <span class="hljs-attribute">icmp_seq</span>=2 <span class="hljs-attribute">ttl</span>=128 <span class="hljs-attribute">time</span>=51.9 ms<br><br>--- jd.com<span class="hljs-built_in"> ping </span>statistics ---<br>2 packets transmitted, 2 received, 0% packet loss, time 1002ms<br>rtt min/avg/max/mdev = 50.683/51.286/51.890/0.644 ms<br>[root@KVM ~]#<br></code></pre></td></tr></table></figure><h2 id="创建kvm虚拟机"><a href="#创建kvm虚拟机" class="headerlink" title="创建kvm虚拟机"></a>创建kvm虚拟机</h2><table><thead><tr><th>存储池</th><th>存放目录</th><th>内容规划</th></tr></thead><tbody><tr><td>disk</td><td>&#x2F;opt&#x2F;disk</td><td>存放KVM磁盘文件</td></tr><tr><td>存放iso</td><td>&#x2F;opt&#x2F;iso</td><td>存放待安装的ISO文件</td></tr></tbody></table><h3 id="创建iso存储池"><a href="#创建iso存储池" class="headerlink" title="创建iso存储池"></a>创建iso存储池</h3><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript">[root@KVM ~]<span class="hljs-comment"># mkdir -p /opt/iso</span><br>[root@KVM ~]<span class="hljs-comment"># chown root:root /opt/iso/</span><br>[root@KVM ~]<span class="hljs-comment"># chmod 777 /opt/iso/</span><br>[root@KVM ~]<span class="hljs-comment"># virsh pool-define-as iso --type dir --target /opt/iso/ </span><br>Pool iso--type defined<br><span class="hljs-comment">#名称为iso的存储池定义成功</span><br>如果名字打错 用<br>virsh pool-destroy [名字]<br>virsh pool-undefine [名字] 删除<br>[root@KVM ~]<span class="hljs-comment"># virsh pool-list --all</span><br> Name   State      Autostart<br>------------------------------<br> iso    inactive   <span class="hljs-literal">no</span><br><br>[root@KVM ~]<span class="hljs-comment"># virsh pool-build iso</span><br>Pool iso built<br><span class="hljs-comment">#创建名为iso的存储池</span><br>[root@KVM ~]<span class="hljs-comment"># virsh pool-start iso</span><br>Pool iso started<br><span class="hljs-comment">#启动iso存储池</span><br>[root@KVM ~]<span class="hljs-comment"># virsh pool-autostart iso</span><br>Pool iso marked <span class="hljs-keyword">as</span> autostarted<br><span class="hljs-comment">#设置iso存储池自启动</span><br>查看iso信息<br>[root@KVM ~]<span class="hljs-comment"># virsh pool-info iso</span><br>Name:           iso<br>UUID:           a966995e<span class="hljs-number">-2722</span><span class="hljs-number">-4</span>a3f-a318-e158a642439e<br>State:          running<br>Persistent:     <span class="hljs-literal">yes</span><br>Autostart:      <span class="hljs-literal">yes</span><br>Capacity:       <span class="hljs-number">63.84</span> GiB<br>Allocation:     <span class="hljs-number">2.75</span> GiB<br>Available:      <span class="hljs-number">61.09</span> GiB<br></code></pre></td></tr></table></figure><h3 id="创建disk存储池"><a href="#创建disk存储池" class="headerlink" title="创建disk存储池"></a>创建disk存储池</h3><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript">[root@KVM ~]<span class="hljs-comment"># mkdir -p /opt/disk</span><br>[root@KVM ~]<span class="hljs-comment"># chown root:root /opt/disk/</span><br>[root@KVM ~]<span class="hljs-comment"># chmod 777 /opt/disk/</span><br>[root@KVM ~]<span class="hljs-comment"># virsh pool-define-as disk --type dir --target /opt/disk/ </span><br>Pool disk defined<br><br>[root@KVM ~]<span class="hljs-comment"># virsh pool-build disk</span><br>Pool disk built<br><br>[root@KVM ~]<span class="hljs-comment"># virsh pool-start disk</span><br>Pool disk started<br><br>[root@KVM ~]<span class="hljs-comment"># virsh pool-autostart disk</span><br>Pool disk marked <span class="hljs-keyword">as</span> autostarted<br><br>[root@KVM ~]<span class="hljs-comment"># virsh pool-info disk</span><br>Name:           disk<br>UUID:           <span class="hljs-number">30</span>d784dc<span class="hljs-number">-386</span>b<span class="hljs-number">-46e6</span>-a22b<span class="hljs-number">-79</span>a3b3447354<br>State:          running<br>Persistent:     <span class="hljs-literal">yes</span><br>Autostart:      <span class="hljs-literal">yes</span><br>Capacity:       <span class="hljs-number">63.84</span> GiB<br>Allocation:     <span class="hljs-number">2.75</span> GiB<br>Available:      <span class="hljs-number">61.09</span> GiB<br></code></pre></td></tr></table></figure><h3 id="获取Centos7"><a href="#获取Centos7" class="headerlink" title="获取Centos7"></a>获取Centos7</h3><h4 id="下载Centos7最小化版本到ISO目录下（网络方式）"><a href="#下载Centos7最小化版本到ISO目录下（网络方式）" class="headerlink" title="下载Centos7最小化版本到ISO目录下（网络方式）"></a>下载Centos7最小化版本到ISO目录下（网络方式）</h4><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs gradle">[root@KVM ~]# yum install -y wget<br>[root@KVM ~]# wget -O <span class="hljs-regexp">/opt/i</span>so<span class="hljs-regexp">/Centos7.iso https:/</span><span class="hljs-regexp">/mirrors.aliyun.com/</span>centos<span class="hljs-regexp">/7.9.2009/i</span>sos<span class="hljs-regexp">/x86_64/</span>CentOS-<span class="hljs-number">7</span>-x86_64-Minimal-<span class="hljs-number">2009</span>.iso<br>--<span class="hljs-number">2023</span>-<span class="hljs-number">01</span>-<span class="hljs-number">08</span> <span class="hljs-number">08</span>:<span class="hljs-number">09</span>:<span class="hljs-number">00</span>--  https:<span class="hljs-comment">//mirrors.aliyun.com/centos/7.9.2009/isos/x86_64/CentOS-7-x86_64-Minimal-2009.iso</span><br>Resolving mirrors.aliyun.com (mirrors.aliyun.com)... <span class="hljs-number">120.241</span>.<span class="hljs-number">238.243</span>, <span class="hljs-number">120.241</span>.<span class="hljs-number">238.242</span>, <span class="hljs-number">120.241</span>.<span class="hljs-number">238.241</span>, ...<br>Connecting to mirrors.aliyun.com (mirrors.aliyun.com)|<span class="hljs-number">120.241</span>.<span class="hljs-number">238.243</span>|:<span class="hljs-number">443</span>... connected.<br>HTTP request sent, awaiting response... <span class="hljs-number">200</span> OK<br>Length: <span class="hljs-number">1020264448</span> (<span class="hljs-number">973</span>M) [application/x-cd-image]<br>Saving to: ‘<span class="hljs-regexp">/opt/i</span>so/Centos7.iso’<br><br><span class="hljs-regexp">/opt/i</span>so<span class="hljs-regexp">/Centos7.iso     100%[================================&gt;] 973.00M  1.53MB/</span>s    in <span class="hljs-number">10</span>m <span class="hljs-number">54</span>s<br><br><span class="hljs-number">2023</span>-<span class="hljs-number">01</span>-<span class="hljs-number">08</span> <span class="hljs-number">08</span>:<span class="hljs-number">19</span>:<span class="hljs-number">54</span> (<span class="hljs-number">1.49</span> MB<span class="hljs-regexp">/s) - ‘/</span>opt<span class="hljs-regexp">/iso/</span>Centos7.iso’ saved [<span class="hljs-number">1020264448</span>/<span class="hljs-number">1020264448</span>]<br>[root@KVM ~]# ll <span class="hljs-regexp">/opt/i</span>so<br>total <span class="hljs-number">996352</span><br>-rw-r--r--. <span class="hljs-number">1</span> root root <span class="hljs-number">1020264448</span> Nov  <span class="hljs-number">3</span>  <span class="hljs-number">2020</span> Centos7.iso<br></code></pre></td></tr></table></figure><h4 id="也可以本地下载好后，上传至iso目录（本地方式）"><a href="#也可以本地下载好后，上传至iso目录（本地方式）" class="headerlink" title="也可以本地下载好后，上传至iso目录（本地方式）"></a>也可以本地下载好后，上传至iso目录（本地方式）</h4><p>下载连接：<a href="https://mirrors.aliyun.com/centos/7.9.2009/isos/x86_64/CentOS-7-x86_64-Minimal-2009.iso">https://mirrors.aliyun.com/centos/7.9.2009/isos/x86_64/CentOS-7-x86_64-Minimal-2009.iso</a></p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs tap">[root@KVM ~]<span class="hljs-comment"># ll /opt/iso</span><br>total 996352<br>-rw-r--r--.<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 1020264448 </span>Nov <span class="hljs-number"> 3 </span><span class="hljs-number"> 2020 </span>Centos7.iso<br></code></pre></td></tr></table></figure><h3 id="安装Centos7"><a href="#安装Centos7" class="headerlink" title="安装Centos7"></a>安装Centos7</h3><h4 id="无界面安装Centos7"><a href="#无界面安装Centos7" class="headerlink" title="无界面安装Centos7"></a>无界面安装Centos7</h4><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs vim">[root@KVM ~]# virt-install --virt-<span class="hljs-built_in">type</span>=kvm --name=Centos7 --vcpus=<span class="hljs-number">1</span> --memory=<span class="hljs-number">2048</span> --network bridge=br0,model=virtio --os-<span class="hljs-built_in">type</span>=linux --os-variant=rhel7.<span class="hljs-number">7</span> --location=/<span class="hljs-keyword">opt</span>/iso/Centos7.iso --disk /<span class="hljs-keyword">opt</span>/disk/Centos7.qcow2,format=qcow2,size=<span class="hljs-number">10</span> --console=pty,target_type=serial --graphics=none --extra-<span class="hljs-keyword">args</span>=<span class="hljs-string">&quot;console=tty0 console=ttyS0&quot;</span><br><br>Starting install...<br>Retrieving <span class="hljs-keyword">file</span> vmlinuz...                                                 | <span class="hljs-number">6.5</span> MB  <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span><br>Retrieving <span class="hljs-keyword">file</span> initrd.img...                                              |  <span class="hljs-number">53</span> MB  <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span><br>Allocating <span class="hljs-string">&#x27;Centos7.qcow2&#x27;</span>                                                 |  <span class="hljs-number">10</span> GB  <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span><br>Running text console <span class="hljs-keyword">command</span>: virsh --connect qemu:///<span class="hljs-built_in">system</span> console Centos7<br>Connected <span class="hljs-keyword">to</span> domain <span class="hljs-string">&#x27;Centos7&#x27;</span><br>......<br>进入安装界面<br><br>Connected <span class="hljs-keyword">to</span> domain <span class="hljs-string">&#x27;Centos7&#x27;</span><br>  Please <span class="hljs-keyword">make</span> your choice from above [<span class="hljs-string">&#x27;q&#x27;</span> <span class="hljs-keyword">to</span> <span class="hljs-keyword">quit</span> | <span class="hljs-string">&#x27;b&#x27;</span> <span class="hljs-keyword">to</span> begin installation |<br>  <span class="hljs-string">&#x27;r&#x27;</span> <span class="hljs-keyword">to</span> refresh]:   Please <span class="hljs-keyword">make</span> your choice from above [<span class="hljs-string">&#x27;q&#x27;</span> <span class="hljs-keyword">to</span> <span class="hljs-keyword">quit</span> | <span class="hljs-string">&#x27;b&#x27;</span> <span class="hljs-keyword">to</span> begin installation |<br>================================================================================<br>================================================================================<br>Installation<br><br> <span class="hljs-number">1</span>) [<span class="hljs-keyword">x</span>] Language settings                 <span class="hljs-number">2</span>) [!] Time settings<br>        (English (United States))                (Timezone <span class="hljs-keyword">is</span> not <span class="hljs-keyword">set</span>.)<br> <span class="hljs-number">3</span>) [<span class="hljs-keyword">x</span>] Installation <span class="hljs-keyword">source</span>               <span class="hljs-number">4</span>) [<span class="hljs-keyword">x</span>] Software selection<br>        (Local media)                            (Minimal Install)<br> <span class="hljs-number">5</span>) [!] Installation Destination          <span class="hljs-number">6</span>) [<span class="hljs-keyword">x</span>] Kdump<br>        (No disks selected)                      (Kdump <span class="hljs-keyword">is</span> enabled)<br> <span class="hljs-number">7</span>) [ ] Network configuration             <span class="hljs-number">8</span>) [!] Root password<br>        (Not connected)                          (Password <span class="hljs-keyword">is</span> not <span class="hljs-keyword">set</span>.)<br> <span class="hljs-number">9</span>) [!] User creation<br>        (No user will <span class="hljs-keyword">be</span> created)<br>  Please <span class="hljs-keyword">make</span> your choice from above [<span class="hljs-string">&#x27;q&#x27;</span> <span class="hljs-keyword">to</span> <span class="hljs-keyword">quit</span> | <span class="hljs-string">&#x27;b&#x27;</span> <span class="hljs-keyword">to</span> begin installation |<br>  <span class="hljs-string">&#x27;r&#x27;</span> <span class="hljs-keyword">to</span> refresh]:   Please <span class="hljs-keyword">make</span> your choice from above [<span class="hljs-string">&#x27;q&#x27;</span> <span class="hljs-keyword">to</span> <span class="hljs-keyword">quit</span> | <span class="hljs-string">&#x27;b&#x27;</span> <span class="hljs-keyword">to</span> begin installation |<br><br></code></pre></td></tr></table></figure><h4 id="输入2设置时区"><a href="#输入2设置时区" class="headerlink" title="输入2设置时区"></a>输入2设置时区</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs routeros">================================================================================<br>================================================================================<br>Time<span class="hljs-built_in"> settings</span><br><span class="hljs-built_in"></span><br>Timezone: <span class="hljs-keyword">not</span> <span class="hljs-built_in">set</span><br><span class="hljs-built_in"></span><br><span class="hljs-built_in">NTP </span>servers<span class="hljs-keyword">:not</span> configured<br><br> 1)  <span class="hljs-built_in">Set</span> timezone<br> 2)  Configure<span class="hljs-built_in"> NTP </span>servers<br>  Please make your choice <span class="hljs-keyword">from</span> above [<span class="hljs-string">&#x27;q&#x27;</span> <span class="hljs-keyword">to</span> quit | <span class="hljs-string">&#x27;c&#x27;</span> <span class="hljs-keyword">to</span> continue |<br>  <span class="hljs-string">&#x27;r&#x27;</span> <span class="hljs-keyword">to</span> refresh]:<br>================================================================================<br>================================================================================<br>按1根据提示选择Asia/shanghai   然后按c<br></code></pre></td></tr></table></figure><h4 id="输入5设置磁盘（Installation-Destination-）"><a href="#输入5设置磁盘（Installation-Destination-）" class="headerlink" title="输入5设置磁盘（Installation Destination ）"></a>输入5设置磁盘（Installation Destination ）</h4><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">Probing storage...<br>Installation Destination<br><br>[x] 1) : 10 GiB (vda)<br><br><span class="hljs-number">1</span> disk selected; 10 GiB capacity; 10 GiB free ...<br><br>  Please make your choice <span class="hljs-keyword">from</span> above [<span class="hljs-string">&#x27;q&#x27;</span> <span class="hljs-keyword">to</span> quit | <span class="hljs-string">&#x27;c&#x27;</span> <span class="hljs-keyword">to</span> <span class="hljs-keyword">continue</span> |<br>  <span class="hljs-string">&#x27;r&#x27;</span> <span class="hljs-keyword">to</span> refresh]:<br>Autopartitioning Options<br>再按c<br>================================================================================<br>[ ] <span class="hljs-number">1</span>) <span class="hljs-built_in">Replace</span> Existing Linux <span class="hljs-keyword">system</span>(s)<br><br>[x] <span class="hljs-number">2</span>) <span class="hljs-keyword">Use</span> <span class="hljs-keyword">All</span> Space<br><br>[ ] <span class="hljs-number">3</span>) <span class="hljs-keyword">Use</span> Free Space<br><br>Installation requires partitioning of your hard drive. <span class="hljs-keyword">Select</span> what space <span class="hljs-keyword">to</span> <span class="hljs-keyword">use</span><br><span class="hljs-keyword">for</span> the install target.<br><br>  Please make your choice <span class="hljs-keyword">from</span> above [<span class="hljs-string">&#x27;q&#x27;</span> <span class="hljs-keyword">to</span> quit | <span class="hljs-string">&#x27;c&#x27;</span> <span class="hljs-keyword">to</span> <span class="hljs-keyword">continue</span> |<br>  再按c<br>================================================================================<br><span class="hljs-keyword">Partition</span> Scheme Options<br><br>[ ] <span class="hljs-number">1</span>) Standard <span class="hljs-keyword">Partition</span><br><br>[ ] <span class="hljs-number">2</span>) Btrfs<br><br>[x] <span class="hljs-number">3</span>) LVM<br><br>[ ] <span class="hljs-number">4</span>) LVM Thin Provisioning<br><br><span class="hljs-keyword">Select</span> a <span class="hljs-keyword">partition</span> scheme configuration.<br><br>  Please make your choice <span class="hljs-keyword">from</span> above [<span class="hljs-string">&#x27;q&#x27;</span> <span class="hljs-keyword">to</span> quit | <span class="hljs-string">&#x27;c&#x27;</span> <span class="hljs-keyword">to</span> <span class="hljs-keyword">continue</span> |<br>  <span class="hljs-string">&#x27;r&#x27;</span> <span class="hljs-keyword">to</span> refresh]: c<br>Generating updated storage configuration<br>Checking storage configuration...<br></code></pre></td></tr></table></figure><h4 id="按8设置root密码"><a href="#按8设置root密码" class="headerlink" title="按8设置root密码"></a>按8设置root密码</h4><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-code">  &#x27;r&#x27; to refresh]: 8</span><br>================================================================================<br>        (Not connected)<br> 9) [!] User creation<br>================================================================================<br>Please select new root password. You will have to type it twice.<br><br>Password:<br><span class="hljs-section">Password (confirm):</span><br><span class="hljs-section">================================================================================</span><br>================================================================================<br>Question<br><br>The password you have provided is weak: The password fails the dictionary check<br>- it is too simplistic/systematic.<br>Would you like to use it anyway?<br><br>Please respond &#x27;yes&#x27; or &#x27;no&#x27;: yes<br></code></pre></td></tr></table></figure><h4 id="全部设置完成后按b确认"><a href="#全部设置完成后按b确认" class="headerlink" title="全部设置完成后按b确认"></a>全部设置完成后按b确认</h4><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs gradle">  <span class="hljs-string">&#x27;r&#x27;</span> to refresh]: b<br>================================================================================<br>================================================================================<br>Progress<br>Setting up the installation environment<br>.<br>Creating disklabel on <span class="hljs-regexp">/dev/</span>vda<br>.<br>Creating xfs on <span class="hljs-regexp">/dev/</span>vda1<br>.<br>Creating lvmpv on <span class="hljs-regexp">/dev/</span>vda2<br>.<br>Creating swap on <span class="hljs-regexp">/dev/m</span>apper/centos-swap<br>.<br>Creating xfs on <span class="hljs-regexp">/dev/m</span>apper/centos-root<br>.<br>Running pre-installation scripts<br>.<br>Starting <span class="hljs-keyword">package</span> installation process<br>就会开始安装<br></code></pre></td></tr></table></figure><h4 id="进入登入界面"><a href="#进入登入界面" class="headerlink" title="进入登入界面"></a>进入登入界面</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">CentOS</span> Linux <span class="hljs-number">7</span> (Core)<br><span class="hljs-attribute">Kernel</span> <span class="hljs-number">3</span>.<span class="hljs-number">10</span>.<span class="hljs-number">0</span>-<span class="hljs-number">1160</span>.el7.x86_64 <span class="hljs-literal">on</span> an x86_64<br><br><span class="hljs-attribute">localhost</span> login:<br><br></code></pre></td></tr></table></figure><h2 id="管理kvm虚拟机"><a href="#管理kvm虚拟机" class="headerlink" title="管理kvm虚拟机"></a>管理kvm虚拟机</h2><h3 id="连接KVM虚拟机"><a href="#连接KVM虚拟机" class="headerlink" title="连接KVM虚拟机"></a>连接KVM虚拟机</h3><blockquote><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs perl">[root@KVM ~]<span class="hljs-comment"># virsh console Centos7</span><br>Connected to domain <span class="hljs-string">&#x27;Centos7&#x27;</span><br>Escape character is ^] (Ctrl + ])<br>error: operation failed: Active console session <span class="hljs-keyword">exists</span> <span class="hljs-keyword">for</span> this domain<br>如果你之前连接过，没有退出，但是你与宿主机的ssh断了，就会出现这种问题，也就是你之前的连接控制台的连接还存在；<br>每次连接kvm之后要退出 ctrl+] 就可以退出<br>解决办法：<br>[root@KVM ~]<span class="hljs-comment"># ps  -ef  |grep virsh</span><br>root       <span class="hljs-number">65402</span>   <span class="hljs-number">61750</span>  <span class="hljs-number">0</span> <span class="hljs-number">02</span>:<span class="hljs-number">26</span> pts/<span class="hljs-number">0</span>    <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> virsh --<span class="hljs-keyword">connect</span> qemu:<span class="hljs-regexp">//</span><span class="hljs-regexp">/system console Centos7</span><br><span class="hljs-regexp">root       68540   66569  0 02:35 pts/</span><span class="hljs-number">2</span>    <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> <span class="hljs-keyword">grep</span> --color=auto virsh<br>[root@KVM ~]<span class="hljs-comment"># kill -9 61750</span><br>[root@KVM ~]<span class="hljs-comment"># kill -9 65402</span><br></code></pre></td></tr></table></figure></blockquote><h4 id="查看KVM虚拟机状态"><a href="#查看KVM虚拟机状态" class="headerlink" title="查看KVM虚拟机状态"></a>查看KVM虚拟机状态</h4><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">[root@KVM ~]# virsh list<br><span class="hljs-section"> Id   Name      State</span><br><span class="hljs-section">-------------------------</span><br><span class="hljs-code"> 2    Centos7   running</span><br></code></pre></td></tr></table></figure><h4 id="连接虚拟机"><a href="#连接虚拟机" class="headerlink" title="连接虚拟机"></a>连接虚拟机</h4><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs livescript">[root@KVM ~]<span class="hljs-comment"># virsh console Centos7</span><br>Connected <span class="hljs-keyword">to</span> domain <span class="hljs-string">&#x27;Centos7&#x27;</span><br>Escape character <span class="hljs-keyword">is</span> ^] (Ctrl + ])<br><br>[root@localhost ~]<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><h3 id="初始化KVM虚拟机"><a href="#初始化KVM虚拟机" class="headerlink" title="初始化KVM虚拟机"></a>初始化KVM虚拟机</h3><h4 id="设置名字"><a href="#设置名字" class="headerlink" title="设置名字"></a>设置名字</h4><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs autoit">[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># hostnamectl set-hostname Centos7 &amp;&amp; bash</span><br>[root<span class="hljs-symbol">@centos7</span> ~]<span class="hljs-meta">#</span><br></code></pre></td></tr></table></figure><h4 id="设置网络-1"><a href="#设置网络-1" class="headerlink" title="设置网络"></a>设置网络</h4><h5 id="查看状态"><a href="#查看状态" class="headerlink" title="查看状态"></a>查看状态</h5><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs pf">[root@centos7 ~]<span class="hljs-comment"># ip a</span><br><span class="hljs-number">1</span>: lo: <span class="hljs-variable">&lt;LOOPBACK,UP,LOWER_UP&gt;</span> mtu <span class="hljs-number">65536</span> qdisc noqueue <span class="hljs-keyword">state</span> UNKNOWN <span class="hljs-keyword">group</span> <span class="hljs-keyword">default</span> qlen <span class="hljs-number">1000</span><br>    link/loopback <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> brd <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span><br>    <span class="hljs-keyword">inet</span> <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>/<span class="hljs-number">8</span> scope host lo<br>       valid_lft forever preferred_lft forever<br>    <span class="hljs-keyword">inet6</span> ::<span class="hljs-number">1</span>/<span class="hljs-number">128</span> scope host<br>       valid_lft forever preferred_lft forever<br><span class="hljs-number">2</span>: eth0: <span class="hljs-variable">&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;</span> mtu <span class="hljs-number">1500</span> qdisc pfifo_fast <span class="hljs-keyword">state</span> UP <span class="hljs-keyword">group</span> <span class="hljs-keyword">default</span> qlen <span class="hljs-number">1000</span><br>    link/ether <span class="hljs-number">52</span>:<span class="hljs-number">54</span>:<span class="hljs-number">00</span>:b2:b9:d1 brd ff:ff:ff:ff:ff:ff<br></code></pre></td></tr></table></figure><h5 id="编辑配置文件"><a href="#编辑配置文件" class="headerlink" title="编辑配置文件"></a>编辑配置文件</h5><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[root@centos7 ~]</span><span class="hljs-comment"># vi /etc/sysconfig/network-scripts/ifcfg-eth0</span><br><span class="hljs-attr">TYPE</span>=Ethernet<br><span class="hljs-attr">PROXY_METHOD</span>=none<br><span class="hljs-attr">BROWSER_ONLY</span>=<span class="hljs-literal">no</span><br><span class="hljs-attr">BOOTPROTO</span>=static         ---<br><span class="hljs-attr">DEFROUTE</span>=<span class="hljs-literal">yes</span><br><span class="hljs-attr">IPV4_FAILURE_FATAL</span>=<span class="hljs-literal">no</span><br><span class="hljs-attr">IPV6INIT</span>=<span class="hljs-literal">yes</span><br><span class="hljs-attr">IPV6_AUTOCONF</span>=<span class="hljs-literal">yes</span><br><span class="hljs-attr">IPV6_DEFROUTE</span>=<span class="hljs-literal">yes</span><br><span class="hljs-attr">IPV6_FAILURE_FATAL</span>=<span class="hljs-literal">no</span><br><span class="hljs-attr">IPV6_ADDR_GEN_MODE</span>=stable-privacy<br><span class="hljs-attr">NAME</span>=eth0<br><span class="hljs-attr">UUID</span>=b7053508-<span class="hljs-number">5183</span>-<span class="hljs-number">4</span>ee4-<span class="hljs-number">8</span>af5-<span class="hljs-number">8</span>d5241f57116<br><span class="hljs-attr">DEVICE</span>=eth0<br><span class="hljs-attr">ONBOOT</span>=<span class="hljs-literal">yes</span>                  ---<br><span class="hljs-attr">IPADDR</span>=<span class="hljs-number">192.168</span>.<span class="hljs-number">48.11</span>        ---<br><span class="hljs-attr">PREFIX</span>=<span class="hljs-number">24</span>                   ---<br><span class="hljs-attr">GATEWAY</span>=<span class="hljs-number">192.168</span>.<span class="hljs-number">48.2</span>        ---<br><span class="hljs-attr">DNS1</span>=<span class="hljs-number">114.114</span>.<span class="hljs-number">114.114</span>        ---<br></code></pre></td></tr></table></figure><h5 id="查看KVM网络信息"><a href="#查看KVM网络信息" class="headerlink" title="查看KVM网络信息"></a>查看KVM网络信息</h5><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs pf">[root@centos7 ~]<span class="hljs-comment"># systemctl restart network</span><br>[root@centos7 ~]<span class="hljs-comment"># ip a</span><br><span class="hljs-number">1</span>: lo: <span class="hljs-variable">&lt;LOOPBACK,UP,LOWER_UP&gt;</span> mtu <span class="hljs-number">65536</span> qdisc noqueue <span class="hljs-keyword">state</span> UNKNOWN <span class="hljs-keyword">group</span> <span class="hljs-keyword">default</span> qlen <span class="hljs-number">1000</span><br>    link/loopback <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> brd <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span><br>    <span class="hljs-keyword">inet</span> <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>/<span class="hljs-number">8</span> scope host lo<br>       valid_lft forever preferred_lft forever<br>    <span class="hljs-keyword">inet6</span> ::<span class="hljs-number">1</span>/<span class="hljs-number">128</span> scope host<br>       valid_lft forever preferred_lft forever<br><span class="hljs-number">2</span>: eth0: <span class="hljs-variable">&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;</span> mtu <span class="hljs-number">1500</span> qdisc pfifo_fast <span class="hljs-keyword">state</span> UP <span class="hljs-keyword">group</span> <span class="hljs-keyword">default</span> qlen <span class="hljs-number">1000</span><br>    link/ether <span class="hljs-number">52</span>:<span class="hljs-number">54</span>:<span class="hljs-number">00</span>:b2:b9:d1 brd ff:ff:ff:ff:ff:ff<br>    <span class="hljs-keyword">inet</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">48.11</span>/<span class="hljs-number">24</span> brd <span class="hljs-number">192.168</span>.<span class="hljs-number">48.255</span> scope <span class="hljs-keyword">global</span> noprefixroute eth0<br>       valid_lft forever preferred_lft forever<br>    <span class="hljs-keyword">inet6</span> fe80::<span class="hljs-number">85</span>d6:dde0:<span class="hljs-number">25</span>ad:<span class="hljs-number">9</span>c43/<span class="hljs-number">64</span> scope link noprefixroute<br>       valid_lft forever preferred_lft forever<br>[root@centos7 ~]<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><p>测试一下ssh工具是不是也可以连（cmd、MobaXterm）</p><h5 id="测试连通性"><a href="#测试连通性" class="headerlink" title="测试连通性"></a>测试连通性</h5><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs routeros">ping KVM机子<br>[root@centos7 ~]#<span class="hljs-built_in"> ping </span>192.168.48.10 -c 2<span class="hljs-built_in"></span><br><span class="hljs-built_in">PING </span>192.168.48.10 (192.168.48.10) 56(84) bytes of data.<br>64 bytes <span class="hljs-keyword">from</span> 192.168.48.10: <span class="hljs-attribute">icmp_seq</span>=1 <span class="hljs-attribute">ttl</span>=64 <span class="hljs-attribute">time</span>=0.481 ms<br>64 bytes <span class="hljs-keyword">from</span> 192.168.48.10: <span class="hljs-attribute">icmp_seq</span>=2 <span class="hljs-attribute">ttl</span>=64 <span class="hljs-attribute">time</span>=0.254 ms<br><br>--- 192.168.48.10<span class="hljs-built_in"> ping </span>statistics ---<br>2 packets transmitted, 2 received, 0% packet loss, time 1000ms<br>rtt min/avg/max/mdev = 0.254/0.367/0.481/0.115 ms<span class="hljs-built_in"></span><br><span class="hljs-built_in">ping </span>百度<br>[root@centos7 ~]#<span class="hljs-built_in"> ping </span>baidu.com -c 2<span class="hljs-built_in"></span><br><span class="hljs-built_in">PING </span>baidu.com (39.156.66.10) 56(84) bytes of data.<br>64 bytes <span class="hljs-keyword">from</span> 39.156.66.10 (39.156.66.10): <span class="hljs-attribute">icmp_seq</span>=1 <span class="hljs-attribute">ttl</span>=128 <span class="hljs-attribute">time</span>=43.5 ms<br>64 bytes <span class="hljs-keyword">from</span> 39.156.66.10 (39.156.66.10): <span class="hljs-attribute">icmp_seq</span>=2 <span class="hljs-attribute">ttl</span>=128 <span class="hljs-attribute">time</span>=44.9 ms<br><br>--- baidu.com<span class="hljs-built_in"> ping </span>statistics ---<br>2 packets transmitted, 2 received, 0% packet loss, time 1001ms<br>rtt min/avg/max/mdev = 43.599/44.258/44.917/0.659 ms<br>[root@centos7 ~]#<br></code></pre></td></tr></table></figure><h4 id="设置Centos7虚拟机随KVM宿主机开机自启动"><a href="#设置Centos7虚拟机随KVM宿主机开机自启动" class="headerlink" title="设置Centos7虚拟机随KVM宿主机开机自启动"></a>设置Centos7虚拟机随KVM宿主机开机自启动</h4><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs gradle">[root@KVM ~]# virsh autostart Centos7<br>Domain <span class="hljs-string">&#x27;Centos7&#x27;</span> marked as autostarted<br><br>开机自启动配置后，会在<span class="hljs-regexp">/etc/</span>libvirt<span class="hljs-regexp">/qemu/</span>autostart/目录中增加XML格式<br>[root@KVM ~]# ls <span class="hljs-regexp">/etc/</span>libvirt<span class="hljs-regexp">/qemu/</span>autostart/<br>Centos7.xml<br></code></pre></td></tr></table></figure><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">virsh autostart <span class="hljs-comment">--disable 关闭开机自启动</span><br>[root@KVM ~]# virsh autostart <span class="hljs-comment">--disable Centos7</span><br><span class="hljs-keyword">Domain</span> <span class="hljs-string">&#x27;Centos7&#x27;</span> unmarked <span class="hljs-keyword">as</span> autostarted<br></code></pre></td></tr></table></figure><h3 id="为KVM虚拟机增加CPU"><a href="#为KVM虚拟机增加CPU" class="headerlink" title="为KVM虚拟机增加CPU"></a>为KVM虚拟机增加CPU</h3><h4 id="查看Centos7配置信息"><a href="#查看Centos7配置信息" class="headerlink" title="查看Centos7配置信息"></a>查看Centos7配置信息</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs yaml">[<span class="hljs-string">root@KVM</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># virsh dominfo Centos7</span><br><span class="hljs-attr">Id:</span>             <span class="hljs-number">1</span><br><span class="hljs-attr">Name:</span>           <span class="hljs-string">Centos7</span><br><span class="hljs-attr">UUID:</span>           <span class="hljs-string">735f1ca1-c82a-4734-81ec-ea3e82e98bae</span><br><span class="hljs-attr">OS Type:</span>        <span class="hljs-string">hvm</span><br><span class="hljs-attr">State:</span>          <span class="hljs-string">running</span><br><span class="hljs-string">CPU(s):</span>         <span class="hljs-number">1</span><br><span class="hljs-attr">CPU time:</span>       <span class="hljs-number">17.</span><span class="hljs-string">3s</span><br><span class="hljs-attr">Max memory:</span>     <span class="hljs-number">2097152</span> <span class="hljs-string">KiB</span><br><span class="hljs-attr">Used memory:</span>    <span class="hljs-number">2097152</span> <span class="hljs-string">KiB</span><br><span class="hljs-attr">Persistent:</span>     <span class="hljs-literal">yes</span><br><span class="hljs-attr">Autostart:</span>      <span class="hljs-string">enable</span><br><span class="hljs-attr">Managed save:</span>   <span class="hljs-literal">no</span><br><span class="hljs-attr">Security model:</span> <span class="hljs-string">selinux</span><br><span class="hljs-attr">Security DOI:</span>   <span class="hljs-number">0</span><br><span class="hljs-attr">Security label:</span> <span class="hljs-string">system_u:system_r:svirt_t:s0:c202,c740</span> <span class="hljs-string">(enforcing)</span><br></code></pre></td></tr></table></figure><h4 id="关闭虚拟机"><a href="#关闭虚拟机" class="headerlink" title="关闭虚拟机"></a>关闭虚拟机</h4><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">[root@KVM ~]# virsh shutdown Centos7<br>Domain <span class="hljs-emphasis">&#x27;Centos7&#x27;</span> is being shutdown<br>[root@KVM ~]# virsh list --all<br><span class="hljs-section"> Id   Name      State</span><br><span class="hljs-section">--------------------------</span><br><span class="hljs-code"> -    Centos7   shut off</span><br></code></pre></td></tr></table></figure><h4 id="修改Centos7-CPU核心数量"><a href="#修改Centos7-CPU核心数量" class="headerlink" title="修改Centos7 CPU核心数量"></a>修改Centos7 CPU核心数量</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml">[root@KVM ~]# vi /etc/libvirt/qemu/Centos7.xml<br><span class="hljs-tag">&lt;<span class="hljs-name">domain</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;kvm&#x27;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>Centos7<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">uuid</span>&gt;</span>735f1ca1-c82a-4734-81ec-ea3e82e98bae<span class="hljs-tag">&lt;/<span class="hljs-name">uuid</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">metadata</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">libosinfo:libosinfo</span> <span class="hljs-attr">xmlns:libosinfo</span>=<span class="hljs-string">&quot;http://libosinfo.org/xmlns/libvirt/domain/1.0&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">libosinfo:os</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;http://redhat.com/rhel/7.7&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">libosinfo:libosinfo</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">metadata</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">memory</span> <span class="hljs-attr">unit</span>=<span class="hljs-string">&#x27;KiB&#x27;</span>&gt;</span>2097152<span class="hljs-tag">&lt;/<span class="hljs-name">memory</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">currentMemory</span> <span class="hljs-attr">unit</span>=<span class="hljs-string">&#x27;KiB&#x27;</span>&gt;</span>2097152<span class="hljs-tag">&lt;/<span class="hljs-name">currentMemory</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">vcpu</span> <span class="hljs-attr">placement</span>=<span class="hljs-string">&#x27;static&#x27;</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">vcpu</span>&gt;</span>    修改为2<br>  <span class="hljs-tag">&lt;<span class="hljs-name">os</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">type</span> <span class="hljs-attr">arch</span>=<span class="hljs-string">&#x27;x86_64&#x27;</span> <span class="hljs-attr">machine</span>=<span class="hljs-string">&#x27;pc-q35-rhel8.6.0&#x27;</span>&gt;</span>hvm<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span><br><br></code></pre></td></tr></table></figure><h4 id="启动虚拟机并查看配置文件"><a href="#启动虚拟机并查看配置文件" class="headerlink" title="启动虚拟机并查看配置文件"></a>启动虚拟机并查看配置文件</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs yaml">[<span class="hljs-string">root@KVM</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># virsh start Centos7</span><br><span class="hljs-string">Domain</span> <span class="hljs-string">&#x27;Centos7&#x27;</span> <span class="hljs-string">started</span><br><br>[<span class="hljs-string">root@KVM</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># virsh dominfo Centos7</span><br><span class="hljs-attr">Id:</span>             <span class="hljs-number">1</span><br><span class="hljs-attr">Name:</span>           <span class="hljs-string">Centos7</span><br><span class="hljs-attr">UUID:</span>           <span class="hljs-string">735f1ca1-c82a-4734-81ec-ea3e82e98bae</span><br><span class="hljs-attr">OS Type:</span>        <span class="hljs-string">hvm</span><br><span class="hljs-attr">State:</span>          <span class="hljs-string">running</span><br><span class="hljs-string">CPU(s):</span>         <span class="hljs-number">2</span><br><span class="hljs-attr">CPU time:</span>       <span class="hljs-number">13.</span><span class="hljs-string">4s</span><br><span class="hljs-attr">Max memory:</span>     <span class="hljs-number">2097152</span> <span class="hljs-string">KiB</span><br><span class="hljs-attr">Used memory:</span>    <span class="hljs-number">2097152</span> <span class="hljs-string">KiB</span><br><span class="hljs-attr">Persistent:</span>     <span class="hljs-literal">yes</span><br><span class="hljs-attr">Autostart:</span>      <span class="hljs-string">enable</span><br><span class="hljs-attr">Managed save:</span>   <span class="hljs-literal">no</span><br><span class="hljs-attr">Security model:</span> <span class="hljs-string">selinux</span><br><span class="hljs-attr">Security DOI:</span>   <span class="hljs-number">0</span><br><span class="hljs-attr">Security label:</span> <span class="hljs-string">system_u:system_r:svirt_t:s0:c414,c924</span> <span class="hljs-string">(enforcing)</span><br><br>[<span class="hljs-string">root@KVM</span> <span class="hljs-string">~</span>]<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><h2 id="维护虚拟机"><a href="#维护虚拟机" class="headerlink" title="维护虚拟机"></a>维护虚拟机</h2><h3 id="挂起-x2F-恢复虚拟机"><a href="#挂起-x2F-恢复虚拟机" class="headerlink" title="挂起&#x2F;恢复虚拟机"></a>挂起&#x2F;恢复虚拟机</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">[root@KVM ~]# virsh suspend Centos7<br>Domain <span class="hljs-emphasis">&#x27;Centos7&#x27;</span> suspended<br>[root@KVM ~]# virsh list --all<br><span class="hljs-section"> Id   Name      State</span><br><span class="hljs-section">------------------------</span><br><span class="hljs-code"> 1    Centos7   paused</span><br>[root@KVM ~]# virsh resume Centos7<br>Domain <span class="hljs-emphasis">&#x27;Centos7&#x27;</span> resumed<br><br>[root@KVM ~]# virsh list --all<br><span class="hljs-section"> Id   Name      State</span><br><span class="hljs-section">-------------------------</span><br><span class="hljs-code"> 1    Centos7   running</span><br></code></pre></td></tr></table></figure><h3 id="克隆KVM虚拟机"><a href="#克隆KVM虚拟机" class="headerlink" title="克隆KVM虚拟机"></a>克隆KVM虚拟机</h3><h4 id="关闭Centos7-并且克隆Centos7为C7"><a href="#关闭Centos7-并且克隆Centos7为C7" class="headerlink" title="关闭Centos7 并且克隆Centos7为C7"></a>关闭Centos7 并且克隆Centos7为C7</h4><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">[root@KVM ~]# virsh shutdown Centos7<br>Domain <span class="hljs-emphasis">&#x27;Centos7&#x27;</span> is being shutdown<br><br>[root@KVM ~]# virsh list --all<br><span class="hljs-section"> Id   Name      State</span><br><span class="hljs-section">--------------------------</span><br><span class="hljs-code"> -    Centos7   shut off</span><br><br>[root@KVM ~]# virt-clone -o Centos7 -n C7 -f /opt/disk/C7.qcow2<br>Allocating <span class="hljs-emphasis">&#x27;C7.qcow2&#x27;</span>                                                      |  10 GB  00:00:37<br><br>Clone <span class="hljs-emphasis">&#x27;C7&#x27;</span> created successfully.<br>克隆成功<br>[root@KVM ~]# virsh list --all<br><span class="hljs-section"> Id   Name      State</span><br><span class="hljs-section">--------------------------</span><br><span class="hljs-code"> -    C7        shut off</span><br><span class="hljs-code"> -    Centos7   shut off</span><br></code></pre></td></tr></table></figure><h4 id="开启C7，登入并且修改主机名为C7"><a href="#开启C7，登入并且修改主机名为C7" class="headerlink" title="开启C7，登入并且修改主机名为C7"></a>开启C7，登入并且修改主机名为C7</h4><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs livescript">[root@KVM ~]<span class="hljs-comment"># virsh start C7</span><br>Domain <span class="hljs-string">&#x27;C7&#x27;</span> started<br><br>[root@KVM ~]<span class="hljs-comment"># virsh console C7</span><br>Connected <span class="hljs-keyword">to</span> domain <span class="hljs-string">&#x27;C7&#x27;</span><br>Escape character <span class="hljs-keyword">is</span> ^] (Ctrl + ])<br>CentOS Linux <span class="hljs-number">7</span> (Core)<br>Kernel <span class="hljs-number">3.10</span>.<span class="hljs-number">0</span>-<span class="hljs-number">1160.el</span>7.x86_64 <span class="hljs-literal">on</span> an x86_64<br><br>centos7 login: root<br>Password:<br>Last login: Mon Jan  <span class="hljs-number">9</span> <span class="hljs-number">15</span>:<span class="hljs-number">56</span>:<span class="hljs-number">16</span> <span class="hljs-keyword">from</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">48.250</span><br>[root@centos7 ~]<span class="hljs-comment"># hostnamectl set-hostname C7 &amp;&amp; bash</span><br>[root@c7 ~]<span class="hljs-comment">#</span><br>克隆后ip回合Centos7一样，记得后期修改<br></code></pre></td></tr></table></figure><h3 id="设置Kvm虚拟机快照"><a href="#设置Kvm虚拟机快照" class="headerlink" title="设置Kvm虚拟机快照"></a>设置Kvm虚拟机快照</h3><h4 id="登入C7-创建-x2F-opt-x2F-dev-，关闭虚拟机，创建快照"><a href="#登入C7-创建-x2F-opt-x2F-dev-，关闭虚拟机，创建快照" class="headerlink" title="登入C7 创建&#x2F;opt&#x2F;dev ，关闭虚拟机，创建快照"></a>登入C7 创建&#x2F;opt&#x2F;dev ，关闭虚拟机，创建快照</h4><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs autoit">[root<span class="hljs-symbol">@c7</span> ~]<span class="hljs-meta"># mkdir /opt/dev</span><br>[root<span class="hljs-symbol">@c7</span> ~]<span class="hljs-meta"># ls /opt</span><br>dev<br>按ctrl + ] 退回到KVM宿主机<br>[root<span class="hljs-symbol">@KVM</span> ~]<span class="hljs-meta"># virsh shutdown C7</span><br>Domain <span class="hljs-string">&#x27;C7&#x27;</span> is being <span class="hljs-built_in">shutdown</span><br>创建快照<br>[root<span class="hljs-symbol">@KVM</span> ~]<span class="hljs-meta"># virsh snapshot-create C7</span><br>Domain snapshot <span class="hljs-number">1673252946</span> created<br>查看C7的快照列表<br>[root<span class="hljs-symbol">@KVM</span> ~]<span class="hljs-meta"># virsh snapshot-list C7</span><br> Name         Creation Time               State<br>---------------------------------------------------<br> <span class="hljs-number">1673252946</span>   <span class="hljs-number">2023</span><span class="hljs-number">-01</span><span class="hljs-number">-09</span> <span class="hljs-number">03</span>:<span class="hljs-number">29</span>:<span class="hljs-number">06</span> <span class="hljs-number">-0500</span>   shutoff<br></code></pre></td></tr></table></figure><h4 id="开启C7-删除-x2F-opt-x2F-dev-，恢复快照"><a href="#开启C7-删除-x2F-opt-x2F-dev-，恢复快照" class="headerlink" title="开启C7 删除&#x2F;opt&#x2F;dev ，恢复快照"></a>开启C7 删除&#x2F;opt&#x2F;dev ，恢复快照</h4><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs autoit">[root<span class="hljs-symbol">@KVM</span> ~]<span class="hljs-meta"># virsh start C7</span><br>Domain <span class="hljs-string">&#x27;C7&#x27;</span> started<br><br>[root<span class="hljs-symbol">@KVM</span> ~]<span class="hljs-meta"># virsh console C7</span><br>Connected <span class="hljs-keyword">to</span> domain <span class="hljs-string">&#x27;C7&#x27;</span><br><br>[root<span class="hljs-symbol">@c7</span> ~]<span class="hljs-meta"># rm -rf /opt/dev</span><br>[root<span class="hljs-symbol">@c7</span> ~]<span class="hljs-meta"># ll /opt</span><br>total <span class="hljs-number">0</span><br>按ctrl + ] 退回到KVM宿主机<br>[root<span class="hljs-symbol">@KVM</span> ~]<span class="hljs-meta"># virsh snapshot-list C7</span><br> Name         Creation Time               State<br>---------------------------------------------------<br> <span class="hljs-number">1673252946</span>   <span class="hljs-number">2023</span><span class="hljs-number">-01</span><span class="hljs-number">-09</span> <span class="hljs-number">03</span>:<span class="hljs-number">29</span>:<span class="hljs-number">06</span> <span class="hljs-number">-0500</span>   shutoff<br><br>[root<span class="hljs-symbol">@KVM</span> ~]<span class="hljs-meta"># virsh snapshot-revert C7 1673252946</span><br>virsh snapshot-revert 虚拟机名字 快照名字 <br></code></pre></td></tr></table></figure><h4 id="开启C7-查看是否恢复成功"><a href="#开启C7-查看是否恢复成功" class="headerlink" title="开启C7,查看是否恢复成功"></a>开启C7,查看是否恢复成功</h4><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs livescript">[root@KVM ~]<span class="hljs-comment"># virsh start C7</span><br>Domain <span class="hljs-string">&#x27;C7&#x27;</span> started<br><br>[root@KVM ~]<span class="hljs-comment"># virsh console C7</span><br>Connected <span class="hljs-keyword">to</span> domain <span class="hljs-string">&#x27;C7&#x27;</span><br>Escape character <span class="hljs-keyword">is</span> ^] (Ctrl + ])<br><br>CentOS Linux <span class="hljs-number">7</span> (Core)<br>Kernel <span class="hljs-number">3.10</span>.<span class="hljs-number">0</span>-<span class="hljs-number">1160.el</span>7.x86_64 <span class="hljs-literal">on</span> an x86_64<br><br>c7 login: root<br>Password:<br>Last login: Mon Jan  <span class="hljs-number">9</span> <span class="hljs-number">16</span>:<span class="hljs-number">27</span>:<span class="hljs-number">07</span> <span class="hljs-literal">on</span> ttyS0<br>[root@c7 ~]<span class="hljs-comment"># ls /opt</span><br>dev<br></code></pre></td></tr></table></figure><h2 id="virsh-命令"><a href="#virsh-命令" class="headerlink" title="virsh 命令"></a>virsh 命令</h2><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">virsh <span class="hljs-keyword">shutdown</span> 关闭KVM虚拟机 <br>virsh destroy 强制关闭KVM虚拟机，不删除虚拟机磁盘，virsh list列表里面看不见，但是磁盘还在，还是可以启动，通过virsh list <span class="hljs-params">--all</span>可以查看<br>virsh undefine 彻底删除虚拟机，包括虚拟机存储所在的位置<br>virsh start 开启KVM虚拟机<br>virsh suspend 虚拟机名称 <span class="hljs-comment">#挂起</span><br>virsh resume 虚拟机名称 <span class="hljs-comment">#恢复被挂起的</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>Centos 8 stream</tag>
      
      <tag>KVM</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
